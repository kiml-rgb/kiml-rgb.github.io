<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Keep Theme</title>
  
  <subtitle>Keep theme quick starter</subtitle>
  <link href="https://kiml.github.io/atom.xml" rel="self"/>
  
  <link href="https://kiml.github.io/"/>
  <updated>2025-05-18T12:07:35.959Z</updated>
  <id>https://kiml.github.io/</id>
  
  <author>
    <name>Keep Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>第二章：数据结构与算法基础</title>
    <link href="https://kiml.github.io/posts/92102162/"/>
    <id>https://kiml.github.io/posts/92102162/</id>
    <published>2025-05-18T06:59:42.000Z</published>
    <updated>2025-05-18T12:07:35.959Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25-05-18 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="基本概念与三要素">基本概念与三要素</h2><p>数据：数据是<strong>信息的载体</strong>，是描述客观事物属性的数、字符及所有能输入到计算机中并被计算机程序识别和处理的符号的集合。<strong>数据是计算机程序加工的原料</strong>。</p><p>数据元素、数据项：数据元素是数据的基本单位，通常作为一个整体进行考虑和处理。一个数据元素可由<strong>若干数据项</strong>组成，数据项是构成数据元素的不可分割的<strong>最小单位</strong>。</p><p>数据结构：是相互之间存在一种或多种<strong>特定关系</strong>d 的数据元素的集合。</p><p>三要素：逻辑结构、物理结构（存储结构）、数据的运算</p><h3 id="三要素-逻辑结构">三要素 - 逻辑结构</h3><p>集合：各个元素同属于一个集合，别无其它关系。</p><p>线性结构：数据元素之间时一对一的关系。除了第一个元素，所有的元素都有唯一前驱；除了最后一个元素，所有元素都有唯一后继。</p><p>树形结构：数据元素之间是一对多的关系。</p><p>图结构：数据元素之间是多对多的关系。</p><h3 id="三要素-物理结构">三要素 - 物理结构</h3><p>顺序结构：把逻辑上相邻的元素存储在屋里位置上也相邻的存储单元中</p><p>联是存储：逻辑上相邻的元素在物理位置上可以不相邻</p><p>索引存储：在存储元素信息的同时，还建立附加的索引表</p><p>散列存储：根据元素的关键字直接计算出该元素的存储地址，又称哈希存储</p><h2 id="算法">算法</h2><h3 id="五个特性">五个特性</h3><p>有穷性：一个算法必须总在执行有穷步之后结束，且每一步都可在有穷时间内完成。</p><p>确定性：算法中每条指令必须有确切的含义，对于<strong>相同的输入</strong>只能得出<strong>相同的输出</strong>。</p><p>可行性：算法中描述的操作都可以通过已经实现的<strong>基本运算执行有限次</strong>来实现。</p><p>输入：一个算法<strong>有零个或多个输入</strong>，这些输入取自于某个特定的对象的集合。</p><p>输出：一个算法有<strong>一个或多个输出</strong>，这些输出是与输入有着某种特定的关系的量。</p><h3 id="算法效率的度量">算法效率的度量</h3><p>时间复杂度：时间开销与问题规模 n 之间的关系</p><p>空间复杂度：空间开销（内存开销）与问题规模 n 之间的关系。</p><p><mark>递归调用带来的内存开销：S(n) = O(n) <strong>空间复杂度 = 递归调用的深度</strong></mark></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O(1) &lt; O(log2n) &lt; O(n) &lt; O(nlog2n) &lt; O(n^2) &lt; O(n^3) &lt; O(2^n) &lt; O(n!) &lt; O(n^n)</span><br></pre></td></tr></table></figure><h2 id="线性表">线性表</h2><h3 id="存储结构">存储结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|- 顺序表</span><br><span class="line">|- 链表 </span><br><span class="line">|-- 单链表</span><br><span class="line">|-- 循环链表</span><br><span class="line">|-- 双向链表</span><br></pre></td></tr></table></figure><table><thead><tr><th>性能类别</th><th>具体项目</th><th>顺序存储</th><th>链式存储</th></tr></thead><tbody><tr><td>空间性能</td><td>存储密度</td><td><strong>=1</strong></td><td>&lt;1</td></tr><tr><td></td><td>容量分配</td><td>事先确定</td><td><strong>动态改变</strong></td></tr><tr><td>时间性能</td><td>查找运算</td><td>O(n/2)</td><td>O(n/2)</td></tr><tr><td></td><td>读运算</td><td><strong>O(1)</strong></td><td>O([n + 1]/2)，最好情况为 1，最坏情况为 n</td></tr><tr><td></td><td>插入运算</td><td>O(n/2)，最好情况为 0，最坏情况为 n</td><td><strong>O(1)</strong></td></tr><tr><td></td><td>删除运算</td><td>([n - 1]/2)，</td><td><strong>O(1)</strong></td></tr></tbody></table><h2 id="其他">其他</h2><p>算法问题直接看之前的算法笔记。</p><blockquote><p>内链：[[面试-数据结构和算法]]<br>外链：<a class="link"   href="https://kiml.site/posts/1b906b1a/" >面试-数据结构和算法<i class="fas fa-external-link-alt"></i></a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;25-05-18 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="面试" scheme="https://kiml.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="软考" scheme="https://kiml.github.io/categories/%E9%9D%A2%E8%AF%95/%E8%BD%AF%E8%80%83/"/>
    
    <category term="中级-软件设计师" scheme="https://kiml.github.io/categories/%E9%9D%A2%E8%AF%95/%E8%BD%AF%E8%80%83/%E4%B8%AD%E7%BA%A7-%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88/"/>
    
    
  </entry>
  
  <entry>
    <title>第一章：计算机系统知识</title>
    <link href="https://kiml.github.io/posts/3f3c39e1/"/>
    <id>https://kiml.github.io/posts/3f3c39e1/</id>
    <published>2025-05-18T06:58:47.000Z</published>
    <updated>2025-05-18T11:40:41.852Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25-04-06 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="数值及其转换和数据的表示">数值及其转换和数据的表示</h2><p>二进制（B）、八进制（O）、十进制（D）、十六进制（H）</p><p>任意进制 -&gt; 十进制：位权展开</p><p>十进制 -&gt; 任意进制：短除法</p><p><mark>二进制 -&gt; 十六进制：4 位转 1 位</mark></p><table><thead><tr><th>2^12</th><th>2^11</th><th>2^10</th><th>2^9</th><th>2^8</th><th>2^7</th><th>2^6</th><th>2^5</th><th>2^4</th><th>2^3</th><th>2^2</th><th>2^1</th><th>2^0</th><th>2^-1</th><th>2^-2</th><th>2^-3</th></tr></thead><tbody><tr><td>4096</td><td>2048</td><td>1024</td><td>512</td><td>256</td><td>128</td><td>64</td><td>32</td><td>16</td><td>8</td><td>4</td><td>2</td><td>1</td><td>0.5</td><td>0.25</td><td>0.125</td></tr></tbody></table><h2 id="计算机内数据的表示">计算机内数据的表示</h2><h3 id="真值与机器数">真值与机器数</h3><p>真值：符合人类习惯的数字</p><p>机器数：各种数据在计算机中表示的形式称为机器数，其特点是数的符号用 0、1 表示。即<mark>正负号需要被“数字化”</mark></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">机器数</span><br><span class="line">- 无符号数：无符号数表示正数，在机器数中没有符号位</span><br><span class="line">- 有符号数</span><br><span class="line">- 原码</span><br><span class="line">- 反码</span><br><span class="line">- 补码</span><br><span class="line">- 移码</span><br></pre></td></tr></table></figure><h3 id="原码">原码</h3><p><strong>原码</strong>：用数值部分表示真值的绝对值，符号位“0/1”对应“正/负”。</p><blockquote><p>若机器字长 n+1 位，<mark>原码整数</mark>的表示范围：<code>-(2^n -1) &lt;= x &lt;= 2^n -1</code>若机器字长 n+1 位，则数值部分（尾数）占 n 位，真值 0 有 <code>+0</code> 和 <code>-0</code> 两种形式。</p></blockquote><h3 id="反码">反码</h3><p><strong>反码</strong>：若符号位为 0，则反码与原码相同。若符号位为 1，则数值位全部取反。</p><blockquote><p>若机器字长 n+1 位，<mark>反码整数</mark>的表示范围：<code>-(2^n -1) &lt;= x &lt;= 2^n -1</code>真值 0 有 <code>+0</code> 和 <code>-0</code> 两种形式。</p></blockquote><h3 id="补码">补码</h3><p><strong>补码</strong>：若符号位为 0，则补码与原码相同。若符号位为 1，则补码=反码末位 +1。</p><blockquote><p>若机器字长 n+1 位，<mark>补码整数</mark>的表示范围：<code>-2^n &lt;= x &lt;= 2^n -1</code><br><strong>真值 0 只有一种形式</strong><code>00000000</code>。定点整数补码 <code>[x]补 = 10000000</code> 表示 <code>-2^7</code></p></blockquote><h3 id="移码">移码</h3><p><strong>移码</strong>：补码的基础上将符号位取反。注意：移码只能用于表示<strong>整数</strong>。</p><blockquote><p>若机器字长 n+1 位，<mark>补码整数</mark>的表示范围：<code>-2^n &lt;= x &lt;= 2^n -1</code></p></blockquote><h3 id="定点数-和-浮点数">定点数 和 浮点数</h3><p><strong>定点数</strong>：就是<strong>小数点的位置固定不变的数</strong>。小数点的位置通常有两种约定方式：定点整数（纯整数，小数点在最低有效数值位之后）和定点小数（纯小数，小数点在最高有效数值位之前）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5D - 0，01001.</span><br><span class="line">0.5D - 0.1000</span><br></pre></td></tr></table></figure><p><strong>浮点数</strong>：小数点位置不固定的数，他能表示更大范围的数。在浮点表示法中，阶码通常为带符号的纯整数，尾数为带符号的纯小数。<mark>浮点数通常表示为 <code>N=MR^E</code>。其中，M 称为尾数，R 称为基数，E 称为阶码。</mark></p><table><thead><tr><th>阶码（E）</th><th>码价</th><th>数符</th><th>尾数（M）</th></tr></thead></table><blockquote><p><strong>阶码</strong>，决定浮点数所能表示的<strong>数值范围</strong><br><strong>尾数</strong>， 决定浮点数所能表示的<strong>数值精度</strong></p></blockquote><h3 id="校验码">校验码</h3><p>校验码：用来检测传送的数据是否出错。</p><p>码距：指一个编码系统中任意两个合法编码之间至少有多少个二进制位不同。</p><h4 id="奇偶校验">奇偶校验</h4><p><strong>发现错误。</strong></p><h4 id="循环冗余校验码-CRC">循环冗余校验码 CRC</h4><p>应用于数据通信领域和磁介质存储系统中。长度 k（数据位） + r（校验位）</p><h4 id="海明码"><mark>海明码</mark></h4><p>海明码的构成方法是：在数据位之间插入 k 个校验码，通过扩大码距来实现<strong>检错</strong>和<strong>纠错</strong>。</p><blockquote><p>设数据位是 n 位，校验位是 k 位，则 n 和 k 必须满足以下关系：<br><code>2^k -1 &gt;= n+k</code></p></blockquote><h2 id="计算机系统组成">计算机系统组成</h2><h3 id="五大部件">五大部件</h3><blockquote><p>输入设备、输出设备、存储器、运算器、控制器。输入/输出设备与存储器之间的数据传输通过运算器完成。</p></blockquote><p>冯·诺依曼计算机的特点：</p><ol><li class="lvl-3"><p>计算机由五大部件组成（输入设备、输出设备、存储器、运算器、控制器）</p></li><li class="lvl-3"><p>指令和数据以同等地位存于存储器，可按地址寻访</p></li><li class="lvl-3"><p>指令和数据用二进制表示</p></li><li class="lvl-3"><p>指令由操作码和地址码组成</p></li><li class="lvl-3"><p>存储程序</p></li><li class="lvl-3"><p>以运算器为中心</p></li></ol><p>输入设备：将信息转换为机器能识别的形式 0/1</p><p>输出设备：将结果转换为人们熟知的形式</p><p>主存储器：存放数据和程序</p><p>运算器：算术运算、逻辑运算</p><p>控制器：指挥各部件、使程序得以运行</p><h3 id="主存储器">主存储器</h3><blockquote><p>存储体、MAR、MDR</p></blockquote><p>存储单元：每个存储单元存放一串二进制代码。</p><p>存储字：存储单元中二进制代码的组合。</p><p>存储字长：存储单元中二进制代码的位数。</p><p>存储元：即存储二进制的电子元件，每个存储元可存 1 bit。</p><p>MAR：地址寄存器（标记存储单元的个数）</p><p>MDR：数据寄存器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MAR = 4位 -&gt; 总共有 2*2*2*2 个存储单元</span><br><span class="line">MDR = 16位 -&gt; 每个存储单元可存放 16 bit</span><br></pre></td></tr></table></figure><h3 id="CPU-运算器">CPU - 运算器</h3><p>运算器：用于实现算术运算（如：加减乘除）、逻辑运算（如：与或非）</p><p>ACC：累加器，用于存放操作数，或运算结果。</p><p>MQ：乘商寄存器，在乘、除运算时，用于存放操作数或结果运算。</p><p>X：通用的操作数寄存器，用于存放操作数。</p><p><strong>ALU：算术逻辑单元</strong>，通过内部复杂的电路实现算术运算、逻辑运算。</p><p>DR：数据缓存寄存器。</p><p>PSW：状态条件寄存器，用来保存指令运行标志。</p><h3 id="CPU-控制器">CPU - 控制器</h3><p>CU：控制单元，分析指令，给出控制信号。</p><p>IR：指令寄存器，存放<strong>当前执行的指令</strong>。</p><p>PC：程序计数器，存放<strong>下一条指令地址</strong>，有<strong>自动加 1</strong>功能。</p><p>AR：地址寄存器，保存当前 CPU 所访问的内存单元地址。</p><p>ID：指令译码器，对操作码进行分析。</p><h2 id="计算机体系结构">计算机体系结构</h2><h3 id="Flynn-分类法">Flynn 分类法</h3><table><thead><tr><th>体系结构类型</th><th>结构</th><th>关键特性</th><th>代表</th></tr></thead><tbody><tr><td>单指令流单数据流 SISD</td><td>控制部分：一个<br>处理器：一个<br>主存模块：一个</td><td></td><td>单处理器系统</td></tr><tr><td>单指令流多数据流 SIMD</td><td>控制部分：一个<br>处理器：多个<br>主存模块：多个</td><td>各处理器以异步的形式执行同一条指令</td><td>并行处理机<br>阵列处理机<br>超级向量处理机</td></tr><tr><td>多指令流单数据流 MISD</td><td>控制部分：多个<br>处理器：一个<br>主存模块：多个</td><td><strong>被证明不可能，至少是不实际</strong></td><td>目前没有，有文献称流水计算机为此类</td></tr><tr><td>多指令流多数据流 MIMD</td><td>控制部分：多个<br>处理器：多个<br>主存模块：多个</td><td>能够实现作业、任务、指令等各级全面屏行</td><td>多处理机系统<br>多计算机</td></tr></tbody></table><h2 id="指令系统">指令系统</h2><h3 id="指令">指令</h3><p>指令（又称机器指令）：是指令计算机执行某种操作的命令，是计算机运行的最小功能单位。</p><p>一台计算机的所有指令的集合构成该机的<strong>指令系统</strong>，也称为指令集。</p><h3 id="指令格式">指令格式</h3><p>一条指令就是机器语言的一个语句，它是一组<strong>有意义</strong>的二进制代码。</p><p>一条指令通常要包括<strong>操作码字段</strong>（操作的类型）和<strong>地址码字段</strong>（操作数及运算结果存放的地址）两部分。</p><h3 id="七种寻址方式">七种寻址方式</h3><ul class="lvl-0"><li class="lvl-2"><p>立即寻址：操作数作为指令的一部分直接写在指令中，这种操作数称为立即数。</p></li><li class="lvl-2"><p>寄存器寻址：指令所要的操作数已存储在某寄存器中，或把目标操作数存入寄存器。</p></li><li class="lvl-2"><p>直接寻址：指令所要的操作数存放在内存中，在指令中直接给出该操作数的有效地址。</p></li><li class="lvl-2"><p>寄存器间接寻址：操作数在存储器中，操作数的有效地址用 SI、DI、BX 和 BP 四个寄存器之一来制定。</p></li><li class="lvl-2"><p>寄存器相对寻址：操作数在存储器中，其有效地址是一个基址寄存器或变址寄存器中的内容和指令中的 8 位/16 位偏移量之和。</p></li><li class="lvl-2"><p>基址加变址寻址方式：操作数在存储器中，其有效地址是一个基址寄存器和一个变址寄存器的内容之和。</p></li><li class="lvl-2"><p>相对基址加变址寻址：操作数在存储器中，其有效地址是一个基址寄存器的值、一个变址寄存器的值和指令中的 8 位/16 位偏移量之和。</p></li></ul><h3 id="复杂指令集计算机-CISC、精简指令集计算机-RISC">复杂指令集计算机 - CISC、精简指令集计算机 - RISC</h3><table><thead><tr><th></th><th>CISC（Complex）</th><th>RISC（Reduced）</th></tr></thead><tbody><tr><td>指令系统</td><td>复杂、庞大</td><td>简单、精简</td></tr><tr><td>指令数目</td><td>一般大于 200 条</td><td>一般小于 100 条</td></tr><tr><td>指令字长</td><td>不固定</td><td>定长</td></tr><tr><td>可访存指令</td><td>不加限制</td><td>只有 Load/Store 指令</td></tr><tr><td>各种指令执行时间</td><td>相差较大</td><td>绝大多数一个周期内完成</td></tr><tr><td>各种指令使用频度</td><td>相差较大</td><td>都比较常用</td></tr><tr><td>通用寄存器数量</td><td>较少</td><td>多</td></tr><tr><td>控制方式</td><td>绝大多数为微程序控制</td><td>绝大多数为组合逻辑控制</td></tr><tr><td>指令流水线</td><td>可以通过一定方式实现</td><td>必须实现</td></tr></tbody></table><h3 id="指令的流水处理">指令的流水处理</h3><p>指令控制方式有顺序方式、重叠方式和流水方式三种。</p><h4 id="流水线的计算"><strong>流水线的计算</strong></h4><blockquote><p>列：若指令流水线把一条指令分为取指、分析和执行三部分，且三部分的时间分别是取指 2ns，分析 2ns，执行 1ns。那么，流水线周期是多少？100 条指令全部执行完毕需要的时间是多少？</p></blockquote><p><strong>流水线周期为执行时间最长的一段</strong></p><p>流水线计算公式为：<em><em>1 条指令执行时间 +（指令条数 -1）</em> 流水线周期</em>*</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">流水线周期：2ns</span><br><span class="line">时间：2ns + 2ns + 1ns + (100 - 1) * 2ns = 103 ns</span><br></pre></td></tr></table></figure><p><strong>流水线的吞吐率（TP）</strong>：是指在单位时间内流水线所完成的任务数量或输出的结果数量。计算公式：<strong>TP=指令条数/流水线执行时间</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TP = 100 / [2ns + 2ns + 1ns + (100 - 1) * 2ns] = 100 / 103</span><br></pre></td></tr></table></figure><p><strong>流水线的加速比</strong>：完成同样一批任务，不使用流水线所用的时间与使用流水线所用的时间之比。计算公式：<strong>S=不使用流水线执行时间/使用流水线执行时间</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S = (2ns + 2ns + 1ns) * 100 / [2ns + 2ns + 1ns + (100 - 1) * 2ns] = 500 / 103</span><br></pre></td></tr></table></figure><h3 id="输入输出技术">输入输出技术</h3><h4 id="CPU-与外设之间的数据传输方式">CPU 与外设之间的数据传输方式</h4><ol><li class="lvl-3"><p>直接程序控制方式直接程序控制方式是指在完成数据的输入/输出中，整个输入/输出的过程是<strong>在 CPU 执行程序的控制下完成的</strong>。这种方式还可以分为以下两种：</p><ol><li class="lvl-7">无条件传输方式：无条件地与 CPU 交换数据。</li><li class="lvl-7">程序查询方式：先通过 CPU 查询外设状态，准备好之后再与 CPU 交换数据。</li></ol></li><li class="lvl-3"><p>中断方式中断方式利用中断机制，使 I/O 系统在与外设交换数据时，<strong>CPU 无须等待，也不必查询 I/O 状态</strong>，即可以抽身出来处理其他任务，因此提高了系统效率。</p></li><li class="lvl-3"><p>直接存储器存取方式（<strong>DMA</strong>）是在存储器与 I/O 设备间直接传送数据，即在内存与 I/O 设备之间传送一个数据块的过程中，不需要 CPU 的任何干涉，是一种<strong>完全由 DMA 硬件完成</strong> I/O 操作的方式。</p></li><li class="lvl-3"><p>输入/输出处理机（<strong>IOP</strong>）是一个专用处理机，用于完成主机的输入/输出操作。IOP 根据主机的 I/O 命令，完成对外设数据的输入/输出。</p></li></ol><h2 id="存储系统">存储系统</h2><h3 id="层次结构">层次结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CPU</span><br><span class="line">高速缓存（Cache）-辅助硬件</span><br><span class="line">主存-辅助硬件/软件</span><br><span class="line">辅存</span><br></pre></td></tr></table></figure><p>主存 - 辅存（硬件 + 操作系统）：实现虚拟系统存储，<strong>解决了主存容量不够的问题</strong></p><p>Cache - 主存（硬件自动完成）：解决了<strong>主存与 CPU 速度不匹配的问题</strong></p><h3 id="分类">分类</h3><ol><li class="lvl-3"><p>按位置分类：可以分为内存和外存内存（主存）：用来存储当前运行所需要的程序和数据，速度快、容量小。外存（辅存）：用来存储当前不参与运行的数据，容量大，速度慢。</p></li><li class="lvl-3"><p>按材料分类，可分为磁存储器、半导体存储器和光存储器。磁存储器：用磁性介质做成，如磁芯、磁泡、磁盘、磁带等半导体存储器：根据所用元件又可分为双极型和 MOS 型两类；根据是否需要刷新又可分为静态和动态两类。光存储器：由光学、电学和机械部件等组成，如光盘存储器。</p></li><li class="lvl-3"><p>按工作方式分，可分为读/写存储器和只读存储器。读/写存储器（RAM）它指既能读取数据也能存入数据的存储器。只读存储器（ROM）工作过程中仅能读取的存储器。</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p>固定只读存储器（ROM）。这种存储器是在厂家生产时就写好数据的，其内容只能读出，不能改变。一般用于存放<strong>系统程序 BIOS</strong>和用于<strong>微程序控制</strong>。</p></li><li class="lvl-2"><p>可编程的只读存储器（PROM）。其中的内容可以由用户<strong>一次性地写入</strong>，写入后<strong>不能再修改</strong>。</p></li><li class="lvl-2"><p>可擦除可编程的的只读存储器（EPROM）。其中的内容既可以读出，也可以由用户写入，写入后还可以修改，<strong>紫外线照射擦除信息</strong>。</p></li><li class="lvl-2"><p>电擦除可编程的的只读存储器（EEPROM）。与 EPROM 相似，EEPROM 中的内容既可以读出，也可以进行改写，<strong>电擦除</strong>的方法进行数据的改写。</p></li><li class="lvl-2"><p>闪存存储器（Flash Memory）。简称闪存，闪存的特性介于 EPROM 和 EEPROM 之间，类似于 EEPROM，也可以使用电信号进行信息的擦除操作。整块闪存可以在数秒内删除，<strong>速度远快于 EPROM</strong>。</p></li></ul><h3 id="高速缓存-Cache">高速缓存 -Cache</h3><p>高速缓存（Cache）是位于 CPU 和主存之间的高速存储子系统。</p><p>目的：提高存储器的平均访问速度，使存储器的速度与 CPU 的速度相匹配。</p><p>地址变换和数据块的替换算法均由硬件实现。</p><p>通常被集成到 CPU 内，以提高访问速度，其主要特点是容量小、速度快、成本高。</p><h4 id="Cache-的组成">Cache 的组成</h4><ol><li class="lvl-3"><p>Cache 存储器部分：用来存放<strong>主存的部分复制信息</strong>。</p></li><li class="lvl-3"><p>控制部分的功能：判断 CPU 要访问的信息是否在 Cache 存储器中，若在，即为命中，若不在则没有命中。</p></li></ol><h4 id="Cache-的三种地址映射">Cache 的三种地址映射</h4><p>地址映像：把<strong>主存中的地址映射成 Cache 存储器中的地址</strong></p><ol><li class="lvl-3"><p>直接映射：就是主存的块与 Cache 中块的对应关系是固定的。主存中的块只能存放在 Cache 存储器的相同块号中。因此，只要主存地址中的主存区号与 Cache 中的主存区号相同，则表明访问 Cache 命中。优点：<strong>地址变换很简单</strong>，缺点：<strong>灵活性差</strong>。Cache 分块，主存分区，每个区再分块，并且每个区的块数和 Cache 的分块相同。</p></li><li class="lvl-3"><p>全相联映像：允许主存中的任一块可以调入 Cache 的任一块的空间。在地址变换时，将主存地址高位表示的主存块号与 Cache 中的主存块号进行比较，若相同则为命中。优点：主存的块调入 Cache 的位置<strong>不受限制，十分灵活</strong>。其缺点是无法从主存块号中获得 Cache 的块号，<strong>变换比较复杂，速度比较慢</strong></p></li><li class="lvl-3"><p>组相联映像：这种方式是前面两种方式的折中。具体方法是将 Cache 先分成组再分块。组组相联映像就是<strong>组间采用直接映像方式</strong>，而<strong>组内的块采用全相联映像方式</strong>。</p></li></ol><h4 id="Cache-的性能分析">Cache 的性能分析</h4><blockquote><p>若 H 为 Cache 的命中率，tc 为 Cache 的存取时间，tm 为主存的访问时间，则 Cache 的等效访问时间 ta 为</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ta = H * tc + (1 - H) * tm</span><br></pre></td></tr></table></figure><p>使用 Cache 比不使用 Cache 的 CPU 访问存储器速度提高的倍数 r 可以用下式求得</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = tm / ta</span><br></pre></td></tr></table></figure><h3 id="主存的扩展">主存的扩展</h3><p>位扩展</p><p>字扩展</p><h3 id="主存的编址">主存的编址</h3><blockquote><p>内存地址从 AC000H 到 C7FFFH，共有 ？K 个地址单元，如果该内存地址按字（16bit）编址，由 28 片存储器芯片构成。已知构成此内存的芯片每片有 16K 个存储单元，则该芯片每个存储单元存储 ？位。<br>1K=2^10<br>1M=2^20<br>1G=2^30</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C7FFFH - AC000H + 1 </span><br><span class="line">= 1C000H </span><br><span class="line">= 1 * 2^4^4 + 12 * 2^4^3 </span><br><span class="line">= (2^4 + 12)*2^12</span><br><span class="line">= 28 * 2^12</span><br><span class="line"></span><br><span class="line">地址单元 = 28 * 2^12 / 2^10 = 28 * 2^2 = 112 K</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">112K * 16 = 28 * 16K * 存储位数</span><br><span class="line">存储位数 = 4 bit</span><br></pre></td></tr></table></figure><h3 id="虚拟存储器">虚拟存储器</h3><p>虚拟存储器是由主存、辅存、存储管理单元及操作系统中的存储管理软件组成的存储系统。程序员使用该存储系统时，可以使用的内存空间可远大于主存的物理空间，但实际上并不存在那么大的主存，顾称其为虚拟存储器。</p><p>虚拟存储器使存储系<strong>统既具有相当于外存的容量</strong>又<strong>具有接近于主存的访问速度</strong>。</p><h3 id="磁盘存储器">磁盘存储器</h3><p>存取时间 = 寻道时间 + 等待时间（平均定位时间 + 转动延迟）</p><p>注意：寻道时间是指磁头移动到磁道所需的时间；等待时间为等待读写的扇区转到磁头下方所用的时间。</p><h2 id="总线系统">总线系统</h2><ol><li class="lvl-3"><p>片内总线（内部总线）片内总线是芯片内部的总线。它是 CPU 芯片内部寄存器与寄存器之间、寄存器与 ALU 之间的公共连接线。</p></li><li class="lvl-3"><p>系统总线系统总线是计算机系统内各功能部件（CPU、主存、I/O 接口）之间相互连接的总线。按系统总线<strong>传输信息内容的不同</strong>，又可以分为 3 类：<strong>数据总线、地址总线和控制总线</strong>。</p></li><li class="lvl-3"><p>通信总线（外部总线）用于设备一级的互连，计算机可通过该总线和其他设备进行信息与数据交换。</p></li></ol><h2 id="磁盘阵列技术（RAID）">磁盘阵列技术（RAID）</h2><p>磁盘阵列由多台磁盘存储器组成，是快速、大容量且高可靠的外存子系统。现在常见的独立冗余磁盘阵列（RAID）就是一种由多块独立磁盘构成的冗余阵列。RAID 技术分为几种不同的等级，分别可以提供不同的速度、安全性和性价比。</p><table><thead><tr><th>RAID 级</th><th>说明</th></tr></thead><tbody><tr><td>RAID-0</td><td>一种不具备容错能力的磁盘阵列</td></tr><tr><td>RAID-1</td><td>是采用镜像容错技术改善可靠性的一种磁盘阵列</td></tr><tr><td>RAID-2</td><td>是采用海明码进行错误检测的一种磁盘阵列</td></tr><tr><td>RAID-3</td><td>减少了用于检验的磁盘存储器台数，从而提高了磁盘阵列的有效容量，一般只有一个检验盘</td></tr><tr><td>RAID-4</td><td>是一种可以独立地对组内各磁盘进行读写的磁盘阵列，该阵列也只用一个检验盘</td></tr><tr><td>RAID-5</td><td>是对 RAID-4 的一种改进，他不设置专门的检验盘。同一台磁盘上既记录数据，也记录检测信息。这就解决了前面多台磁盘机争用一台检验盘的问题</td></tr><tr><td>RAID-6</td><td>采用两级数据冗余和新的数据编码以解决数据恢复问题，在两个磁盘出现故障时仍然能够正常工作。在进行写操作时，分别进行两个独立的校验运算，形成两个独立的冗余数据，并写入两个不同的磁盘。</td></tr></tbody></table><h2 id="计算机可靠性">计算机可靠性</h2><p>计算机系统的可靠性是指从它开始运行（t=0）到某个时刻 t 这段时间内能正常运行的概率，用 R(t) 表示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">串联部件的可靠度 = 各部件的可靠度的乘积</span><br><span class="line">串联部件的可靠度 = 1 - 各部件失效率的乘积</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;25-04-06 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="面试" scheme="https://kiml.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="软考" scheme="https://kiml.github.io/categories/%E9%9D%A2%E8%AF%95/%E8%BD%AF%E8%80%83/"/>
    
    <category term="中级-软件设计师" scheme="https://kiml.github.io/categories/%E9%9D%A2%E8%AF%95/%E8%BD%AF%E8%80%83/%E4%B8%AD%E7%BA%A7-%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%B8%88/"/>
    
    
    <category term="软考中级" scheme="https://kiml.github.io/tags/%E8%BD%AF%E8%80%83%E4%B8%AD%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>SonarQube 与 GitLab 集成（二）</title>
    <link href="https://kiml.github.io/posts/6041b6ab/"/>
    <id>https://kiml.github.io/posts/6041b6ab/</id>
    <published>2025-04-11T06:24:36.000Z</published>
    <updated>2025-05-18T11:40:41.849Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>sonar 脚本之前一直在测试分支上跑，虽然有每次构建拉取事件很长的毛病，但影响不大还能忍受。最近把 sonar 上到 master 环境中，出现了大问题。。。</p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25-04-11 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="问题">问题</h2><ol><li class="lvl-3"><p>gitlab CI cancel 之后，后台 maven 子进程并没有被杀死，导致第二个 runner 服务依旧处于 pedding 状态。前台多次操作 cancel 并重启后，服务器资源直接耗尽，需要重启 sonar 所在的服务器才行。<mark>未解决</mark>（加了每次服务启动前关闭别的扫描服务，好像并没有什么用）</p></li><li class="lvl-3"><p>虽然之前添加了插件，但是没有使用 sonar 的 PR/MR 扫描模式，每次都是全量进行扫描，并且加上了 merge 阻断，导致每次都需要 merge 前等待，耗时较久。<mark>已解决</mark></p></li><li class="lvl-3"><p>sonar 的 webhook 要转发到飞书，之前偷懒没有写一个服务进行转发，导致卡片样式比较难看。<mark>已解决</mark></p></li></ol><h3 id="PR-MR-扫描模式">PR/MR 扫描模式</h3><blockquote><p>添加了这种扫描模式之后，由于新代码是与 master 分支进行比较，需要写一个定时的 ci 对 master 分支进行全量的扫描</p></blockquote><h4 id="gitlab-ci-yml"><code>.gitlab-ci.yml</code></h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span>  </span><br><span class="line">  <span class="bullet">-</span> <span class="string">sonarqube</span>  </span><br><span class="line">  <span class="bullet">-</span> <span class="string">noop</span>  </span><br><span class="line"><span class="attr">sonarqube-check:</span>  </span><br><span class="line">  <span class="attr">stage:</span> <span class="string">sonarqube</span>  </span><br><span class="line">  <span class="attr">tags:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonar</span>  </span><br><span class="line">  <span class="attr">variables:</span>  </span><br><span class="line">    <span class="attr">SONAR_USER_HOME:</span> <span class="string">&quot;$&#123;CI_PROJECT_DIR&#125;/.sonar&quot;</span>  <span class="comment"># Defines the location of the analysis task cache  </span></span><br><span class="line">    <span class="attr">GIT_DEPTH:</span> <span class="string">&quot;0&quot;</span>  <span class="comment"># Tells git to fetch all the branches of the project, required by the analysis task  </span></span><br><span class="line">  <span class="attr">cache:</span>  </span><br><span class="line">    <span class="attr">key:</span> <span class="string">sonar-cache</span>  </span><br><span class="line">    <span class="attr">paths:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">.sonar/cache</span>  </span><br><span class="line">  <span class="attr">before_script:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;检查并终止之前的 Maven 进程...&quot;</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">|  </span></span><br><span class="line"><span class="string">      # 查找并终止之前的 Maven 进程  </span></span><br><span class="line"><span class="string">      maven_pids=$(pgrep -f &quot;gitlab_sonarci_run&quot; || true)  </span></span><br><span class="line"><span class="string">      if [ -n &quot;$maven_pids&quot; ]; then  </span></span><br><span class="line"><span class="string">          echo &quot;发现之前的 Maven 进程，正在终止...&quot;  </span></span><br><span class="line"><span class="string">          echo &quot;$maven_pids&quot; | xargs kill -TERM || true  </span></span><br><span class="line"><span class="string">          echo &quot;$maven_pids &quot; | xargs wait || true  </span></span><br><span class="line"><span class="string">      else  </span></span><br><span class="line"><span class="string">          echo &quot;未发现之前的 Maven 进程。&quot;  </span></span><br><span class="line"><span class="string">      fi  </span></span><br><span class="line"><span class="string"></span>  <span class="attr">script:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">JAVA_HOME=你的服务地址</span> <span class="string">&amp;&amp;</span> <span class="string">export</span> <span class="string">JAVA_HOME</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">export</span> <span class="string">SONAR_JAVA_OPTS=&quot;-Xmx2G</span> <span class="string">-Xms1G&quot;</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">|  </span></span><br><span class="line"><span class="string">      echo &quot;启动 SonarQube 分析...&quot;  </span></span><br><span class="line"><span class="string">      run_scan() &#123;  </span></span><br><span class="line"><span class="string">        mvn verify sonar:sonar -T 2 \  </span></span><br><span class="line"><span class="string">        -Dsonar.projectKey=你的key \  </span></span><br><span class="line"><span class="string">        # 这部分数据会在 merge_request_event 时由 gitlab 进行填充</span></span><br><span class="line"><span class="string">        -Dsonar.pullrequest.key=$CI_MERGE_REQUEST_IID \  </span></span><br><span class="line"><span class="string">        -Dsonar.pullrequest.branch=$CI_COMMIT_REF_NAME \  </span></span><br><span class="line"><span class="string">        -Dsonar.pullrequest.base=$CI_MERGE_REQUEST_TARGET_BRANCH_NAME \  </span></span><br><span class="line"><span class="string">        -Dmaven.test.skip=true \  </span></span><br><span class="line"><span class="string">        -Dsonar.qualitygate.wait=true \  </span></span><br><span class="line"><span class="string">        -Dsonar.ce.parallel=1 \  </span></span><br><span class="line"><span class="string">        -Dmaven.repo.local=你的本地仓库 \  </span></span><br><span class="line"><span class="string">        -s 你的maven配置地址 \  </span></span><br><span class="line"><span class="string">        -Dci.tag=gitlab_sonarci_run &amp;  </span></span><br><span class="line"><span class="string">      &#125;  </span></span><br><span class="line"><span class="string">      run_scan  </span></span><br><span class="line"><span class="string"></span>  <span class="attr">allow_failure:</span> <span class="literal">false</span>  </span><br><span class="line">  <span class="attr">rules:</span>  </span><br><span class="line">    <span class="comment"># 如果 SKIP_SONAR 为 &quot;true&quot;，跳过任务  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$SKIP_SONAR == &quot;true&quot;&#x27;</span>  </span><br><span class="line">      <span class="attr">when:</span> <span class="string">never</span>  </span><br><span class="line">    <span class="comment"># 在合并请求时触发  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; &amp;&amp; $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == &quot;master&quot;&#x27;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="attr">noop:</span>  </span><br><span class="line">  <span class="attr">tags:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonar</span>  </span><br><span class="line">  <span class="attr">stage:</span> <span class="string">noop</span>  </span><br><span class="line">  <span class="attr">script:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Pipeline skipped all main jobs.&quot;</span>  </span><br><span class="line">  <span class="attr">rules:</span>  </span><br><span class="line">    <span class="comment"># 在合并请求时触发  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$CI_PIPELINE_SOURCE == &quot;merge_request_event&quot; &amp;&amp; $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == &quot;master&quot;&#x27;</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">sonarqube-master-daily:</span>  </span><br><span class="line">  <span class="attr">tags:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonar</span>  </span><br><span class="line">  <span class="attr">stage:</span> <span class="string">sonarqube</span>  </span><br><span class="line">  <span class="attr">script:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">JAVA_HOME=你的服务地址</span> <span class="string">&amp;&amp;</span> <span class="string">export</span> <span class="string">JAVA_HOME</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">export</span> <span class="string">SONAR_JAVA_OPTS=&quot;-Xmx2G</span> <span class="string">-Xms1G&quot;</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">|  </span></span><br><span class="line"><span class="string">      echo &quot;启动 SonarQube 分析...&quot;  </span></span><br><span class="line"><span class="string">      run_scan() &#123;  </span></span><br><span class="line"><span class="string">        mvn verify sonar:sonar -T 2 \  </span></span><br><span class="line"><span class="string">        -Dsonar.projectKey=你的key \  </span></span><br><span class="line"><span class="string">        -Dsonar.branch.name=master \  </span></span><br><span class="line"><span class="string">        -Dmaven.test.skip=true \  </span></span><br><span class="line"><span class="string">        -Dsonar.qualitygate.wait=true \  </span></span><br><span class="line"><span class="string">        -Dsonar.ce.parallel=1 \  </span></span><br><span class="line"><span class="string">        -Dmaven.repo.local=你的仓库地址 \  </span></span><br><span class="line"><span class="string">        -s 你的maven配置文件地址 \  </span></span><br><span class="line"><span class="string">        -Dci.tag=gitlab_sonarci_run &amp;  </span></span><br><span class="line"><span class="string">      &#125;  </span></span><br><span class="line"><span class="string">      run_scan  </span></span><br><span class="line"><span class="string"></span>  <span class="attr">rules:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$CI_COMMIT_BRANCH == &quot;master&quot; &amp;&amp; $CI_PIPELINE_SOURCE == &quot;schedule&quot;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="定时-ci-添加">定时 ci 添加</h4><blockquote><p>gitlab 定时 CI 会去扫 master 下的 <code>.gitlab-ci.yml</code> 文件，</p></blockquote><h3 id="webhook-转发">webhook 转发</h3><blockquote><p>node.js 代码地址：<a class="link"   href="https://github.com/kiml-rgb/sonar-feishu-webhook.git" >https://github.com/kiml-rgb/sonar-feishu-webhook.git<i class="fas fa-external-link-alt"></i></a></p></blockquote><ol><li class="lvl-3"><p><strong>创建一个中间服务</strong>（建议使用 Spring Boot 或 Node.js）监听 SonarQube Webhook。</p></li><li class="lvl-3"><p>接收到 Webhook 后，解析 payload，构造上面的卡片格式 JSON。</p></li><li class="lvl-3"><p><strong>将卡片格式消息 POST 到飞书机器人地址</strong></p></li></ol><h4 id="项目结构">项目结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sonar-feishu-webhook/</span><br><span class="line">├── app.js</span><br><span class="line">├── feishu.js</span><br><span class="line">├── Dockerfile</span><br><span class="line">├── package.json</span><br><span class="line">└── .env</span><br></pre></td></tr></table></figure><h4 id="部署">部署</h4><ol><li class="lvl-3"><p>项目文件准备</p></li><li class="lvl-3"><p>构建镜像</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t sonar-webhook-feishu .</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>运行容器</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name sonar-feishu \</span><br><span class="line">  -p 9999:3000 \</span><br><span class="line">  --env-file .env \</span><br><span class="line">sonar-webhook-feishu</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>在 SonarQube 后台 Webhook 中配置</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">your-address/webhook/sonar</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;sonar 脚本之前一直在测试分支上跑，虽然有每次构建拉取事件很长的毛病，但影响不大还能忍受。最近把 sonar 上到 master 环境中，出现了大问题。。。&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;25-04-11 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="准备工作" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"/>
    
    
    <category term="GitLab" scheme="https://kiml.github.io/tags/GitLab/"/>
    
    <category term="SonarQube" scheme="https://kiml.github.io/tags/SonarQube/"/>
    
  </entry>
  
  <entry>
    <title>Let’s Encrypt 免费申请泛域名 SSL 证书，并实现自动续期</title>
    <link href="https://kiml.github.io/posts/a1d28c6/"/>
    <id>https://kiml.github.io/posts/a1d28c6/</id>
    <published>2025-04-07T10:10:18.000Z</published>
    <updated>2025-05-18T11:40:41.849Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>参考文章：<a class="link"   href="https://www.cnblogs.com/michaelshen/p/18538178" >使用 Let’s Encrypt 免费申请泛域名 SSL 证书，并实现自动续期<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25-04-07 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="环境准备">环境准备</h2><ul class="lvl-0"><li class="lvl-2"><p>一台可以访问互联网的服务器（Linux 环境，如 Ubuntu/CentOS）。</p></li><li class="lvl-2"><p><strong>Root</strong> 权限或 <code>sudo</code> 权限。</p></li><li class="lvl-2"><p>一个已解析的域名（本文以 <code>example.com</code> 为例）。</p></li></ul><h2 id="Certbot-自动安装"><a class="link"   href="https://certbot.eff.org/" >Certbot<i class="fas fa-external-link-alt"></i></a> 自动安装</h2><ol><li class="lvl-3"><p>选择安装环境<br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z25/04/Snipaste_2025-04-07_18-18-56.png"                        alt=""                 ></p></li><li class="lvl-3"><p>Install system dependencies<br>For APT-based distributions (e.g. Debian, Ubuntu …):</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install python3 python3-venv libaugeas0</span><br></pre></td></tr></table></figure><p>For RPM-based distributions (e.g. Fedora, CentOS …):</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install python3 augeas-libs</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>Remove certbot-auto and any Certbot OS packages</p></li><li class="lvl-3"><p>Set up a Python virtual environment</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 -m venv /opt/certbot/</span><br><span class="line">sudo /opt/certbot/bin/pip install --upgrade pip</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>Install Certbot</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /opt/certbot/bin/pip install certbot certbot-nginx</span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p>Prepare the Certbot command</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /opt/certbot/bin/certbot /usr/bin/certbot</span><br></pre></td></tr></table></figure><h2 id="申请单域名-SSL-证书">申请单域名 SSL 证书</h2><ol><li class="lvl-3"><p>Choose how you’d like to run Certbot</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手动配置 nginx</span></span><br><span class="line">sudo certbot certonly --nginx</span><br></pre></td></tr></table></figure><blockquote><p>这里获取 nginx 默认的配置位置在 /etc/nginx。可以为自己安装完成的 nginx 创建软链到此目录下</p></blockquote><ol start="2"><li class="lvl-3"><p>sudo certbot certonly --nginx</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;0 0,12 * * * root /opt/certbot/bin/python -c &#x27;import random; import time; time.sleep(random.random() * 3600)&#x27; &amp;&amp; sudo certbot renew -q&quot; | sudo tee -a /etc/crontab &gt; /dev/null</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>Confirm that Certbot worked</p></li></ol>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;参考文章：&lt;a class=&quot;link&quot;   href=&quot;https://www.cnblogs.com/michaelshen/p/18538178&quot; &gt;使用 Let’s Encrypt 免费申请泛域名 SSL 证书，并实现自动续期&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;25-04-07 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="准备工作" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"/>
    
    
  </entry>
  
  <entry>
    <title>【代码模板】Nginx</title>
    <link href="https://kiml.github.io/posts/bc551f67/"/>
    <id>https://kiml.github.io/posts/bc551f67/</id>
    <published>2025-03-24T08:23:03.000Z</published>
    <updated>2025-05-18T11:40:41.582Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>Nginx 常用模板</p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25-03-24 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="简单项目模板">简单项目模板</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">user root;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    client_max_body_size 500M;</span><br><span class="line">    # HTTP server block, redirect to HTTPS 此部分内容可以由证书网站生成</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  sxqxyyl.cn www.sxqxyyl.cn;</span><br><span class="line"></span><br><span class="line">        # Redirect HTTP to HTTPS</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # HTTPS server block</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       443 ssl;</span><br><span class="line">        server_name  sxqxyyl.cn www.sxqxyyl.cn;</span><br><span class="line"></span><br><span class="line">        # SSL certificate and key</span><br><span class="line">        # SSL 相关内容可以由证书网站生成</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root  /root/frontend/dist;</span><br><span class="line">            index   index.html index.htm;  # 确保这是您的网站根目录</span><br><span class="line">            try_files $uri $uri/ /index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"># 前端访问路径配置为 /api</span><br><span class="line">        location /api/ &#123;</span><br><span class="line">            rewrite ^/api/(.*)$ /$1 break;  # 确保路径被重写为后端应用需要的格式</span><br><span class="line">            proxy_pass http://127.0.0.1:8888/;  # 将请求转发到后端服务</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /minio/ &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:9000/;  # MinIO 运行在 HTTP 9000 端口</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # Error pages for 500, 502, 503, 504</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root  /root/frontend/dist;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;Nginx 常用模板&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;25-03-24 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="准备工作" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"/>
    
    
    <category term="Nginx" scheme="https://kiml.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Activiti7 + dynamic-datasource 多数据源配置</title>
    <link href="https://kiml.github.io/posts/2dbd20ab/"/>
    <id>https://kiml.github.io/posts/2dbd20ab/</id>
    <published>2025-03-03T03:23:07.000Z</published>
    <updated>2025-04-07T09:49:48.715Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>之前数据库不涉及多数据源的问题，本次引入 Activiti7 后需要配置单独的数据源。网上的方法都是自己写 bean 注入，然后在 SpringProcessEngineConfiguration 内进行 set 操作，但是出现了很大的问题。。。</p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25-03-03 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="问题">问题</h2><p>原参考文章如下：<a class="link"   href="https://blog.csdn.net/qq_20391065/article/details/89475435" >SpringBoot 给 Activiti7 配置单独数据源<i class="fas fa-external-link-alt"></i></a>。</p><p>根据文章配置，出现了原来配置的其他数据源失效，原先的事物注解 <code>@Transactional</code> 失效等问题。</p><h2 id="原因">原因</h2><p>具体原因不清楚，目前只知道 <code>@Bean</code> 配置 <code>PlatformTransactionManager</code> 和 <code>DataSource</code> 会导致 dynamic-datasource 配置的默认数据源失效。</p><h2 id="解决">解决</h2><p>从 <code>DynamicDataSourceProvider</code> 获取数据源并构建事物管理，具体配置信息如下。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivitiDataSourceConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractProcessEngineAutoConfiguration</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Resource</span>  </span><br><span class="line">    <span class="keyword">private</span> DynamicDataSourceProvider dynamicDataSourceProvider;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span>  </span><br><span class="line">    <span class="keyword">public</span> SpringProcessEngineConfiguration <span class="title function_">springProcessEngineConfiguration</span><span class="params">(ActivitiProperties activitiProperties)</span> &#123;  </span><br><span class="line">        <span class="type">SpringProcessEngineConfiguration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringProcessEngineConfiguration</span>();  </span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> dynamicDataSourceProvider.loadDataSources().get(DBConstants.DATASOURCE_WORKFLOW);  </span><br><span class="line">        conf.setDataSource(dataSource);  </span><br><span class="line">        conf.setTransactionManager(<span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>(dataSource));  </span><br><span class="line">        conf.setDeploymentName(activitiProperties.getDeploymentName());  </span><br><span class="line">        conf.setDatabaseSchema(activitiProperties.getDatabaseSchema());  </span><br><span class="line">        conf.setDatabaseSchemaUpdate(activitiProperties.getDatabaseSchemaUpdate());  </span><br><span class="line">        conf.setDbHistoryUsed(activitiProperties.isDbHistoryUsed());  </span><br><span class="line">        conf.setAsyncExecutorActivate(activitiProperties.isAsyncExecutorActivate());  </span><br><span class="line">        <span class="keyword">if</span> (!activitiProperties.isAsyncExecutorActivate()) &#123;  </span><br><span class="line">            <span class="type">ValidatorSet</span> <span class="variable">springBootStarterValidatorSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ValidatorSet</span>(<span class="string">&quot;activiti-spring-boot-starter&quot;</span>);  </span><br><span class="line">            springBootStarterValidatorSet.addValidator(<span class="keyword">new</span> <span class="title class_">AsyncPropertyValidator</span>());  </span><br><span class="line">            <span class="keyword">if</span> (conf.getProcessValidator() == <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="type">ProcessValidatorImpl</span> <span class="variable">processValidator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessValidatorImpl</span>();  </span><br><span class="line">                processValidator.addValidatorSet(springBootStarterValidatorSet);  </span><br><span class="line">                conf.setProcessValidator(processValidator);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                conf.getProcessValidator().getValidatorSets().add(springBootStarterValidatorSet);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        conf.setMailServerHost(activitiProperties.getMailServerHost());  </span><br><span class="line">        conf.setMailServerPort(activitiProperties.getMailServerPort());  </span><br><span class="line">        conf.setMailServerUsername(activitiProperties.getMailServerUserName());  </span><br><span class="line">        conf.setMailServerPassword(activitiProperties.getMailServerPassword());  </span><br><span class="line">        conf.setMailServerDefaultFrom(activitiProperties.getMailServerDefaultFrom());  </span><br><span class="line">        conf.setMailServerUseSSL(activitiProperties.isMailServerUseSsl());  </span><br><span class="line">        conf.setMailServerUseTLS(activitiProperties.isMailServerUseTls());  </span><br><span class="line">  </span><br><span class="line">        conf.setHistoryLevel(activitiProperties.getHistoryLevel());  </span><br><span class="line">        conf.setCopyVariablesToLocalForTasks(activitiProperties.isCopyVariablesToLocalForTasks());  </span><br><span class="line">        conf.setSerializePOJOsInVariablesToJson(activitiProperties.isSerializePOJOsInVariablesToJson());  </span><br><span class="line">        conf.setJavaClassFieldForJackson(activitiProperties.getJavaClassFieldForJackson());  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (activitiProperties.getCustomMybatisMappers() != <span class="literal">null</span>) &#123;  </span><br><span class="line">            conf.setCustomMybatisMappers(getCustomMybatisMapperClasses(activitiProperties.getCustomMybatisMappers()));  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (activitiProperties.getCustomMybatisXMLMappers() != <span class="literal">null</span>) &#123;  </span><br><span class="line">            conf.setCustomMybatisXMLMappers(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(activitiProperties.getCustomMybatisXMLMappers()));  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (activitiProperties.getCustomMybatisXMLMappers() != <span class="literal">null</span>) &#123;  </span><br><span class="line">            conf.setCustomMybatisXMLMappers(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(activitiProperties.getCustomMybatisXMLMappers()));  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (activitiProperties.isUseStrongUuids()) &#123;  </span><br><span class="line">            conf.setIdGenerator(<span class="keyword">new</span> <span class="title class_">StrongUuidGenerator</span>());  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (activitiProperties.getDeploymentMode() != <span class="literal">null</span>) &#123;  </span><br><span class="line">            conf.setDeploymentMode(activitiProperties.getDeploymentMode());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> conf;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;之前数据库不涉及多数据源的问题，本次引入 Activiti7 后需要配置单独的数据源。网上的方法都是自己写 bean 注入，然后在 SpringProcessEngineConfiguration 内进行 set 操作，但是出现了很大的问题。。。&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;25-03-03 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="bug记录" scheme="https://kiml.github.io/categories/bug%E8%AE%B0%E5%BD%95/"/>
    
    <category term="2025" scheme="https://kiml.github.io/categories/bug%E8%AE%B0%E5%BD%95/2025/"/>
    
    
    <category term="Java" scheme="https://kiml.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>社区中老年志愿者平台</title>
    <link href="https://kiml.github.io/posts/25cfff2e/"/>
    <id>https://kiml.github.io/posts/25cfff2e/</id>
    <published>2025-02-02T07:13:08.000Z</published>
    <updated>2025-04-07T15:16:48.241Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>本项目主要记录自接外包项目需要注意的点。项目 git 地址：<a class="link"   href="https://gitee.com/kiml_rgb/silver-volunteer.git" >https://gitee.com/kiml_rgb/silver-volunteer.git<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25-02-02 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="项目概述">项目概述</h2><p>单体项目，分为小程序端和后台管理部分。本项目相关笔记<strong>主要用于记录对接外包项目需要注意的要点</strong>。</p><h2 id="技术栈">技术栈</h2><table><thead><tr><th>层级</th><th>技术</th></tr></thead><tbody><tr><td>视图</td><td>小程序、Vue</td></tr><tr><td>组件</td><td>Spring boot、Log4j2、Mybatis Plus</td></tr><tr><td>基础设施</td><td>Mysql、Minio</td></tr><tr><td>DevOps</td><td>Maven、Git</td></tr></tbody></table><h2 id="准备">准备</h2><h3 id="收费">收费</h3><table><thead><tr><th>项目</th><th>计费标准</th></tr></thead><tbody><tr><td>阿里云服务器</td><td>按阿里云报价信息（新人首年有折扣）</td></tr><tr><td>域名</td><td>一年一续费</td></tr><tr><td>小程序认证费用</td><td>每年 300</td></tr><tr><td>开发费用</td><td></td></tr></tbody></table><h3 id="时间">时间</h3><table><thead><tr><th>项目</th><th>时间</th><th>备注</th></tr></thead><tbody><tr><td>小程序备案</td><td>3 day</td><td>企业资质</td></tr><tr><td>小程序后台备案（服务器域名备案）</td><td>3 day</td><td>个人资质，与小程序备案资质可以不同，只需要后台可以访问</td></tr><tr><td>阿里云短信资质审核</td><td>1 day</td><td>阿里云实名为个人，审核资质为自用</td></tr><tr><td>阿里云短信签名审核（试用）</td><td>2 hour</td><td>自用资质在没有备案网站/上线 App 的情况下只能选择线上试用，线上试用短信有限制</td></tr><tr><td>阿里云短信签名审核（已备案网站）</td><td>7-10 day</td><td>目前运营商实名报备流程平均需要 5-7 个工作日，部分运营商可能延长至<strong>7-10 个工作日</strong>。</td></tr><tr><td>阿里云短信模板审核</td><td>2 hour</td><td></td></tr><tr><td>域名注册</td><td></td><td>信息模板 实名认证</td></tr></tbody></table><h3 id="服务器">服务器</h3><ol><li class="lvl-3"><p>前后端项目</p></li><li class="lvl-3"><p>Java 环境、MySQL 环境、Redis 环境</p></li><li class="lvl-3"><p>文件存储服务（例：Minio）、docker 环境</p></li></ol><blockquote><p>内链：[[装机-软件安装（Linux）]]<br>外链：<a class="link"   href="https://kiml.site/posts/89b09b58/" >装机-软件安装（Linux）<i class="fas fa-external-link-alt"></i></a></p></blockquote><ol start="4"><li class="lvl-3"><p>nginx</p></li></ol><blockquote><p>内链：[[【代码模板】Nginx]]<br>外链：<a href="">【代码模板】Nginx</a></p></blockquote><ol start="5"><li class="lvl-3"><p>ssl 证书</p></li></ol><blockquote><p>内链：[[Let’s Encrypt 免费申请泛域名 SSL 证书，并实现自动续期]]<br>外链：<a href="">Let’s Encrypt 免费申请泛域名 SSL 证书，并实现自动续期</a></p></blockquote><h2 id="BUG">BUG</h2><h3 id="emoji-表情保存报错">emoji 表情保存报错</h3>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;本项目主要记录自接外包项目需要注意的点。项目 git 地址：&lt;a class=&quot;link&quot;   href=&quot;https://gitee.com/kiml_rgb/silver-volunteer.git&quot; &gt;https://gitee.com/kiml_rgb/silver-volunteer.git&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;25-02-02 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="其他项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E5%85%B6%E4%BB%96%E9%A1%B9%E7%9B%AE/"/>
    
    
  </entry>
  
  <entry>
    <title>Docker拉取失败</title>
    <link href="https://kiml.github.io/posts/4512ff84/"/>
    <id>https://kiml.github.io/posts/4512ff84/</id>
    <published>2024-12-12T14:27:28.000Z</published>
    <updated>2024-12-15T12:04:42.189Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>参考文章：<a class="link"   href="https://blog.csdn.net/2301_79849395/article/details/142829852" >彻底解决docker：docker: Get https://registry-1.docker.io/v2/: net/http: request canceled 报错<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24-12-12 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="问题">问题</h2><p>docker配置了镜像，拉取失败。报错信息：<code>ERROR: Get &quot;https://registry-1.docker.io/v2/&quot;: net/http: request canceled while waiting for connection</code></p><h2 id="原因">原因</h2><p>镜像地址失效。</p><h2 id="解决">解决</h2><h3 id="换源">换源</h3><blockquote><p>本次未使用，需要换源重启，但是原docker中含有跳板机，需要跳板机才能连接上服务器，重启会导致跳板机连接失败。</p></blockquote><ol><li class="lvl-3"><p>修改 <code>/etc/docker/daemon.json</code>文件</p></li><li class="lvl-3"><p>加入镜像配置</p></li><li class="lvl-3"><p>重启</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload   </span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="修改DNS服务配置">修改DNS服务配置</h3><blockquote><p>未使用</p></blockquote><h3 id="手动拉取">手动拉取</h3><blockquote><p>解决。需要注意的是手动拉取后，使用docker-compose进行部署，需要填写拉取的镜像（加上仓库名），不然依旧会从原地址拉取</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull 仓库名/镜像名:版本号</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">暂时可用的一个仓库</span></span><br><span class="line">docker.m.daocloud.io</span><br></pre></td></tr></table></figure><h3 id="给docker配置一个代理">给docker配置一个代理</h3><blockquote><p>未使用。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;参考文章：&lt;a class=&quot;link&quot;   href=&quot;https://blog.csdn.net/2301_79849395/article/details/142829852&quot; &gt;彻底解决docker：docker: Get https://registry-1.docker.io/v2/: net/http: request canceled 报错&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-12-12 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="bug记录" scheme="https://kiml.github.io/categories/bug%E8%AE%B0%E5%BD%95/"/>
    
    <category term="2024" scheme="https://kiml.github.io/categories/bug%E8%AE%B0%E5%BD%95/2024/"/>
    
    
    <category term="docker" scheme="https://kiml.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>SonarQube与GitLab集成（一）</title>
    <link href="https://kiml.github.io/posts/7d0e1c35/"/>
    <id>https://kiml.github.io/posts/7d0e1c35/</id>
    <published>2024-12-11T09:22:07.000Z</published>
    <updated>2025-04-11T06:27:05.149Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>最近比较闲，分配了这个任务，顺便做个笔记。更新第二版方案，更适合生产环境。</p></li><li class="lvl-2"><p>参考文章<br><a class="link"   href="https://blog.linxiaodong.com/blog/gitlab-ci-with-sonarQube" >在 gitlab ci/cd 流程中集成 sonar 进行自动 Code Review<i class="fas fa-external-link-alt"></i></a><br><a class="link"   href="https://www.cnblogs.com/scajy/p/15661187.html" >gitlab Runner 安装与部署<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">24-12-11 初始记录</span><br><span class="line">24-12-12 完成SonarQube与插件的安装</span><br><span class="line">24-12-16 maven 与 多模块项目</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="准备工作">准备工作</h2><ol><li class="lvl-3"><p><a class="link"   href="https://docs.sonarsource.com/sonarqube-server/latest/setup-and-upgrade/pre-installation/linux/" >SonarQube<i class="fas fa-external-link-alt"></i></a>：选择适合项目的 SonarQube 版本。~<s><mark>Java8 适配的 SonarQube 版本最高为 7.8</mark></s>~。这里部署的是： docker 方式的 9.9 LTS 版本<em>官方长期支持版本</em>。</p></li><li class="lvl-3"><p>GitLab：14.9.1 版本</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以通过以下命令查看</span></span><br><span class="line">cat /opt/gitlab/embedded/service/gitlab-rails/VERSION</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>docker：Docker version 20.10.17, build 100c701。<mark>官方推荐版本 20.10 以上。</mark></p></li><li class="lvl-3"><p>Gitlab CI</p></li><li class="lvl-3"><p>SonarScanner/Maven + Java 11</p></li></ol><h3 id="SonarQube-安装">SonarQube 安装</h3><ol><li class="lvl-3"><p><code>docker-compose.yml</code></p></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">sonarqube:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sonarqube:9.9-community</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SONAR_JDBC_URL:</span> <span class="string">jdbc:postgresql://db:5432/sonar</span></span><br><span class="line">      <span class="attr">SONAR_JDBC_USERNAME:</span> <span class="string">sonar</span></span><br><span class="line">      <span class="attr">SONAR_JDBC_PASSWORD:</span> <span class="string">sonar</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sonarqube_data:/opt/sonarqube/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sonarqube_extensions:/opt/sonarqube/extensions</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sonarqube_logs:/opt/sonarqube/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sonarqube_conf:/opt/sonarqube/conf</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:15.3</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">sonar</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">sonar</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">postgresql:/var/lib/postgresql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">postgresql_data:/var/lib/postgresql/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">sonarqube_data:</span></span><br><span class="line"><span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sonarqube_extensions:</span></span><br><span class="line"><span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sonarqube_logs:</span></span><br><span class="line"><span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sonarqube_conf:</span></span><br><span class="line"><span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">postgresql:</span></span><br><span class="line">  <span class="attr">postgresql_data:</span></span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>docker-compose 命令</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">前台启动, 启动项目中的所有服务。</span></span><br><span class="line">docker-compose up</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后台启动, 启动所有服务并在后台运行。</span> </span><br><span class="line">docker-compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-f 指定使用的Compose模板文件，默认为docker-compose.yml，可以多次指定</span></span><br><span class="line">docker-compose -f docker-compose.yml up -d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出项目中目前的所有容器</span></span><br><span class="line">docker-compose ps</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止所有服务。</span></span><br><span class="line">docker-compose stop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止和删除容器、网络、卷、镜像。</span></span><br><span class="line">docker-compose down</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除已经在compose文件中定义的和匿名的附在容器上的数据卷</span></span><br><span class="line">docker-compose down -v</span><br></pre></td></tr></table></figure><h3 id="SonarQube-插件安装">SonarQube 插件安装</h3><p>SonarQube 有两个插件：</p><ul class="lvl-0"><li class="lvl-2"><p><a class="link"   href="https://github.com/javamachr/sonar-gitlab-plugin" >https://github.com/javamachr/sonar-gitlab-plugin<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-2"><p><a class="link"   href="https://github.com/mc1arke/sonarqube-community-branch-plugin" >https://github.com/mc1arke/sonarqube-community-branch-plugin<i class="fas fa-external-link-alt"></i></a><br>第一个插件可以将 <code>SonarQube</code> 的审查结果以评论的试发布到 gitlab 上面。<mark>暂未使用</mark>第二个插件可以实现增强 <code>SonarQube</code> 多分支包括 MR 的代码检测。</p></li></ul><ol><li class="lvl-3"><p>下载 sonar-gitlab-plugin 对应 5.4 版本的 jar 包</p></li><li class="lvl-3"><p>下载 sonarqube-community-branch-plugin 对应 1.14.0 的 jar 包</p></li><li class="lvl-3"><p>上传 jar 包到挂载的 <code>sonarqube_extensions</code> 目录里面的 <code>plugins</code> 目录里面。上传到 JumpServer 可以在目录下输入：<code>rz</code>；下载为 <code>sz</code></p></li><li class="lvl-3"><p>修改挂载的 <code>sonarqube_conf</code> 目录路径下面的 <code>sonar.properties</code> 配置文件，添加如下配置</p></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sonar.web.javaAdditionalOpts</span>=<span class="string">-javaagent:./extensions/plugins/sonarqube-community-branch-plugin-1.14.0.jar=web</span></span><br><span class="line"><span class="attr">sonar.ce.javaAdditionalOpts</span>=<span class="string">-javaagent:./extensions/plugins/sonarqube-community-branch-plugin-1.14.0.jar=ce</span></span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>重启 SonarQube</p></li></ol><h3 id="Gitlab-CI-安装与注册">Gitlab CI 安装与注册</h3><ol><li class="lvl-3"><p>版本确认<br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-15_17-50-00.png"                        alt=""                 ><br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-15_17-50-59.png"                        alt=""                 ></p></li><li class="lvl-3"><p>安装与 Gitlab 一致的 Gitlab-Runner 版本。</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7/gitlab-runner-14.9.0-1.x86_64.rpm --no-check-certificate</span><br><span class="line"></span><br><span class="line">sudo rpm -ivh gitlab-runner-14.9.0-1.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看是否安装成功</span></span><br><span class="line">gitlab-runner -v</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>指定 gitlab-runner 用户为 root 用户</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-runner uninstall </span><br><span class="line"></span><br><span class="line">sudo gitlab-runner install --working-directory /home/zwadmin --user zwadmin</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>启动 gitlab 服务</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">/bin/systemctl start gitlab-runner</span><br><span class="line"></span><br><span class="line">/bin/systemctl enable gitlab-runner</span><br><span class="line"></span><br><span class="line">/bin/systemctl restart gitlab-runner</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>设置权限</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R zwadmin.zwadmin /home/gitlab-runner</span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p>注册服务</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner register</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入公司的gitlab公网地址</span> </span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/): https://gitlab.wuidm.com/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入gitlab的token</span> </span><br><span class="line">Please enter the gitlab-ci token for this runner: </span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入描述这个runner名称</span> </span><br><span class="line">Please enter the gitlab-ci description for this runner: [k8s-node02]: </span><br><span class="line">test</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入runner的标签</span> </span><br><span class="line">Please enter the gitlab-ci tags for this runner (comma separated): </span><br><span class="line">my-tag,another-tag </span><br><span class="line">Registering runner... succeeded runner=8sjydnrs </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入runner执行器的环境</span> </span><br><span class="line">Please enter the executor: custom, docker-ssh, parallels, kubernetes, docker-ssh+machine, docker, shell, ssh, virtualbox, docker+machine: </span><br><span class="line">shell </span><br></pre></td></tr></table></figure><p><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/image-20241215192203774.png"                        alt="token位置"                 ></p><h3 id="SonarScanner-安装">SonarScanner 安装</h3><blockquote><p>多模块项目建议用 Maven，这部分可以不看</p></blockquote><ol><li class="lvl-3"><p><a class="link"   href="https://docs.sonarsource.com/sonarqube-server/latest/analyzing-source-code/scanners/sonarscanner/" >官网下载<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-3"><p>上传服务器后，解压</p></li><li class="lvl-3"><p>配置环境变量</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加以下语句</span></span><br><span class="line">export SONARRUNNER_HOME=/home/zwadmin/soft/sonar-scanner/sonar-scanner-6.2.1.4610-linux-x64</span><br><span class="line">export PATH=$SONARRUNNER_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line">sudo source /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看是否安装成功</span></span><br><span class="line">sonar-scanner -v</span><br></pre></td></tr></table></figure><h3 id="Maven-安装">Maven 安装</h3><blockquote><p>Maven 更适配多模块项目</p></blockquote><ol><li class="lvl-3"><p><a class="link"   href="https://maven.apache.org/download.cgi" >官网下载<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-3"><p>上传服务器后，解压</p></li><li class="lvl-3"><p>配置环境变量</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加以下语句</span></span><br><span class="line">export M2_HOME=/opt/maven </span><br><span class="line">export PATH=$M2_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看是否安装成功</span></span><br><span class="line">mvn -v</span><br></pre></td></tr></table></figure><h2 id="与-Gitlab-集成">与 Gitlab 集成</h2><ol><li class="lvl-3"><p>登录 <a class="link"   href="http://gitlab.com" >gitlab.com<i class="fas fa-external-link-alt"></i></a>，创建一个测试仓库，并在用户设置里面，创建一个个人访问令牌。<br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-15_16-56-59.png"                        alt=""                 ></p></li><li class="lvl-3"><p>登录 SonarQube，在 project 管理里面即可通过这个个人访问令牌来导入 gitlab 上面的项目<br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/pQ5FPu_20240508_tigfcJ.png"                        alt=""                 ></p></li><li class="lvl-3"><p>导入后，选择以 gitlab ci 的方式来执行 ci 流程<em>前提 gitlab ci 开启</em><br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-15_17-06-08.png"                        alt="|500"                 ></p></li><li class="lvl-3"><p>根据提示，完成所有步骤。</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p>在项目中创建 <code>sonar-project.properties</code>， 并粘贴提示内的内容。<mark>多分支指定分支需要下载 sonarqube-community-branch-plugin 插件。额外添加 sonar.branch.name=XXX</mark><br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-15_17-07-49.png"                        alt=""                 ></p></li><li class="lvl-2"><p>在 gitlab 的设置， CI/CD 设置里面，添加环境变量</p></li><li class="lvl-2"><p>在项目里面创建一个 <code>.gitlab-ci.yml</code> 文件，并按照提示贴入最小化配置内容</p></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sonarqube-check:</span>  </span><br><span class="line">  <span class="attr">tags:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">test</span>  </span><br><span class="line">  <span class="attr">variables:</span>  </span><br><span class="line">    <span class="attr">SONAR_USER_HOME:</span> <span class="string">&quot;$&#123;CI_PROJECT_DIR&#125;/.sonar&quot;</span>  <span class="comment"># Defines the location of the analysis task cache  </span></span><br><span class="line">    <span class="attr">GIT_DEPTH:</span> <span class="string">&quot;0&quot;</span>  <span class="comment"># Tells git to fetch all the branches of the project, required by the analysis task  </span></span><br><span class="line">  <span class="attr">cache:</span>  </span><br><span class="line">    <span class="attr">key:</span> <span class="string">&quot;$&#123;CI_JOB_NAME&#125;&quot;</span>  </span><br><span class="line">    <span class="attr">paths:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">.sonar/cache</span>  </span><br><span class="line">  <span class="attr">script:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonar-scanner</span>  </span><br><span class="line">  <span class="attr">allow_failure:</span> <span class="literal">true</span>  </span><br><span class="line">  <span class="attr">only:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span>  </span><br><span class="line"><span class="comment">#    - merge_requests  </span></span><br><span class="line"><span class="comment">#    - develop</span></span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>在 SonarQube 的通用配置里面，配置好 base URL， 以方便在 gitlab 的评论里面能够正确连接到 SonarQube 平台。<br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-15_17-15-50.png"                        alt=""                 ></p></li></ol><h2 id="使用-Maven-与-Gitlab-集成">使用 Maven 与 Gitlab 集成</h2><blockquote><p>Maven 更适配多模块项目，1、2、3、5 步骤相同，4 配置如下</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>在父项目 pom.xml 文件中添加配置</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sonar.qualitygate.wait</span>&gt;</span>true<span class="tag">&lt;/<span class="name">sonar.qualitygate.wait</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.sonarsource.scanner.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sonar-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.11.0.3922<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>在 gitlab 的设置， CI/CD 设置里面，添加环境变量</p></li><li class="lvl-2"><p>在项目里面创建一个 <code>.gitlab-ci.yml</code> 文件，并按照提示贴入最小化配置内容</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sonarqube-check:</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonar</span></span><br><span class="line">  <span class="attr">variables:</span></span><br><span class="line">    <span class="attr">SONAR_USER_HOME:</span> <span class="string">&quot;$&#123;CI_PROJECT_DIR&#125;/.sonar&quot;</span>  <span class="comment"># Defines the location of the analysis task cache</span></span><br><span class="line">    <span class="attr">GIT_DEPTH:</span> <span class="string">&quot;0&quot;</span>  <span class="comment"># Tells git to fetch all the branches of the project, required by the analysis task</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">&quot;$&#123;CI_JOB_NAME&#125;&quot;</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.sonar/cache</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">JAVA_HOME=/home/zwadmin/data/jdk-11/</span> <span class="string">&amp;&amp;</span> <span class="string">export</span> <span class="string">JAVA_HOME</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">verify</span> <span class="string">sonar:sonar</span> <span class="string">-Dsonar.projectKey=com.ydm:zw-ydm</span> <span class="string">-Dsonar.branch.name=feature/sonar-1216</span></span><br><span class="line">  <span class="attr">allow_failure:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">feature/sonar-1216</span></span><br><span class="line"><span class="comment">#    - merge_requests</span></span><br></pre></td></tr></table></figure><h2 id="整合-IDEA-插件">整合 IDEA 插件</h2><blockquote><p>用于同步服务器上的规则、质量配置文件和文件排除设置。</p></blockquote><ol><li class="lvl-3"><p>创建 token 类型为用户<br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-19_16-29-42.png"                        alt="|800"                 ></p></li><li class="lvl-3"><p>IDEA Plugins Marketplace 下载 SonarQube for IDE。</p></li><li class="lvl-3"><p>连接到 SonarQube。<br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-19_16-33-19.png"                        alt="|800"                 ><br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/Snipaste_2024-12-19_16-34-52.png"                        alt="|800"                 ></p></li><li class="lvl-3"><p>配置项目<br><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/12/537f5bb5-2e02-414b-a4b6-9f76ab01114c.png"                        alt="|800"                 ></p></li></ol><h2 id="完整版-gitlab-ci-yml">完整版 <code>.gitlab-ci.yml</code></h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span>  </span><br><span class="line">  <span class="bullet">-</span> <span class="string">sonarqube</span>  </span><br><span class="line">  <span class="bullet">-</span> <span class="string">notify</span>  </span><br><span class="line">  <span class="bullet">-</span> <span class="string">noop</span>  </span><br><span class="line"><span class="attr">sonarqube-check:</span>  </span><br><span class="line">  <span class="attr">stage:</span> <span class="string">sonarqube</span>  </span><br><span class="line">  <span class="attr">tags:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonar</span>  </span><br><span class="line">  <span class="attr">variables:</span>  </span><br><span class="line">    <span class="attr">SONAR_USER_HOME:</span> <span class="string">&quot;$&#123;CI_PROJECT_DIR&#125;/.sonar&quot;</span>  <span class="comment"># Defines the location of the analysis task cache  </span></span><br><span class="line">    <span class="attr">GIT_DEPTH:</span> <span class="string">&quot;0&quot;</span>  <span class="comment"># Tells git to fetch all the branches of the project, required by the analysis task  </span></span><br><span class="line">  <span class="attr">cache:</span>  </span><br><span class="line">    <span class="attr">key:</span> <span class="string">&quot;$&#123;CI_COMMIT_REF_NAME&#125;&quot;</span> <span class="comment"># 使用分支名作为缓存的 key    paths:  </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.sonar/cache</span>  </span><br><span class="line">  <span class="attr">script:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">JAVA_HOME=***</span> <span class="string">&amp;&amp;</span> <span class="string">export</span> <span class="string">JAVA_HOME</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">export</span> <span class="string">SONAR_JAVA_OPTS=&quot;-Xmx2G</span> <span class="string">-Xms1G&quot;</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">verify</span> <span class="string">sonar:sonar</span> <span class="string">-T</span> <span class="number">10</span> <span class="string">-Dsonar.projectKey=</span> <span class="string">-Dsonar.branch.name=master</span> <span class="string">-Dmaven.test.skip=true</span> <span class="string">-Dsonar.qualitygate.wait=false</span> <span class="string">-Dsonar.ce.parallel=1</span> <span class="string">-Dmaven.repo.local=***</span></span><br><span class="line">  <span class="attr">allow_failure:</span> <span class="literal">false</span>  </span><br><span class="line">  <span class="attr">rules:</span>  </span><br><span class="line">    <span class="comment"># 如果 SKIP_SONAR 为 &quot;true&quot;，跳过任务  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$SKIP_SONAR == &quot;true&quot;&#x27;</span>  </span><br><span class="line">      <span class="attr">when:</span> <span class="string">never</span>  </span><br><span class="line">    <span class="comment"># 在合并请求时触发  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$CI_PIPELINE_SOURCE == &quot;merge_request_event&quot;&#x27;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="attr">sonar_to_feishu:</span>  </span><br><span class="line">  <span class="attr">stage:</span> <span class="string">notify</span>  </span><br><span class="line">  <span class="attr">tags:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonar</span>  </span><br><span class="line">  <span class="attr">script:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">|  </span></span><br><span class="line"><span class="string">      response=$(curl -u admin:123456Aa -s &quot;***/api/qualitygates/project_status?projectKey=com.ydm%3Azw-ydm&amp;branch=master&quot;)  </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">      echo &quot;$response&quot;  </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">      quality_gate_status=$(echo &quot;$response&quot; | grep -o &#x27;&quot;status&quot;:&quot;[^&quot;]*&quot;&#x27; | head -n 1 | sed &#x27;s/&quot;status&quot;:&quot;\([^&quot;]*\)&quot;/\1/&#x27;)  </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">      echo &quot;$quality_gate_status&quot;  </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">      if [ &quot;$quality_gate_status&quot; == &quot;OK&quot; ]; then  </span></span><br><span class="line"><span class="string">        status=&quot;通过 (OK)&quot;  </span></span><br><span class="line"><span class="string">      else  </span></span><br><span class="line"><span class="string">        status=&quot;未通过 (ERROR)&quot;  </span></span><br><span class="line"><span class="string">      fi  </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">      echo &quot;请求飞书&quot;  </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">      curl -X POST -H &quot;Content-Type: application/json&quot; \  </span></span><br><span class="line"><span class="string">        -d &quot;&#123;  </span></span><br><span class="line"><span class="string">            \&quot;msg_type\&quot;: \&quot;post\&quot;,  </span></span><br><span class="line"><span class="string">            \&quot;content\&quot;: &#123;  </span></span><br><span class="line"><span class="string">              \&quot;post\&quot;: &#123;  </span></span><br><span class="line"><span class="string">                \&quot;zh_cn\&quot;: &#123;  </span></span><br><span class="line"><span class="string">                  \&quot;title\&quot;: \&quot;SonarQube 分析完成\&quot;,  </span></span><br><span class="line"><span class="string">                  \&quot;content\&quot;: [  </span></span><br><span class="line"><span class="string">                    [&#123;  </span></span><br><span class="line"><span class="string">                      \&quot;tag\&quot;: \&quot;text\&quot;,  </span></span><br><span class="line"><span class="string">                      \&quot;text\&quot;: \&quot;项目：zw-ydm\n分支：master\n状态：$status\n仪表盘：\&quot;  </span></span><br><span class="line"><span class="string">                    &#125;, &#123;  </span></span><br><span class="line"><span class="string">                      \&quot;tag\&quot;: \&quot;a\&quot;,  </span></span><br><span class="line"><span class="string">                      \&quot;text\&quot;: \&quot;点击查看\&quot;,  </span></span><br><span class="line"><span class="string">                      \&quot;href\&quot;: \&quot;***/dashboard?id=com.ydm%3Azw-ydm&amp;branch=master\&quot;  </span></span><br><span class="line"><span class="string">                    &#125;]  </span></span><br><span class="line"><span class="string">                  ]  </span></span><br><span class="line"><span class="string">                &#125;  </span></span><br><span class="line"><span class="string">              &#125;  </span></span><br><span class="line"><span class="string">            &#125;  </span></span><br><span class="line"><span class="string">        &#125;&quot; \  </span></span><br><span class="line"><span class="string">      https://open.feishu.cn/open-apis/bot/v2/hook/***</span></span><br><span class="line"><span class="string"></span>  <span class="attr">needs:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonarqube-check</span>  </span><br><span class="line">  <span class="attr">rules:</span>  </span><br><span class="line">    <span class="comment"># 如果 SKIP_SONAR 为 &quot;true&quot;，跳过任务  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$SKIP_SONAR == &quot;true&quot;&#x27;</span>  </span><br><span class="line">      <span class="attr">when:</span> <span class="string">never</span>  </span><br><span class="line">    <span class="comment"># 在合并请求时触发  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$CI_PIPELINE_SOURCE == &quot;merge_request_event&quot;&#x27;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="attr">noop:</span>  </span><br><span class="line">  <span class="attr">tags:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sonar</span>  </span><br><span class="line">  <span class="attr">stage:</span> <span class="string">noop</span>  </span><br><span class="line">  <span class="attr">script:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Pipeline skipped all main jobs.&quot;</span>  </span><br><span class="line">  <span class="attr">rules:</span>  </span><br><span class="line">    <span class="comment"># 在合并请求时触发  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&#x27;$CI_PIPELINE_SOURCE == &quot;merge_request_event&quot;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="BUG-记录">BUG 记录</h2><h3 id="docker-拉取失败-Client-Timeout-exceeded-while-awaiting-headers">docker 拉取失败 (Client.Timeout exceeded while awaiting headers)</h3><blockquote><p>内链：[[Docker拉取失败 (Client.Timeout exceeded while awaiting headers)]]</p><p>外链：<a class="link"   href="https://kiml.site/posts/4512ff84/" >Docker拉取失败 (Client.Timeout exceeded while awaiting headers)<i class="fas fa-external-link-alt"></i></a></p></blockquote><h3 id="docker-compose-加载挂载卷，只加载默认">docker-compose 加载挂载卷，只加载默认</h3><blockquote><p>未完全解决。有一个较麻烦的方法。</p></blockquote><ol><li class="lvl-3"><p>手动挂载卷</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker volume create --driver local --opt type=none --opt device=/home/zwadmin/data/docker/sonarqube/data --opt o=bind sonarqube_data</span><br><span class="line">sudo docker volume create --driver local --opt type=none --opt device=/home/zwadmin/data/docker/sonarqube/extensions --opt o=bind sonarqube_extensions</span><br><span class="line">sudo docker volume create --driver local --opt type=none --opt device=/home/zwadmin/data/docker/sonarqube/logs --opt o=bind sonarqube_logs</span><br><span class="line">sudo docker volume create --driver local --opt type=none --opt device=/home/zwadmin/data/docker/sonarqube/conf --opt o=bind sonarqube_conf</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>在 <code>docker-compose.yml</code> 中从外部加载卷</p></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">sonarqube_data:</span></span><br><span class="line"><span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;最近比较闲，分配了这个任务，顺便做个笔记。更新第二版方案，更适合生产环境。&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;参考文章&lt;br&gt;&lt;a class=&quot;link&quot;   href=&quot;https://blog.linxiaodong.com/blog/gitlab-ci-with-sonarQube&quot; &gt;在 gitlab ci/cd 流程中集成 sonar 进行自动 Code Review&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;br&gt;
&lt;a class=&quot;link&quot;   href=&quot;https://www.cnblogs.com/scajy/p/15661187.html&quot; &gt;gitlab Runner 安装与部署&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-12-11 初始记录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24-12-12 完成SonarQube与插件的安装&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24-12-16 maven 与 多模块项目&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="准备工作" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"/>
    
    
    <category term="GitLab" scheme="https://kiml.github.io/tags/GitLab/"/>
    
    <category term="SonarQube" scheme="https://kiml.github.io/tags/SonarQube/"/>
    
  </entry>
  
  <entry>
    <title>消息平台-核心文档</title>
    <link href="https://kiml.github.io/posts/d978b51b/"/>
    <id>https://kiml.github.io/posts/d978b51b/</id>
    <published>2024-11-26T03:20:58.000Z</published>
    <updated>2024-12-15T12:04:06.920Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="71f9c6740f7768fdc9e9bab4f48997b7f390fec68d33667f2ac30a7a8dc4433a">75e86ac553190f42ebdd56fafb303e85dc6a1a1a46f0acebaf1f04073eb758dc03ced5e004cf01aca104fdc62a8d68e601b59b3212abdab62d5f768d15cfa18c332989279c5f056126be2ebf5e2b3ce3c9aeeebb8e1e27a7209ae5ef44a58468afee8f711fe819700b0f6de40aa5cd11a0f68cf099f9875ce5d3c113175d0e316d43438e034cc9f1ae0301edf1d9428fd136db5d3f27ac447de92039f0eb1ca246fbafc11d70b0c340bb41c758ceb2b2c39454755e85eba1b7bd59de454695259f7d9cfa8db6039421353a6be2676b54e64ece29430084b53f318e40f38b763adb319c0c599ee0187bcc11f4303fa978fb485dbfc8f947cfcd5b4679740c807c195d192b34cec54663145ce587bf43eacb6f4c2a87dd87e14c74093c12ec9c490087f040a9a452a6cd709be06c4ebda59ceb8ee75c348ea1d5ffb61d74307a6ad7b241a89b28bdf168b043f5ddb6999731df162df074c979d4e08508de1dbbcd8497df48cd5235bea17ec990572904bcb0ac6a2a7100bc448597d1b51c3e775a57ec36820f6f8f174362f72abd2d9623d6db315ccb3f6f12803d2a691851555246bb24ad11647136254cd31c13f89b6df8a5043809af0b3b6d1e01c73c8f860a8c37582a7985c94d445546bf72f75adf1340d6599310a20c2c20582295583d1ca64fd5ebf097ebb91dde9d3180bcbb6a7b9139d1893c09d12db952b61184de93ca34c36fecebd5932c81ae55f95a6f4ca74e8fb0f3441b3c7480bd2e1405d68e67135a237a92aa157c9423ca0e7d115419723b1e870152f7a326670e59b871daad2d38af4149191937327ff9ccaad5e66c389efe894b71ff963dfad9ca98822a05c67573d72c4bd0275993c4235fb26aed1c13c0668b6031db1b4ff27b540a6f30b9bccd769c7b410eec83a90a0e11eec29b775fa43b66e57432b3b4fdc6ee2807691b868548d39060e67e6a991a292cb85d47e08ffb903d1b94e7c68f47d604a58d99649bba8d78e3e9807f52dd4a4489274de5ed20026d180d84fc7ff30e6d72e69da150631eb17d36b66f1f104e3504a25e94cee20fa0d0bf3b887d1906127622f586fac1958c0e67c074a8c4c5b179ac480c275a5a1ddf7a292467758e71f6cf16c6849f2f2e5815bfba33a4820e5c95424e66dc45d317a95f66b2f39f2084dcea51b1e99345d3e6e864902533229a56e2aeb17125dbd038116ebd1cf64fc66cd8f562cc73bff28e0206d304c63e700b8bfb8f157fcc552c367568b42f5edc8aa4af901f2f1f2199331178c844722cd4fe001d5266308b743d389dab012ee19a414f97915718613e7be7ac22746d30c95a06b17f2a1c444934b8480dd07041cd643d0444f9ba9d6e66cd6b0bba25c5855bee4a413d48eb012b4c05d7f6619508f6b3fc6602965582767be5f44070c525a50a2fff69a2d9816d736d3605f6d5728784d7b83e7bc6ba6e6f3bc77ac289934a3bfb99b5106e306f5878396738551e4abe7ecd9e1168a32ba97fd13d4ccd73eb98b0b8cc4cbca9ef2912107dd891766bf43fce6014457dc7872ca397834ca735e0a25abe701b74feb02543546adec2413d5ae389fb9de21f7a6859f0564df8877c18ff12b14b6ddbbb2db7a2b10f9aede01750337badfdebb6ae178bb29b8e95a09d627a5572c738510f18c5f05257bc67edc5f6c5880a146d7496a18e2b04962045c09511f3b5e75ca0a50adb2091b18fdbc8a7366ba15df55f85ffd0491b1013dabacc9098fc073be2de988cff20587cb921f1a2df22600e1167d8a346d989b3a8c2f883de2568798d295fdf10f0bead231ea1aeb018b7a3ebf9906e9aba3e3aa9844c29bad5aa2a3b2a7761</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="消息平台" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E6%B6%88%E6%81%AF%E5%B9%B3%E5%8F%B0/"/>
    
    
    <category term="Java" scheme="https://kiml.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Windows 自带的 Linux 子系统</title>
    <link href="https://kiml.github.io/posts/ba3da13b/"/>
    <id>https://kiml.github.io/posts/ba3da13b/</id>
    <published>2024-09-22T09:03:39.000Z</published>
    <updated>2024-12-03T13:48:25.282Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>本来想在阿里云服务器上安装 jenkins，但是配置高的服务器价格太贵，配置低的非常容易 cpu 100%，不利于测试。所以打算直接用台式机做虚拟云主机。</p></li><li class="lvl-2"><p>参考文章<br><a class="link"   href="https://blog.csdn.net/FSKEps/article/details/118493578" >Win10 系统安装 Linux 子系统教程(WSL2 + Ubuntu 20.04 + Gnome 桌面 ）<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24-09-22 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="安装-WSL">安装 WSL</h2><h3 id="安装-WSL1">安装 WSL1</h3><ol><li class="lvl-3"><p>管理员身份运行 PowerShell</p></li><li class="lvl-3"><p>输入命令，启用<mark>适用于 Linux 的 Windows 子系统</mark>功能</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>在 Microsoft Store 中选择中意的 Linux 分发版本，并安装</p></li><li class="lvl-3"><p>为新的 Linux 分发版创建用户账户和密码</p></li></ol><h3 id="升级到-WSL2">升级到 WSL2</h3><ol><li class="lvl-3"><p>开启“虚拟机平台”可选功能</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>重启电脑</p></li><li class="lvl-3"><p>下载 Linux 内核更新包<a class="link"   href="https://link.csdn.net/?from_id=118493578&amp;target=https%3A%2F%2Fwslstorestorage.blob.core.windows.net%2Fwslblob%2Fwsl_update_x64.msi" >适用于 x64 计算机的 WSL Linux 内核更新包<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-3"><p>设置 WSL 版本</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\user-name&gt; wsl --set-version Ubuntu-20.04 2</span><br><span class="line">正在进行转换，这可能需要几分钟时间...</span><br><span class="line">有关与 WSL 2 的主要区别的信息，请访问 https://aka.ms/wsl2</span><br><span class="line">转换完成。</span><br></pre></td></tr></table></figure><h2 id="使用-WSL">使用 WSL</h2><h3 id="启动和退出-Linux">启动和退出 Linux</h3><p>进入 Linux 子系统有以下几种方式：</p><p>（1）和正常软件一样启动，如在开始菜单中点击其图标、双击桌面快捷方式<br>（2）在 Windows 中打开一个终端，如 PowerShell，输入命令 <code>wsl</code><br>（3）在终端中输入命令 <code>Linux 发行版名称.exe</code>，如 <code>ubuntu20.04.exe</code></p><p>退出 Linux 子系统的方式：</p><p>（1）直接关闭终端<br>（2）在终端中输入命令 <code>exit</code>，此时退出了 WSL，然后输入命令 <code>wsl -t Ubuntu-20.04</code>，关闭 ubuntu 子系统。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出所有分发的名称、运行状态、对应的 WSL 版本</span></span><br><span class="line">wsl -l -v</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">终止指定的 Linux 分发</span></span><br><span class="line">wsl -t &lt;distro&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注销分发</span></span><br><span class="line">wsl --unregister &lt;distro&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">终止所有正在运行的分发和 WSL2 轻型工具虚拟机</span></span><br><span class="line">wsl --shutdown</span><br></pre></td></tr></table></figure><h3 id="换源">换源</h3><p>使用 Linux 子系统时，为了提高软件的安装速度，需要将软件源换成国内的镜像源。</p><ol><li class="lvl-3"><p>备份原来的数据源配置文件</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list_backup</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>修改数据源配置文件</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/apt/sources.list</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认注释了源码仓库，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">预发布软件源，不建议启用</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb https://mirrors.ustc.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>更新源，升级软件</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure><h2 id="使用-SSH-登录-Linux-子系统">使用 SSH 登录 Linux 子系统</h2><h3 id="开启-SSH-并允许-root-登录">开启 SSH 并允许 root 登录</h3><ol><li class="lvl-3"><p>安装 SSH 服务器</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install openssh-server</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>修改配置端口为 22，允许密码和 root 登录。</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>找到下面的内容并去掉注释在前面的#号，其中把 <code>PermitRootLogin prohibit-password</code> 更改为 <code>PermitRootLogin yes</code> 这是允许用 root 登录的。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Port 22</span><br><span class="line">PermitRootLogin prohibit-password</span><br><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>重启 SSH 服务</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service ssh restart</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者运行这个命令</span></span><br><span class="line">sudo service ssh --full-restart</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>终端测试连接输入指令，格式为：<code>ssh 用户名@域名/IP</code></p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@0.0.0.0</span><br><span class="line">ssh 127.0.0.1</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>确保 SSH 服务器会在系统启动时自动启动</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable ssh</span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p>配置永久解决方案将上述的命令保存为 <a class="link"   href="http://service.sh" >service.sh<i class="fas fa-external-link-alt"></i></a>，保存在 home 目录下</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&gt;&gt;&gt; service ssh restart &gt;&gt;&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> Xshell connection</span></span><br><span class="line">sudo service ssh --full-restart</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;&lt;&lt; <span class="string">service ssh restart &lt;&lt;&lt;</span></span></span><br></pre></td></tr></table></figure><p>配置好之后，下次开机，只需要在 Linux 子系统的默认终端运行 sh <a class="link"   href="http://service.sh" >service.sh<i class="fas fa-external-link-alt"></i></a> 命令后，关掉终端改用 xshell 登录即可。</p><ol start="7"><li class="lvl-3"><p>查看 SSH 监听端口</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ss -tuln | grep 22</span><br></pre></td></tr></table></figure><ol start="8"><li class="lvl-3"><p>SSH 服务器状态</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh status</span><br></pre></td></tr></table></figure><h3 id="设置默认使用-root-登录系统">设置默认使用 root 登录系统</h3><ol><li class="lvl-3"><p>切换 root 权限</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后输入密码</span></span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>创建/打开 <code>/etc/wsl.conf</code> ，添加以下内容</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">default=root</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>运行以下命令重新启动 WSL 以应用更改</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --shutdown</span><br></pre></td></tr></table></figure><h3 id="设置端口转发">设置端口转发</h3><blockquote><p>为了能够从外部连接到你的 WSL Linux 子系统，你需要确保系统具有公共 IP 地址，或者设置端口转发以将流量路由到 WSL 子系统的局域网 IP 地址。请检查你的网络配置，确保 WSL 子系统能够访问公共网络，并且有一个可供外部访问的 IP 地址。</p></blockquote><ol><li class="lvl-3"><p>增加转发的命令：</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=22 connectaddress=[IP] connectport=[PORT]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里的IP为WSL中使用ipconfig查看的IP地址，PORT为WSL的PORT</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">还需要在windows防火墙中添加对应的入站规则，设置完成后可以通过ip地址远程访问wsl</span></span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>删除转发的命令：</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy delete v4tov4 listenport=22 listenaddress=0.0.0.0</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>使用以下命令列出当前的端口转发规则：</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy show all</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>测试连接的命令：</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh username@ip -p 22</span><br></pre></td></tr></table></figure><blockquote><p>这里测试连接的 ip 可以在 linux 内使用命令 <code>hostname -I</code> 进行查看</p></blockquote><h2 id="卸载-Linux-系统">卸载 Linux 系统</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --unregister Ubuntu</span><br></pre></td></tr></table></figure><h2 id="SSH-安全">SSH 安全</h2>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;本来想在阿里云服务器上安装 jenkins，但是配置高的服务器价格太贵，配置低的非常容易 cpu 100%，不利于测试。所以打算直接用台式机做虚拟云主机。&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;参考文章&lt;br&gt;
&lt;a class=&quot;link&quot;   href=&quot;https://blog.csdn.net/FSKEps/article/details/118493578&quot; &gt;Win10 系统安装 Linux 子系统教程(WSL2 + Ubuntu 20.04 + Gnome 桌面 ）&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-09-22 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="环境搭建" scheme="https://kiml.github.io/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Linux" scheme="https://kiml.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>设计模式-责任链模式</title>
    <link href="https://kiml.github.io/posts/b6c1490f/"/>
    <id>https://kiml.github.io/posts/b6c1490f/</id>
    <published>2024-09-13T09:00:03.000Z</published>
    <updated>2024-12-14T07:30:51.754Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>设计模式 - 责任链模式</p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24-09-13 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="简单理解">简单理解</h2><p>可以简单的理解为，针对一个请求，做多层处理（ 不分先后），并且这些处理可能随着业务需求进行不断变更，这个时候就可以用责任链模式。比如说 Spring 中的 <code>Filter</code> 使用的就是责任链模式。* 这里理解与策略模式的不同在于：责任链有点像 if return 会每个匹配比较，而策略像 map get key 直接匹配一个；责任链多用于解耦，策略多用于封装 *</p><p>一般来说，这种多层处理可能代码中使用多个 if 来进行处理。处理方式可以如下：</p><ol><li class="lvl-3"><p>将处理的各个流程抽象为各个类（本来 Handler 里边有多个 <code>if</code> 和 <code>方法</code>)</p></li><li class="lvl-3"><p>将多个类用 <code>Chain</code> 链起来，暴露一个方法给 Handler 使用</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Filter</span> &#123;  </span><br><span class="line">    <span class="comment">// 过滤  </span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(String data)</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Filter1</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(String data)</span> &#123;  </span><br><span class="line">        <span class="comment">//doSomething  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Filter2</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(String data)</span> &#123;  </span><br><span class="line">        <span class="comment">//doSomething  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Filter3</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(String data)</span> &#123;  </span><br><span class="line">        <span class="comment">//doSomething  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterChain</span> &#123;  </span><br><span class="line">    List&lt;Filter&gt; filters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FilterChain</span><span class="params">()</span> &#123;  </span><br><span class="line">        filters.add(<span class="keyword">new</span> <span class="title class_">Filter1</span>());  </span><br><span class="line">        filters.add(<span class="keyword">new</span> <span class="title class_">Filter2</span>());  </span><br><span class="line">        filters.add(<span class="keyword">new</span> <span class="title class_">Filter3</span>());</span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">(String data)</span> &#123;  </span><br><span class="line">        <span class="keyword">for</span> (Filter filter : filters) &#123;  </span><br><span class="line">            filter.doFilter(data);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Handler</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerRequest</span><span class="params">(Request request)</span> &#123;  </span><br><span class="line">        <span class="comment">// 得到请求的数据  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> request.getData();  </span><br><span class="line">        <span class="type">FilterChain</span> <span class="variable">filterChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterChain</span>();  </span><br><span class="line">        <span class="comment">// 处理数据  </span></span><br><span class="line">        filterChain.processData(data);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="通用代码">通用代码</h2><ol><li class="lvl-3"><p><strong>业务执行器</strong>接口，所有的业务实现都会实现该接口</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 业务执行器</span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BusinessProcess</span> &#123;  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(ProcessContext context)</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>责任链上下文</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 责任链上下文</span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessContext</span> &#123;  </span><br><span class="line">    <span class="comment">// 标识责任链的code  </span></span><br><span class="line">    <span class="keyword">private</span> String code;  </span><br><span class="line">    <span class="comment">// 存储上下文的真正载体  </span></span><br><span class="line">    <span class="keyword">private</span> Model model;  </span><br><span class="line">    <span class="comment">// 责任链中断的标识  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">needBreak</span> <span class="operator">=</span> <span class="literal">false</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>业务执行模板（把责任链的逻辑串起来）</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 业务执行模板（把责任链的逻辑串起来） </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessTemplate</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> List&lt;BusinessProcess&gt; processList;  </span><br><span class="line">    <span class="keyword">public</span> List&lt;BusinessProcess&gt; <span class="title function_">getProcessList</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> processList;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProcessList</span><span class="params">(List&lt;BusinessProcess&gt; processList)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.processList = processList;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>责任链的流程控制器</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 责任链的流程控制器（整个责任链的执行流程通用控制）</span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessController</span> &#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 不同的code 对应不同的责任链  </span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, ProcessTemplate&gt; templateConfig = <span class="literal">null</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(ProcessContext context)</span> &#123;  </span><br><span class="line">        <span class="comment">//根据上下文的Code 执行不同的责任链  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">businessCode</span> <span class="operator">=</span> context.getCode();  </span><br><span class="line">        <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> templateConfig.get(businessCode);  </span><br><span class="line">        List&lt;BusinessProcess&gt; actionList = processTemplate.getProcessList();  </span><br><span class="line">        <span class="comment">//遍历某个责任链的流程节点  </span></span><br><span class="line">        <span class="keyword">for</span> (BusinessProcess action : actionList) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                action.process(context);  </span><br><span class="line">                <span class="keyword">if</span> (context.getNeedBreak()) &#123;  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e2) &#123;  </span><br><span class="line">                <span class="comment">//...  </span></span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>举例用的两个实现</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 白名单处理器</span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WhiteListProcess</span> <span class="keyword">implements</span> <span class="title class_">BusinessProcess</span> &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(ProcessContext context)</span> &#123;  </span><br><span class="line">        <span class="type">UserModel</span> <span class="variable">user</span> <span class="operator">=</span> (UserModel) context.getModel();  </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;3y&quot;</span>.equals(user.getName())) &#123;  </span><br><span class="line">            context.setNeedBreak(<span class="literal">true</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 发消息处理器</span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMessageProcess</span> <span class="keyword">implements</span> <span class="title class_">BusinessProcess</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(ProcessContext context)</span> &#123;  </span><br><span class="line">        <span class="type">UserModel</span> <span class="variable">user</span> <span class="operator">=</span> (UserModel) context.getModel();  </span><br><span class="line">        System.out.println(<span class="string">&quot;给&quot;</span>+user.getName()+<span class="string">&quot;发消息&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>把处理器添加到 <code>ProcessTemplate</code> 模板，把 <code>ProcessTemplate</code> 添加到 <code>ProcessController</code> 的 <code>Map</code> 上</p></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--发送消息的责任链--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sendMessageTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.chainofresponsibility.ProcessTemplate&quot;</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;processList&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;whiteListProcess&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;sendMessageProcess&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">&lt;!--通用流程处理器，维护多条责任链--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processController&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.chainofresponsibility.ProcessController&quot;</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateConfig&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;sendMessage&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;sendMessageTemplate&quot;</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p>接口里执行责任链</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProcessController processController;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/send&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="comment">// 构建上下文</span></span><br><span class="line">        <span class="type">ProcessContext</span> <span class="variable">processContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessContext</span>();</span><br><span class="line">  </span><br><span class="line">        <span class="type">UserModel</span> <span class="variable">userModel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserModel</span>();</span><br><span class="line">        userModel.setAge(<span class="string">&quot;24&quot;</span>);</span><br><span class="line">        userModel.setName(userName);</span><br><span class="line">        processContext.setModel(userModel);</span><br><span class="line">        processContext.setCode(<span class="string">&quot;sendMessage&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        processController.process(processContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Pipeline">Pipeline</h2><p><code>Redis</code> 会用 <code>Pipeline</code> 去做批量的操作。它是「责任链模式」的实现之一。</p><p>// 具体分析 todo</p>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;
设计模式 - 责任链模式&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-09-13 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://kiml.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://kiml.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="责任链模式" scheme="https://kiml.github.io/tags/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>消息平台-核心代码</title>
    <link href="https://kiml.github.io/posts/4f08dd5e/"/>
    <id>https://kiml.github.io/posts/4f08dd5e/</id>
    <published>2024-09-13T07:18:48.000Z</published>
    <updated>2024-12-14T07:33:08.355Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="b04c36868349d6d4ef94e9b8458cdc9d5408a7e69f5ae7949389db2dce4e75c0">665b6e36e8990f013070faca4228a0bfccd399cf756e12c68920c56ce8b4287efa95190af6d6209f579011876b8fa876e0bc2b631d0e227bd44e7792f33fee40dad7ec9375821980e8a38f95ea5d6068fdf072be6dfe9835ac738acc08e2b8652b180e2dd198205612d8298c4f272fd39d8b30f53e63690c16fcccbf7eb6681a06e2642eec08adebbadb213c7dc237ff929bcabc17115cc10f4c5b4fc9aebc200fcf18916cd0aa57c6fb3203481a404b20c9e749b4522858fd75b824a8d59085a8ff9aa5ac41736ec8bc70d688f60a680638bf018dfefb1aed5fcc8183305a1949ab59168a4f805b4f859b8d4abb0aa19d5350b9470b7e4294183d018170e370a50f3952ceb065205db3fc33e14948daed0c356cc17650a6c7a9419d7ee11733285d9eb5cad2707de7edd63077c83910eb31de24e59915023fbdd333f7e3e35274c9950f8040a4d6571439555b3a21d2788d20a3fdca53de945cd871b0259a628d9615216526851b256afba7af06012e061e0831b0b2518690ae131328d27ca09dcf341a435579cb6e4e24a6b9c75c7f4274bcac486648b2b1d63adc9e7aecaa650321e1e38f934db2cd86468a3d3bf7468a5b755aaf749570d84da015a1d83ccc336920871daf7d7dcff045fa0c4afc809b7950819dd93f1c57d4e61552acd3a7178057c69b7679a1728e909efb96cb5543a8fe9cf0cecf62c0a5c39b00bbcfbb8f5c074db648c3799d6fdd2d73b224a4a50efbf5fff9e0af0e71da9dba7630beab7d1626eea2c5dbe30ad253bff8ea06006d99368c8b76b2ba8178173c288d40abe7d384549db225e9aa4d2b7eb103e0e791afcee8a55ce3dcbd9d1b3fa5f64e6e4fc22b633663d9a1f9654e1b9c4112631034edda784c698b4de90f6e09e19c7809d54c2ca4a78ad10488d152c8053e91491902eda5af2f936a73497673141428f19a4f732c8f714dd425a595ded08c5fdee561b7aad0f595359535247690e159b2af36d831a5704e7e7dbcbf22bd325be89e6544a9c6d23ad0ac1be78744df3fe61ad12e48f3f7cb940c87b5549dc8ac7f8e76b819663b3688f04dd09becce536b8e86374e93186024c2f1eedb6f84f3a3bb39fbaddd9766f456925075bb1156ad99221682ecb275d0c335495a796389250cdd8fff406bb0f4fba8975d104b57322b05ae57bc0c5587a56f4054c3b611971411ac2e4467344c46ddd858be2b3cce107bad61a8679f5df2b2be2233f1e430644771869ec07756688473217662ad5186f7ac23b896395a9b7ef4a3a9e47b3befd5b50ac9c36875eaf82247674ca676a309f2047a97f041416bd13d3c8b5ab78c56e839e274889ddbb99387dd327c77235435cda782667decd07361bdc1fbd87718dca038082483c9ef603f60c7c62c8df248df5bd4ba2060c9846555e77ee39d7fb29793da5e01b3a6c6cddc043ce71529107ad2dad9ee30dc5f601f234594f6e046a00d84fb0d4f5e343247afba7adf4c30a6f4cf281ccf6cf4710217b4c075d3ce956a4e6b633ba3af167ea3d8554962ac73b726016accf287bd3c4a54fcf65e00274a363bd64dcba23ae96befc2e2b2808a9696bf34d3cd2781754ce0bfba2e1b2668a4f82e718e4cbeb54a1db7212f522916b65ea0f5ae1b40f115dca4c42641123213d8b870689cbd7e216c2e1b209dd24e239b76449a88bda48fabe4cfed3bcaf9ae64270e8530774eb7d13c07ade02a25e7c113c657d78a59c01c33a30b4dc2626d9295a5a9445f1cc5b86bcdc4c58fd1ff29b2644a4fe6af281e9781a5cc3a99dddd1064ecf45419abe61f1aec206f01b74b76728a4a2e4425844e92052816d33c90bc0428ecb2ac183f3d6626fb65b48ad90b00740a368a846093ce8b667b529a337da2cac8cba8c9816649b25fb9bc2b23a90aa3852ab1b5e8de8fc926a1921a42b471ce2bfc41584a47881c7b85c72ac83fd5373a155c6285fd0e08df65fb90e239f83d1c3c1795d018515513122169e4b89690dd2e128bbb3622d232edb14ededea5f9405dd43ad0f69d2ed176150ab3caee7c4c4b9fab331a9f06916123c28107c580440bb367d50f48b21222aa6051177fe90cbef3801e8a65977e5acd80a1b7d55c30c3765d34c636ee94a5c455aaa12720ea4af635aa77875219cf85a4e1136dece1c4d733da25d4c4a3bc38c55bfabe2eb51e5a01a7807f3f8ad25ffb97383f9eab3ee47c1bf3d39fe6922e7370b4e57420ea942ba9912516f2306be1f9426f2b5712279870b0855c7e6422bdc51ac98957598e90120fdf44cd7edf363bb6cd7111cab2c8633deeb55b304dca9b1197726b231aee9c57c8de7a6f2a849504c0a8e578d50e370e38a5fc57161f568cddcd43a9532a013a6e2577ed17eaa5f7b8f7977dfeca84cf72c1c1680aa05ff002f4acbac273fba9fc9e8f2c05587b42eb2a029ff617a209e001352bf2c63c2f3d904ff2a1269513d805f92d1f95b2eb682690c666f3d7c0fc6475e8d5eb878e3da4f9ebbe5755952fed078a1dbe0e30ae5eeeeb996dd5ab6483e82f3829dfbef027e2d0749a16d183ba480513178a892e3812a00a63d45756726925d55cf047e0aad0a718b67994705c8c87562a5e507cdb84bafa3de033558679f02760af75eed436887a92ec27265335cf816aec6f4e28fab17a664ef55cc27973455740e58fbc930ff07621999d8e51651ee5a42dc901062490da04f05a1ed1b277ab9f9a83022e1868917c7101d7b01beb58fd4c11c40281c88fa9bd4b574d6e7e350afef2fb0f7b9a3cf6db8c3c67286551e2b20fa8448e5a0fb57122dcc5e1bf376800f350243f6800e37b815e5b6bfcfcb31a00ae9b9755f42c52b13ba852018461fd58dac3e915f41155f4514e694a722d8bb2bb2f58caa18edad27a96a6b430a57bd90f5d778c13559c18a9e44e7f8956292136832828b2758df4b27fd1a9d5a87e7fed54bc49fae2698aa7b8b36d8c8a9142b4f1591e7d85ff0609546a44de7f072d3e9cb2e340553ac920fbafa541f26527ce2c5af531d9e4db41342f375b6ad3f20169d165af1899972b75ed4626a7c9b6fcca190fdd69f59a43b7aed8740289f389976f30435e88f17ec1e7c6dc15c6529d3afad84fc9076dff42247c1c9b552279c6d8fafb3866442b75c6db5d5eb3b8c66f417803323ac2e7b490a96c1b8d43d36fef5caef7f76edfba680decb2dd01ade6859ee0e62a966feea367a80bc1663d0739c2caafd8f566a458891fec8575768ea6670de80b1191ff24ed55122338e0bcf6f76709e4917a098acf93958c4456184d80e790a038b2a4f6abae701480295771d71761416e8b094268ff1d2503b935ea4c524aeb47bf3ba1d197262b5306a6d15b02fb5f01a1532044311963b3f3cf07c0deee4c2ab9d03e72a849be4aca4e2a45f412a3ae351b7dd3e3bb93331bb9940d</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="消息平台" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E6%B6%88%E6%81%AF%E5%B9%B3%E5%8F%B0/"/>
    
    
    <category term="Java" scheme="https://kiml.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>装机-软件安装（Linux）</title>
    <link href="https://kiml.github.io/posts/dada24a1/"/>
    <id>https://kiml.github.io/posts/dada24a1/</id>
    <published>2024-09-12T05:59:25.000Z</published>
    <updated>2025-02-09T09:03:37.677Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>记录 Linux 安装教程</p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24-09-12 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><p>默认操作为 root 权限，权限不足命令前加 sudo</p><h2 id="MySQL">MySQL</h2><ol><li class="lvl-3"><p>MySQL 8.0.26 下载</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.mysql.com/archives/get/p/23/file/mysql-8.0.26-linux-glibc2.12-x86_64.tar.xz</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>解压缩文件</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf mysql-8.0.26-linux-glibc2.12-x86_64.tar.xz</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>移动文件</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv mysql-8.0.26-linux-glibc2.12-x86_64 /usr/local/mysql</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>创建数据存放目录</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span>到安装目录下</span></span><br><span class="line">mkdir data</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>创建用户组和用户</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line"></span><br><span class="line">useradd -g mysql mysql</span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p>改变 mysql 目录权限</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql.mysql /usr/local/mysql/</span><br><span class="line"></span><br><span class="line">chown -R mysql .</span><br><span class="line">chgrp -R mysql .</span><br></pre></td></tr></table></figure><ol start="7"><li class="lvl-3"><p>数据库初始化（<em>需要记住临时密码</em>）</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/mysqld --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --initialize</span><br></pre></td></tr></table></figure><ol start="8"><li class="lvl-3"><p>修改 my.cnf 文件</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件内内容</span></span><br><span class="line">[mysqld]</span><br><span class="line">    basedir = /usr/local/mysql</span><br><span class="line">    datadir = /usr/local/mysql/data</span><br><span class="line">    socket = /usr/local/mysql/mysql.sock</span><br><span class="line">    character-set-server=utf8</span><br><span class="line">    port = 3306</span><br><span class="line">   sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"> [client]</span><br><span class="line">   socket = /usr/local/mysql/mysql.sock</span><br><span class="line">   default-character-set=utf8</span><br></pre></td></tr></table></figure><ol start="9"><li class="lvl-3"><p>创建 mysql 服务</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 mysql.server 启动文件复制到 /etc/init.d 目录</span></span><br><span class="line">cp -a /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">赋予权限</span></span><br><span class="line">chmod +x /etc/rc.d/init.d/mysqld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 mysql 服务</span></span><br><span class="line">chkconfig --add mysqld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查服务是否生效</span></span><br><span class="line">chkconfig --list mysqld</span><br></pre></td></tr></table></figure><ol start="10"><li class="lvl-4"><p>配置全局环境</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加如下配置</span></span><br><span class="line">export PATH=$PATH:/usr/local/mysql/bin:/usr/local/mysql/lib</span><br><span class="line">export PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使环境变量设置生效</span></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><ol start="11"><li class="lvl-4"><p>启动 mysql 服务</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service mysql start</span><br><span class="line"></span><br><span class="line">service mysql status</span><br></pre></td></tr></table></figure><ol start="12"><li class="lvl-4"><p>登录 mysql 修改密码</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">密码为之前的临时密码</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改密码</span></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><ol start="13"><li class="lvl-4"><p>设置 mysql 远程登录</p></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 允许任何主机使用 root 进行连接</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host<span class="operator">=</span><span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span> limit <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 创建一个允许远程访问的 MySQL 账户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;your_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;your_password&#x27;</span>; </span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;your_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h2 id="Redis">Redis</h2><ol><li class="lvl-3"><p>源码安装与编译</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/redis-stable.tar.gz</span><br><span class="line">tar -xzvf redis-stable.tar.gz</span><br><span class="line">cd redis-stable</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>执行完 make 命令后，src 目录下会出现编译后的 redis 服务程序 <code>redis-server</code>，还有用于测试的客户端程序 <code>redis-cli</code>，两个程序位于安装目录 src 目录下</p><ol start="2"><li class="lvl-3"><p>安装可执行程序到 <code>/usr/local/bin</code></p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>前台运行启动</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用指定配置文件启动</span></span><br><span class="line">cp redis.conf /etc/redis.conf</span><br><span class="line">redis-server /etc/redis.conf</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>其他命令</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line"><span class="meta prompt_">redis&gt; </span><span class="language-bash"><span class="built_in">set</span> foo bar</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_">redis&gt; </span><span class="language-bash">get foo</span></span><br><span class="line">&quot;bar&quot;</span><br><span class="line"></span><br><span class="line">redis-cli shutdown</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">直接关闭不保存内存</span></span><br><span class="line">redis-cli shutdown nosave</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>配置 Redis 为后台服务将配置文件中的 daemonize no 改成 daemonize yes，配置 redis 为后台启动。</p></li><li class="lvl-3"><p>Redis 设置访问密码在配置文件中找到 requirepass，去掉前面的注释，并修改后面的密码。</p></li><li class="lvl-3"><p>设置远程可访问</p></li></ol><p>在配置文件中找到 bind 127.0.0.1 这一行，注释。</p><p><strong>如果 redis3.2 版本以上的，需要将保护模式（protected-mode）修改成 no</strong></p><ol start="8"><li class="lvl-3"><p>常用的配置文件</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#默认端口6379</span><br><span class="line">port 6379</span><br><span class="line">#绑定ip，如果是内网可以直接绑定 127.0.0.1, 或者忽略, 0.0.0.0是外网</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">#守护进程启动</span><br><span class="line">daemonize yes</span><br><span class="line">#超时</span><br><span class="line">timeout 300</span><br><span class="line">loglevel notice</span><br><span class="line">#分区</span><br><span class="line">databases 16</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">rdbcompression yes</span><br><span class="line">#存储文件</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">#密码 abcd123</span><br><span class="line">requirepass abcd123</span><br></pre></td></tr></table></figure><h2 id="Docker-和-Docker-compose">Docker 和 Docker-compose</h2><ol><li class="lvl-3"><p>安装 GCC 相关的环境</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc</span><br><span class="line"></span><br><span class="line">yum -y install gcc-c++</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>安装 Docker 需要的依赖软件包</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>设置国内的镜像</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>更新 yum 软件包索引</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><ol start="5"><li class="lvl-3"><p>安装 DOCKER CE(注意：Docker 分为 CE 版和 EE 版，一般我们用 CE 版就够用了)</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure><ol start="6"><li class="lvl-3"><p>启动 Docker</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure><ol start="7"><li class="lvl-3"><p>下载 Docker Compose 的当前稳定版本</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><ol start="8"><li class="lvl-3"><p>将可执行权限应用于二进制文件</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><ol start="9"><li class="lvl-3"><p>创建软链</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure><ol start="10"><li class="lvl-4"><p>测试是否安装成功</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure><h2 id="Minio"><a class="link"   href="https://min.io/" >Minio<i class="fas fa-external-link-alt"></i></a></h2><ol><li class="lvl-3"><p>服务器安装</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.min.io/server/minio/release/linux-amd64/minio</span><br><span class="line">chmod +x minio</span><br><span class="line">MINIO_ROOT_USER=admin MINIO_ROOT_PASSWORD=password ./minio server /mnt/data --console-address &quot;:9001&quot;</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>客户端安装</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.min.io/client/mc/release/linux-amd64/mc </span><br><span class="line">chmod +x mc mc alias </span><br><span class="line">set myminio/ http://MINIO-SERVER MYUSER MYPASSWORD</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;记录 Linux 安装教程&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-09-12 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="环境搭建" scheme="https://kiml.github.io/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Linux" scheme="https://kiml.github.io/tags/Linux/"/>
    
    <category term="工具" scheme="https://kiml.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>消息平台-项目介绍</title>
    <link href="https://kiml.github.io/posts/2b76eac7/"/>
    <id>https://kiml.github.io/posts/2b76eac7/</id>
    <published>2024-09-10T08:01:13.000Z</published>
    <updated>2024-11-05T02:41:36.437Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>新项目学习笔记。<br>项目 git 地址：<a class="link"   href="https://gitee.com/zhongfucheng/austin.git" >https://gitee.com/zhongfucheng/austin.git<i class="fas fa-external-link-alt"></i></a><br>前端项目 git 地址：<a class="link"   href="https://gitee.com/zhongfucheng/austin-admin" >https://gitee.com/zhongfucheng/austin-admin<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24-09-10 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="项目概述">项目概述</h2><p>austin 项目是消息推送平台的实现，它的<strong>核心功能</strong>：统一的接口发送各种类型消息，对消息生命周期全链路追踪</p><h2 id="系统项目架构">系统项目架构</h2><table><thead><tr><th>工程模块</th><th>作用</th></tr></thead><tbody><tr><td>austin-common</td><td>项目公共包：存储着项目公共常量/枚举/Bean</td></tr><tr><td>austin-support</td><td>项目工具包：对接 中间件/组件</td></tr><tr><td>austin-cron</td><td>定时任务模块：对 xxl-job 封装和项目定时任务逻辑</td></tr><tr><td>austin-web</td><td>后台管理模块：提供接口给前端调用</td></tr><tr><td>austin-service-api</td><td>消息接入层接口定义模块：只有接口和必要的入参依赖</td></tr><tr><td>austin-service-api-impl</td><td>消息接入层具体实现模 块： 真实处理请求</td></tr><tr><td>austin-handler</td><td>消息处理逻辑层：消费 MQ 下发消息</td></tr><tr><td>austin-stream</td><td>实时处理模块：利用 flink 实时处理下发链路数据</td></tr><tr><td>austin-data-house</td><td>数据仓库模块：消费 MQ 数据写入 hive</td></tr></tbody></table><p><img                         lazyload                       alt="image"                       data-src="https://blog-resources.oss-cn-hangzhou.aliyuncs.com/Z2409-12/09/austin%E6%B5%81%E7%A8%8B%E5%9B%BE.png"                        alt=""                 ></p>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;新项目学习笔记。&lt;br&gt;
项目 git 地址：&lt;a class=&quot;link&quot;   href=&quot;https://gitee.com/zhongfucheng/austin.git&quot; &gt;https://gitee.com/zhongfucheng/austin.git&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;br&gt;
前端项目 git 地址：&lt;a class=&quot;link&quot;   href=&quot;https://gitee.com/zhongfucheng/austin-admin&quot; &gt;https://gitee.com/zhongfucheng/austin-admin&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-09-10 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="消息平台" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E6%B6%88%E6%81%AF%E5%B9%B3%E5%8F%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>Jenkins + k8s 实现 CICD（持续集成和持续部署）</title>
    <link href="https://kiml.github.io/posts/60f8da4b/"/>
    <id>https://kiml.github.io/posts/60f8da4b/</id>
    <published>2024-08-25T12:31:20.000Z</published>
    <updated>2025-03-04T13:39:19.111Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="3aa89e11161cd4f1e2b86df4efa6dc1b1a69775de0815f16150360217ac98037">972a4ea99218889cef049d656e4bf4b2b3f032f944a5ceeb3ea8aead21368f745f71bc99025aa2e705d9ccd09d86707ac6e343b6bce3cbb001b83a7cf7cfb1079c3dceccc68c9c8c4cf2e2ad3c3a69a8c892c0a95bfc866c10ae4092d65c4914688402a31e1b797be6ea0d67ef80d47a5552a85635be0dd01893a6ef43339426901a8c802280a33371f100ddf7f8ccedba9ee463f4b49d3bac6ae22dd6bb22274ecaab942d64a18d7ca45e2259763be82abb2d9f312a6a722f0cdd4cc1c9c5467d6f65f3375df6d9e88d972ef413a9ee9d0448446f852f37e60354ec4f6092774924fd0dfad472fdbf34e3c16627a6829db3ab5f0e6d5b6029dbc3f0def87dc052795e08bff2401ab407ae991ab1fc05b4ebe0231ba27fb294a5e4fad8cda77ab6bf46870fd0de75d6bac8e26fc72e854a8d6875148eb92446048079e9f14d182be00c10b69b14beb08ae5403e566adaf2bdc57e1495cbf0f543ea806198796212a29ed0d0a856ed3d450d18db26e813b8af2e74477cf20d757375780537286de39b5c8c9037e58680397d9801e423f2ce98546c6c8948460b434d52c1d47801e45c8598b2ce8098cae070906362eae48bf6aa1b3360bff34ea3a227db5c282ffa9204df03df591de6e0eec6357034da890ad6954ce4f2dacdc2a0a38a7d8aa86e2ceec1cc6af87e19108c38982d5e841a2d513e49a58d7645bc84decb40e66ddc5193e727aa2d6e3fc5e8a6898dca80231aaf3a667e0c9e3fe1698f9dfdab90ab52438e0df1967b58f42fc8e55c62f52d38bb926324d395efcae777ea24c07ec781754a31432850553bbc339465c00272a9f1c94e62f1c794ecbaa32aaee041b5303e7301a27cd8fd6fa343a6c761ce020c328aa769fb52d14b3dc85bde78862ea09abd90854cc4a5cc7b275f4df083f98642fbbd4c9f9eba0bd66cbec9ca28e17c4f3b88d084e078f8d9e4e93614158f8dbe8ff5be1f6d2a8654f0c860046a4d26638715be06c87e9fa69ba4e1ddc07e2b0ed8d84cd68b4cef489be6b875a97026f949e0a2eb4b8faa69a3d60babb7c8a1593373c5564d0a34988ae11b33543d6718b613734f69d3a4acec1f399dd0965702e3d40b52bb572f0a0fa892c3decb6540466ac069276b01183069e572ba89dd7370278fe1affc7ed94dea9b33de0e46f2bc8d6813c6b298efe261c95b785be9791258360004ccd83fb18d545b4403b25993ede6bbfef47cec267d6fb76e3aca5ee8f459f12a8cd28bded8722ce56def08543510eb3d18f38abd7da0b02bf757a0f400fa5cbf3973997553510e2105dd27ca04760323c0484d407d1e632256b6bc18d9f5c88169a78e15cebc63ba86664e0ccfbd688432ecf4e04e9f62d1beac5464865bea62695873205367691378218792bbe1b19dee5efcce799c6f38563e00c4337966db5a467af2d04c08533cedd4f33d0685a1fd3cfee2fe23e23099db1c988e6cbc88331ca47ac560c569b99c933b23e57f9f05c097b1508bb3adfab01148790d9a981a56f955a9bc6b9c83596c17e2f3f1be2c2ed025d63bbebad40b75ba0d1a2a320689235ab7f1a47f2889f509353e8d357e7b1f0384edfbf84c79b1334e2cd7bd51c707275f79bedd01908652206ff1808bf0b422cfccb0997358233f50ef88c50f349bf23351c104972e9a4a6da7d7ba135118a700dc32fa483f0d212d4295ac3ecbf80c625ccee079e75abe7b3059a30b43545daee782dd2df6f151ee23791c6d968384d141bb0183ab52c3f9346d3965746c4fbd2c67a83ea2665a1129cc7694369f87e1e5faea4fcc70fe7e21cca9319b469f221da2a650ea41d6d398657856d114b1faea0ed7612bf74d63b04356229e06dd34f4e2fe61b8fbe5c61fa685e0a1522b9d6ab56e3469feb14bcde24f32f8317dcd2c11a7c738cfbb87e3e50a98a61c6fb4fcc55e2364eec61707598248bdf9702d7407b9db9c1823e0d0155a3f0c9a48fec4c1051e8dbf5a9c9ccafe6c5b05113e4feea986f3a52d573b5447b4a63a557488303e73847fbce0d1676fbd4177e31027e1db3f28bc78c0b0d3423043e20aadf5853597a651bdcbc332ae7b7255f6dfcf267e4354d847c8da261d0a7e7e5a049f8b259d2b8aa3be6502d73d3342b7d57a1e9f3dabe924d01ea7aeff3c98f659bb7178e0f29fc25718914ef32cdff4f1c2d29ebcc36f1c6e238555f21c0c44b4af48a4bb0d28168b0503937e500acf881281e8008b82485dbe906ca401f8edee67cf7f177e959e1661f203579f2ef24996f0b04b373f5d1fca92553c8bc7332d6d976f9371e10482a054578f373967a2be9a6ad925bfbedc9c0193ed6e461b63f0afa2997b947a5bb9fa8b5a0f68c3ad537ae07619b525095a9aa4db1cb4b54213d986c93ae18e0b92b9e24c94a012ec5cdcf7c00ba1fb416bb11d31f847436b886c0d0148679d4d556d7af15b304ff32ed1dfcb5136f9174d04c2425abe11d10f03d62b4ce4ad45b90ff7b04c07199e3a486b52e2117cac6a27d8693268c2675867de5ec86e277ece03c47307456f9599d8955c74d9b4d1a54aefe428a11b927494199698bde1ffbf49f9bf05c4b27d1c79e238aac9d2fa53b61fe4b9c917f2ce9b1e7b493572cea70f9b2f017b33c90e6c9a282cc41ace227e6af5bff0e5e57bd25cd2a474d037e46edc4ee71b3359f7a63322769f0fe2dbea93a9556d46e7053149aab757d83e884ca7ebbca53c5ece0f17df7f001ab0654abb0049e0036818a5150b2b57b2271db12c1109d8dc1c3b5939bafd49ac64a12bbb1e76a46d491ee5490eaad267134d0d9aa573e7ed45a4fa839abe470d0b5abcc42d7668720f4bee69bc532151b60be3bf914887f49fb2f7df56984a002d0346e65a5d591784c0e74fda48c09e1cbed059558bee205b350bff566f65ff0dcce951d1189769914965cd429262fc70f94b8bdd89cd45f7104fcacbc1cad55ee75c7bccfd27c7782f4ea0eaece4d07ffc342db37af691a08d57d9ea933be96f4a4f724f562e3173fe51f2c68aa9372fa55e27bc4d8d01a909ff51a547d2accd9fab68e56889d165895ab2799ef13f9e805f7fe84d4af659ad7a71f2b8d7876a57e8f6574b2694a86fd17901cfe6cc9fd612791c3fc74d0dc1c57532dea80f6d8e75a0048227e487f26eb16a114110b7ffd8d1b94152605d70c3dd39d35f69974a2cc0b297e1d2cfa5d1f81224bfd7ec0b370c1aea738d415773af418f3dee8bf4974335fa3861cccb9d157d21c8b474fa87b640319a3311e9a960d4d133d535447032f8bdf85571b044d08c26c7546f97d3a5e6935a015edc46e3028214fd0f62f74310b622712a271393b5c5343ba793357a6df499309e77f85ed1e2e3ea10ff6a7ec2906e0a69fff6fa82f202aba6f8166dc74b83e9537b6fd437aa71d6a45a7522b09a28b6b7be131a01c77e70cd5ecfa04c42c17661ef2393e5760fbe53d3495d84f6121c02337c3805642bb9367b7b790db577f5b6679bf71e3913cbc8eade69c2564e24b5594d052477953fb6669c364c87c2ec9af21464bc03a2ea11caf85c32c7c1e5f74ebf64293f420eacf8ce639046e779ab20cb32596eea0be6361141baeae8734ce4779fa124afff905874be625e796eed41b3d418db41799ae1d2bd423f8c44b6d7c858b180269b68bac6d78f30735dfa0d9dbf6611f31e747bf7b5c79bc97d5547813c95e642409690ccf102407b992e1523873bb80013b108258226fef72639e3080dcfd0c811f0f4e140cab42095b66c8335e669cdae82e04f9b0b389498f03abaab12bac23cd9b0ab111e9df0aa6ba2f06391fce72709997f33dfb08342ebe88a6b9cf6970be73ab3d3919d74f492831cd81b4e8cc5d641d1d61f1d59a976f8b9de60009829e3fc9bd1c1a0ecba7b56d3ec416be2e704b9de0769d1c8a152a9bf487ec43a7840efbe2a0ba8888bc813027081d2ae6bc6ae349d5763b4758f20222817f6f26701dd4d9960f8f051ae6ec607de819b413de8e5b5358932de7771534a1d18696fe3040c52c5edd08254690c706ddd751f924a9323bb8a6b56bffe113e2b01a7619aa2e079d3d3c31d83e347e56f096bd0686ba1a3d44dec91cad26bb2f9a600e661433e9c77d588e5292b742d39d413e9a217c649d9c9cb1cdd46d491ebf2858af0b75b786240600a50044aeca515adc2862ff0418a139992a22c8856ee67312d66dac287f7104744c23ad3a130404853dc62f0e834acb025cbcce69430f5a8306910a04ec2295b8c74fa96e63e5c1a316c828702b35fa734e70392697ad3cf6b737b5d009d23bf8f871d83d1a5ce5e742b449411497863e3e793a96e2c21702c3b49d4225a78156b71a74188e5949cc896421bf10a5666f80cf5af95e6efcb7b451ffb2eeae6772b36f6bdcaa62e0ae1fd36ad008388c9d3cf604d4fe8f3cd0243c10e7c5cf176ea1378d8ea5f8c108a33c66b09e89d4bfce54554c80930d866f29762aff4725435e4f7819ad2db48f8c1ac0ed1506fa86169ac218f64132f2000a54c411ccfe187e6a4fe2a2fc29565f3effbc2cd6e3735ce611ec82c32d9a4c6ecabebaecf42eb262318085bd12d0684c9c849f8e5f1433a65d123ddb709431a4a93e41a309c16b56b7136d70cb51fd1d4ed18cef7a86cae2594dff6802e44a948fe4826cff3bc19ad50ef1ccb875b25f5c4e7a4b4dee1a8bbacf0dbc13e673d98debd8f8323032cbb8a35e504837c646ac4ef6ad8d7585d4d9db1c9490d1e032a5296a7a29d2c1fc25b76226dc7ab63798df57118340be5c2def7c28f64de4b4848ed8fedc740f42a2873032f2657622a87d48505c442faaa1f65a1430b12a606ad4cfe5f4bfaaa4c6b0816c11893b639bb187a04cfacc1495fb37bc81662adf2a060d932f0684ead4340432075198d0526a9b1cbd522dab4d6b6b8ef550cfc9a52deb188054e9c1f4f5c0d466839b1bf4521d469d9b11b20aad04d569f807bae706366538effe9723493c70964f5f2194c3f1708fc5cd9554ca303c196ffa4648c654559dfe1870baa521ce954931b7b45fc34d8a3a7894a30e9b4cbc1177de5d19f9172606537300041ba71526830524b54abccb1e1e59cf5e2c0de73db9e6d7b93a7ddf93c879177d56c3c37594f0578bd4098e74bf90e8cf0503702baa0f6725d3a19476902aa69161111d80284f7db1a43320094093dfa84437a2c3ffe1e9993195b552b3ebb48edd08d18d5c5b974205f8fcf3fa20d40bd5400f06b0dc014c915b6a79d5ae421fa551145dcc8a701edbac320b8768d45732b2556123a6f9a0346afa344050060c43b99faf320d69130d3b0406e41ee798774b6da0ecbb3947be21553c9ba7f3421d901065e534b91ffaf65ee1179de28e80b847cc24c522a2d34db674de7ba5752d267dfc9eb7155e2888ea51fef8353a15b46c38cf11290b196ecacf42dd8fa687ae5a6368d200534a5f93db51608d0fe7bfe94809c49856e8d0e007ef744ccfcba9ab62779814a595bee78262bfd84560a84e1e93b02d724fe3cad643215c46a1db617a98d0d582ae1343d043e92e7f3114179c1b40a10f2d45870b734de192122157531b0f4ffb44299246350e760d8aea124681c9e5a267e8c28f70f241e5555e0b355e1876191fd50a3023b545790348ea17f7bfc6a3ba9cc591276f237244e42ff0853fa54bdf3e51068e6477aae0202803acd9d8d319a1dfc1862a8bd09c872cb26fe60607677755092e6d24fc7bf03db768b4c43a3617df568980b622ac375e681c1e194304434396b0c50cc793d0d80d530c183a5d08122b904ecffb42ad1d5887efc7c0ece97e851dffaa7ca8d8055aec9190421656fdd2464e9fd6619414cccf93c892e0e8101061ce1a58c0a09426366e6005ffb7722b5f4f750cd16f0d72bb4f0d15102e4ade97ecfd9ce7788521d474f0a94e1a1b82f543e4e3d425450a1db9daa7404edbc7d8f2e4ced1439b1de37c23844dd28c1cf7c7145f5c82e6d98a15a037d724443a375351c1f3d47c73fd7d35950227f369a671c68e270eed820221b4955604b9bac760cd052499d5371928b44646aa8d72405c29b8f5d1afd2f118ee41cf2e4d78864d19f80298ee0deed0c5e2206a126a96d71d163ec7a89192c776822ffdc49ecff56cfdfedc160a99fe6aaaeb1716bd303928ddb9405cabfdce38010657a3958c9e66d12f6630dbb57c7250f0d2588a1b734f06a61c7543b8d46a3d89527948167785975f9e9b22f89571dd4526fab3f19bdfa3f5578594f649fb81de10d3963ceda0216abe865917ab9a13fa44410db2db1356e4ac27d318fb783140199f3cf2c820b4f053313b730d094fa141f93150cb70fa96d050397c6c278233d8139f89b00333752a90cce05eaa67f8f71302239a4a941da942e9435c562058ea30b4b657b756f141e085190ea7d540c9657e386cf1caed24fbe3b81555282da838bb31b19f76f5def5a97d9ef7f2b4cccede67ffd041a73683148501f6a781e1d7d8a72aaaf1f14450e1c6d22091f4ff01056c5badd9a14c8dec3051b44995ad499d1a23a169a2b1c81285749db6b8fce5a1f627882bbd10ffbe238e9751039d4f3cfea5a00feadef06608fca22bf19936118ef3505183b654d5e009b1f2ef77dbe315e4291b0ce0ac70cfc4de08c7198b80033afc5e2217cefa15a01c3e35e9e635e6b002a84dd585e00704f5f6d148e509d7797f736084c5273f673e3cb9d3c13287aeae3827b167352abc628e52f11bfc247fd3bc9e7120eb97cfa1183105c3c617eec3c348ae585917db3c72990a172ecc2b63908519e21f720ac0ca0d6c114c46821054d1e14d2df0c1f9fd270e768e74fd1b5fc838f78e04df83efacef092c926e287b0c511ac474ad086a4d2ae665ccf0db77646caf68783113de36e78443e77124ad7346a80ee4769eddcb7ca10833cec0c449cbadb0e3d1381b4754a61c1ed60e763a9d5ae10fa30aa2452644c4d9154217be52cbf6fba81b6c24a06316d53f2f3c3aa21403cd4f16d1bc5ea2b79c6710c68358b987b89609f78fedc86b60cbd68817ddc7d3010754bdc7ede9967750a653a64e989a4d4ed09ca10434cd24e6aaf8b3da961a3b32d25e65bb0615723cc25eb6ebbc2fd01ec373c021ae9d484b69f44ffdaf1c687edd3100a42e46accbc75bd1a46cc5b09a37fca081529fce5fb143f5e4d81610f978c978a81148f1c03ebd15d8165fbd321c16a48e069387e6bd05fe411fe1848e1eec19834a85e9e9870447e2b079840aa546b4a3590b5ad0e1c665afe2ca61407a351d4073ccbef35dd235f2104a9df9cfea5a5e23ed1ccb76bd9fddeae49327accb2775ce7d40a018b3256585bfea92777c66677325835db60a0e12687a34ccd111c2cf2664d5846a6aa41e25f2a54a133ab981396ab363a219d60b52e034f8e3524118a32d997eceaad78267637fa71efa208d1869a51941676aa476c286c2ccd578b813d634d5dc48bd9cda2e6ead3f9a4ee453aaf7f38e6946d69f05bdb25403ec08adc1188f28bb46511aad1bcdda92cf5a019ed76852dd8e5c891e30c98cb9a907412be076f9f90d4670cb9adab7df49c28650d2399fd12daf957a6f6d940aad967e485212330c4355f4572fb793b9df7a8f5f551976a6d3bd69e915730a7f626dec04cadbc055649033b06ee3675c8e100ee42669ee1c3161527f471e78f9ce59fc60b1ef59bf27a65b296730130404c1e6e150c9330f29a11d49546a65d1c147b7808cd238ae549e7fc0fe77b4f6101f4e5b60526bbefe02461631062dc41ff584d51bf5caf030429d8a81cf729e1ebc88658fb0ddf2fb36fe8773fd8fdcb116b86f2ddc91ee3bffed47bf2ce7529c6c8ea8206e9325973581cc6c4d7d16e758ee8193897679a7ca4aa0b944abe2ead0c271d365a396dc54c3c72a812d3eb32d6c7e2deac172e169a58b16de051f77feab32a3dccf57bce855255b997d7c65f5b65d60b5b9894e1ab5a16244f3a7c1bc909040f7b66b35567a43fc6c29f13bf8da47c3b0820d320593a88de5f277b08040f36b4e5afb8836e2d13dd452f6e7dc7dfcefb7e4b65cdf2bebfb704ef182439fa06439412e92720065744a585a469b19864854fb8cb6d42772f40267483e33c52def23bddce97bac945a3784b5bde6550ed8802836743b45f59b040f67dc023558d9b8029b7bd90c736f6e7df474933d5a0c11037a18511e99abc4ecb3300060b97ce46181c4a88532d15884fa4ee68a9aa61b4bb36bffd55f7617f2036d4210b1a037e89420d71114e66e06cb3f7f1364a888794f96f8bfcb5c70286b8629ceadf566b8ade9e34b5de6c12c23aaae428194ec10b3510d4dc7d0fb060a296b4d90c5dec9e136c2b42ce0e163ec81eb8ad8cf1890f9019d6b92cfde67c252eaa17a58eb46887c8b837f817ac269cfa13be20dcef9c08b72cd661a6cefbfed85e9ee468b75a5118068e4e266228034e83dee1207e221a779fb92b9c24f086770e589c1b882cbb9f536cf476301620f7ead8fd7dd7e83b6e4336341204bb46e10c8aec6182c0539828089e600253540e11861f6768914696b90c0815fe29b4b117522da4802d6c22df2632469e32409a4388afa6c03d534dcf79a80f1cff6543f7a4451be1b403e36693e8d393d03e6ca7ad9d8f5b7219bdaf1b7925367462ed65bcf8121515ca6ddc0f2cf79709b66ccb2973e5abd1d4417e3d587400ba5ab9670c8964d71529133f5f6a450e14169b1a96eb2844ad32cdc779b67bd29dd9874f21a8b7d1a1605153095effad8b17bdb025fafb70133b825810d88a9ea2cf685deac1af9fd0197656caa134fe6c3ecd83592a159f84f841404141cb8026d52d754f37ba72a9d8d21d98275c9a6872ad6618b2e080c2fe564d9f7055bbb9386118425cfd7abd4aab7bf31cbcb311ff2b6ea3ead72191a4338d9811a416f1bdcf4b7dd566ece9df7b6566a9a066b7ab30da17bd0700417f436b86fe61c1daee3f915dd0498cae5d71d2930ab029b0ed376b97e7b0876e057635894c1146e7884e03bcb4d552be44dc3ac4b9bdba77a17eaf39073b3f72e82aacb3429862cc4641ad1784b6e2f22615982cf804e9c496a56ab15ba61092ec123c7ce0345f6b0e2e1f24095a3a0479dffe8b5593b25b0b5a38fa73d7861b08dfa3547d0c4b8c6eb876d470b970c247c5339d8355f60afb220a7168834e748dae153d9decda88c1fbf9ec6b86f8beec65101fdad886594f2510c858ce39b784da9bd380a38525a7dd7f5d26025bc4af6c78425e10e9eaea486d40d53171cf5330f734d7ff55fda7d7b1b07b1b330e0280fc2db4690393d5e2cb940f493c763beb04365c5ad388f8eccbc4f5338e907d2f32a61ae39c4643b922f20d9884c7dcd82f668c4b1200e8c8060a6b27f8396f8777b825a25c893b1b6f59153214141eedd9a26736ef77d2e6f61a5ac1013b9409365d5079d0dd0f9caf1cde34d82863d9a4756edd2c9998517e945432f5b973ace6daec8af09fa23b34f54cd5bb75e4854291c2f61b571f17a088d6a392a520856a7d545ad815fcc8292299ea1fc3d2180c71abe7ae874dbd5f043b2bca2f8a0264987504be49a4c3d4820670facb8d688c5b7dded465c817b568b1d38d36b3bd8933b8c54f640ac0c20b462ecc880a1f5d793ed08ccd1e72949db1a390cbb3ef1e9703313756da8533848dc778462ab96c8325eb5236894c85a577f51998a7b8a7f080bd67818faaa59d39ee90d7b074eda53d3bcb87b8b2ca5a4c855015f75d82261629102f5e64c44700ff479e9f487d6715acd98951adcf36e9b732746814bdc7a36ddb2d3bb0a519bc1655016b649b3bece6b2753eb573ce11ecd9a1815eec6ceae403512d87f1dd7cff56cd31229986c889fd807a1a3f7784a0c526dc271efcf44316991712e6a8223436c159e65681127b1f646c33343ea2e564919e1a9d4262b19be775001190e332e1f84f3b6d5f3e18b918a7c1f91ec8ed97719edfcea053b7ebc02c0c17a15791c63eb5755bce45bf4493ad7261bf5b4ffc671d062be05fb4328507a371c78d504041085c0682f24e1b39550e8cfaa7304967d21413a12a94eeb9d98692a9b24838fbaf29c60b4db26f2952ca577b72564e59a57e1d6e6adf3c9feb977af19b8e39effaf87e74c3ee92a27ec7226bc99ee28bff046b24716a9e5846884f950b9839e170e6f216a4491365d69d6f9ab0aeb83fafea57cfaae0ac32fac63f0d6a8a492dcef2b81d7cb9f9ff8361cdedbbae4398185c432c158ecc4aaec1d938414c891d7db8814ebd4e83a970e1c48b4c438f02653534996cda830c0ee1a3eab8c81fcb5986bfddd56612752b42a61f1600d503a0897fb347431ad639a7481748b5feb795d24034dc5099ea2de65817cdb3960a8a927d82890ca4d4618b728f6ff37ccaebb92370c55c3e95c559663b1cbca9468f1d14ffbfe68c117188b477e4ede69a8c3507e2112fc7ac7fb069ebccffc8ccc0742b7f18402711397eb2be7aa2d27ed69113052ae51a6cbb06fcbcd21c0a74a741778d898b6a4a44901f74701b9ecd2d050b9846c83c89efa42479852da1413f34ac457c26543231fa9070f3288e18487287a72e809263823dc930f338fd8cd0e03573e9c9b86fa41c6980036c3c3e3af1a74d7993faaa2eac60015ec65a303dbfafa542d3d90302053a9a0429aede0b30b98fb1a0547a6c0517e737bb2d8794c7864bce1dbb9c1216690ed1415d394ad56ed5209eaad42981e5f14bc4effced30c1cd376b8be51fab2117e5ce789ecad8d77b5eb0c8fe9180afbf0f06b3bd172b0527f1ba5dfe5726d6678763085d71552047de6bf13edb3e20eb63166bb20d8492c6566b1783ea5869d36e4b602fb01174d1a4c4a34998f03e5b0383a9104a766bf2e1304cb4f47623eff043c20524d56f0c3408563f50031b3175acfb88dd4e75510f1814232d2e13db531185fb2543a91e60c8dac8f6f0c0f64a7f3698fabc6837a6445c23ebbf68c9745c612449f43caa4fe85a9482138815d0f037d1227e42551ba0f0c46a16a1a8e38fbc7c6ac38386878c4bf8e9294b9bf1659a2bb5a78da30dfdee9af2ae5c9d2cfa9cadc4da247f91b4de42c385b36c4a7aa62446f3c4f4da00b69acc70495463c56ef95c00bbbbe792eb325f36fe256fba2c0db5f02c90197f120ceb8c4ba3d73caa8e8e288aa6aee9e17f1a881df4555864dd525e91752014f42b75b9bf453b2d871c0090c434d060bdfee22452cff66f32b7809f1899b8dd5e9e4bafffaad4763408d5c577486aa791e77658ba3b077f3ab8ee947109442f4ab0d7703dba1e2b1c2bbf684771081fa6dbbc33e10b8fdda83dd074cb09dfc26a04dfb62c774156d5de01cbd9f26469cdfd867b582e671c018af909b2042543124df20490c3882d5721720c7f01ef45d9c9369f237dd79f6399708dc19a29f2a7ddb95de6e5af6c91666a8d6c816a74388a0dcf26b5e12a851ce6ef18439e76188eb99f0c22a20a921770491c9c21c6314517e84cac12f4bb8ba7a1a1dedb549c7983a347bdcb37a371afad7ab95202d80ef0a9d7a557e1f174d531b68c2ab1b27bc2e2e84d32a5fbed6a4e5634820833daba2fe57858ab78deefcc7246e28e1cdbafa4c31d18f2f40b2273de2606e21f20b56a0638033fc711ddbab87f889f244cfd7d72a6f1ea525041fca91d913d98e8f41615b94980a8c49c69081236c0585a984d0950b3eb5efb8f3187ce9963b9ab4b3c29dd5fad7e2cafc154d2e1be1193c0e6a8236ada852a10ab2167fd37d65706f8cc6ee7bbf86ffaf3e850446ff9cbff258d5d508a16e3f514bb35ab835373f2b623310965652e178c3acbacb85b71beaf11dadd96ce1eb24c9ec4f897077b73333fecdb18954556b43d5755abf690411fb15d9261b6303a74f9708d83bd68823736164ef8366085dc365fcd4daf121fc847af3cb62521fc2a043ae76c137f3c385b53c207e89bd9460dccc88b63bcc739479876672ee77c2a2ddc5f612ac53ddc139617adbeb5af1b7c5c611b012b5f81d990f34438806fa499617d051e6baff0ba5faba38625ddb49771db0959706d0d7ff40be5a9639209e73d992519e163157ce34a3936d077ac75cdf2b9f450f73f2bb2a3fa301ca5320a99e778b8e30c905fbfed786f2716a711487ddda169022d4b335e0e59de8e9ca62cb41769804aba5d45636823b00fe9c4d65ab855a548a50ea6910a281ab0ae0cd3de756e9b6d623c6c6b3aa34079a957ca65a28b7dcf02a443923a2e08161583d3099b286fa6fbe4ad665abf7f4d9b877cffae25b4b9e4452f8a2a0f958dea60eba93192cb0250ee9fd4da8c96d37a4acce82babd3ea1579aa848a39493ea739237bb422c6d039a568ca40d6022563a5ac6f7f152f540bfc7bc6c58e0fca6ca57e3ea78407ebad3157ea0c216fb63505b03443e32bcddbb5c03a3965972d5d30d35f7f1ab9cf5908ded0bef9bda9110ea39d2b6e9a9bf8e124c4aa2e11100466987cef0a198f776c0be72cf0bab5524e12ce254661e408bce760b87289886ff2e99f1b983905be80f5d19d8b91f89362461afc525f3528f5b6cc9bbdb78d390456efbdb0de8d9851301e96f3c64fd4d5098c92b4df54a5faf476047dd316d79b1daba30a41d8d300edac5c04ef1b098116f012b4df2976861b635b8836eb05e9d55b4dd63b9296f487880fcc95d2d4b0d8442674f7a812bd6e1221a074ddd5aefe7fb1142c0901a72c139ac52dd62e2a33df249bc284a18831f76a6aa04c3642857fdddfb55025d6910626f7e3e2ed20d71202e31b87ba1b7c213ba03216816c72fd79f2a14c985d4f57e0b1622eeca12c9834971d701a935a80deba7abf2d19b944f64b5012531443fd5975bcc633b62a8f61022022e66e02be58f3f7c381d544404da1e2986b442922f5e369aa29e6fe03a6eaaf02423c2887c4d282b085cb8045c0e30c67ecc02bc12950d05d3c9f225ca54a78ddbd2c098e6f738250153a3a70c19fbe2e14f1b3820a42a985c69c4da6d1d7aaf207e89caa498b4ba75187250ab2fea4d526fc10a069805362d77aab1204ed584b3b502f7f57be73d909e3e0fc86772440f258f12f7fa3f45ffb984b9abe4b0b11cca30fa2c358061e2672d77a62d16e63a8509617ac0b15e3243d9b199858d4b8c452fc7d2c8e56e620ef0998016a31ebc09b5e20d9ac284534f87384430cff156a68c062eab3fbe1a91fff750727d09c50ef24c3e0c7e3ac5c1ad33df98e254afc8045a5f9b350a28989b323f95cf507a6a6fd6cda36d6cb208622bff2faad09eeaeb037b5e9e3eeb530742a5577f42b0b4f2059d60fe9bad5cde69dc66cd6a369fc2c9bec6e423436badf5ace0003418ed0e36ec65bbf0d54a532aadedc240c4a17fd39639d66781702d76311a595c188b901732c53db54d1d010358415ee0184570ba37d7263500878b2da0884f174d22503aaeddfeb72008db81ed857c8d17867275034a598949e0f8518468c0a44163128d07fe060a362bb79c2d8acfd8514662b8f3920f6d3a0e29565b09a8d9baa14857c10039c4c2f819bb17c9fa85dfe01a2699d571607e2f1ef6d8af3adbbaf1deda72bf18cf7af898adb02932773b62cabf7aff61cfe58106dd390be401e13f7d7b7a44d28966c540ff6969ca1efad89078fa8870c0c9650f0d8120f1ccd8b1f8ebe4b06f1633c03f92126c3ad1622c49e8ec7681b78b228d2348fd40f67ff40dd2c35cae1e3f8be537882c4f16a8a56595a6361bedac644d006b2438c5ace48aeadf9ba7679c2e906d28ea6641a432ed777420001133a4fc362ae21461ab88c0f55c3bd3f00c1831a2d5bd2da93cba5d6cfcd3979664997cdddb0d475e5e6184e323824f5136782a198e9585c9f5820fb72518d5c17beed750aaa7f9af054124a28992d4ec8ca94b4ee6775b44a25126bbcafca1e95dcbf1ab619ddf5c197af4cc3dac1ce9e0425839159a6a5b45a392e71328486152eb88d102ce71328d7dcf7cc32c7a40d4d329f64407837056dfd789540c885a4dbe0bb963a9873f9dda3ab1b1e0c7a447ae4e7a46a0c9fb7d4642d1358b6d408b9c6f4ea5e5c54d58ed3c7e60db30564e5b56449fd7e28a38e4a8a185426ce959392748a6b21490d0c0918e4983c33c074fee7467a9df5f7533b86389eb4a152cc44b44d43cfca3cc7744c4e0d1e637cded561e04184761c5459d2b2dcfa186f3be7b15c3c4862ca8908be6ea66bba96ea7805b16fb190ac35d82b50ff59646b1d9fd9626bb424ba23bd29c5f7a441ea1de7407809bc511e31061807f834bf8428bbe55e059a596ad96b56fa3a3654310aad18c59c426a4940132feca270aba77a7f653e9e4a21b73fb7d7d0c15a15675808f1d2079422df4a808a944f3f467523db72536e60d8a97cacb6070db6e96fe9fcf53c9f5430bc56d0d82197ef91317c4c12affdb6ef788ba1412601c0ac51606021df964203722254e9c2d9d03869ffac2421b76605697b2107c3cd962b81fb164381acb8398d14e455a913863de290448127cb7ac52ac2300e41a8224e9974c03dc6c33f2adbed821b6d081976d2a5ac9e69a33be78e7d6b1ee917446f0b00e35f1562c6a0987436c46ff896ca1eb844ded473a5b1d88ffcdd49e4e5cfd60a04b6968bc472634f55bb13cfa75b0586490a0ec84314ca4aa32c44f84bcd413d2c661bb481620f055bbd8c9ec4fb33fa92dc8ee42d95db8e338ad0277c374d245a2ff87eae4bfa5e5b2e2f18770693df9aa4c04c009949148a9879ad24915bd3401224fe6103a2cedd86fe23c88d4e9371a0c9d31d384602fa6f02e12f02649598febb58c0484fcdc456f6fde287f3d186b82f60e9ec8b533f9783086a4b78478d2553a1fa72c32628933fdaaec0b2c4c3bcd49aa8b5f5c7546846969980e7d3b5d2c9e16c68326da3d93ff60f2d6ada49b00559b792f2d91d3c37d73a14042a16449bce480ddbba8d57fe8ee095e4940eb6ec5c83820d347b9a6e64cd2661b840030df188ec977e5ba3724cc75f194396baeac33ecf6d5ccce06aef27eaf6a92ec3f51cc67000d47880c6381afc984c4a3e79a5706e5951f32ffbdfe73f972a4f56ffae47dedac735702a2dad862e12d00f75e025fc9df68e1218d4992d7f959f6d26b8db3c7e89e86a1bfe74d64cf294ead9c72991eb0a3844b07f994e0e2ea1a7422b77005f26b0da05489198d7705daa69be6abd605048cc00cd39b7e7306559cd93edac0d7bdab928a6fc0727c8ec9357a1b2ff4039b06764005e2861889726c61929f20bc304f05009f9850162eba046ad9cab0f2cc9196f8cf20b4402fb2295fc9ac201a1c775d6c2a82292d3f72aa5f104d8190fec4af4ab8d27022c53a11e2f16fdd15ca287a187d60425678d7cfb0c227a875f6272289e0e5af8adb8aa4b135cf8ffdc5e723384817d9b802a1488e7f5a67a0dbfc3680a4b3359c370dcabc7a04ef2cf6ff61b8628949f09fb94e7c38ad90e076d51b7dd7d7bcec28f86932ed62c992c32e549634325c8e0b811b962e64e40ce4f0a15c82467ad61941655abc617bdbe9d725da319f4f4e10a2d0943e178b897fea9edc0af91803d049e81862d5e909a1c956d35d264009aa7108431fc9be977188537061024966a53514ba649ed6c139e0befcda314367f53378fb98343d342b0ab117c785ef89d4fead4a603fa94a00e901fe4cbefc6aad5fb01f9d0427566e61490d7b5e6f7c196c45a6babf5759c03b7cd325bbf0dec32d704f9bf6c3c67577e79583cad8593e31e34c161a78b38fae5a6c23477387e409a41b69ef9878af306ef1245b734097c38645b347041afe3aaa39dd5450a385b73288e0d69edaeda1e6cbd1499b909550f7c70f0637a1250f792f13a44a9c211b5ef773a2229620445c0617fa954c7b0fad8b7aa03e38449c45e4055bbb21370f32d075f55f107a31df932e891824e0f0a51d945eb53ad539e3dff01b44eac2d47bf24a2c979462de738e3c8206c9ddf9d37cb9f2a2c2b873fad9086e15cdb65bdd4ac6ec229323db1de2fa6388b96397727e50e87e7460497fa044fddbcefd0fcd90572fc5866c00dfd614efe70f3cca4eeaf91bb3fc913ae8c18266af38235044ccb368bdc2729603139159bd1df5e2e7c323f8d60c28f2a44ed36f5a7f7405638679d9e90313ba8713cfc12127f13818f9208de17ce200611549b1f05bccf94f22864d8fc0e464f9d83ad0c7f2435a501e47832b47b14d4834fc29b380e8870ffdc19aa78d25193973b361ef93b87de69d3e5a08198efeb0be067a298db5111afb2bf71b38b2b45d1b35e08fc18fcb238cfa0ad80d6f7830b439e4e379889a604db612faaa7a270d70b3dccb3a8ccbba3bcd9ba7c2c83a8a88b64518b9efa71d990ea933e8d69c1093df6191b9a94e4d1801b5d8e2c1f1669fbcde888be298fe514a6cf55ab6d2f405a499d233a897d37f3aeb7cd1eca274ea620cd037358355ae24a1eb18f689b0544a5b1339c088c758c7853b9519cd525942ba268beec36e1fda4573fd89955f8df9d94c5cd0ded5d51e08c0464343ce962dade6c9d90c08188e9ea51caa8655919b4ae074b397171c711af232abc6bfb818712460eb565b63a0a842c4d1065a7757f8290ce3f4b989dce2d453ea2885cf5362a77c8fe2d46f180658cadece06b63f84218657588598ded2a980dcbf134c933f0171f30e9a618e4b5873d334d4224b0988090ab86ff1dff06119c7314d905d20c8efaacf7c265ba08fb3e3b89afccbd4ea846f60ab838fbf76df7556da4cc87876c16945ea263a4b133804574ae7d67c77c2e6f27b4feb10730566d3cf707f017ec6adadc0cc29bdd735785390c8db7e4d6f79df49ebf2ab0e6b20695dfb000e7538dcdd6e2137c98e1373bd0b6f5c15d3ef9e2601a7a41687fd460879c2286bd473ff81fee41ffa6e05aa7727da81dd0b72744775983bdee14e462fce7b0a69f7622a6cf5338ddff46e68448fb6de554a405a1f5819204e9a033674f158110eaec0aa63ba3cf2422a04a499cdaa212b6cbc0ab52d58679864bd70ecd87983d2a703eb7ab9caf14cfed49114cf42ad4c6778b109db3dadd6f58cf5ab773516cdef7ef0cf4d5cdc2ecf3e42581f4ee0b3374eff375e5901d90a85d36a14d97ed9a9142d96f5aa2a0a7a456fa9087fb293a3c3ded004816094218d251089280fa9b73d44dc03d176acf11f9069f35146270d706f0ab17228fcb2915d1366571eb226f76c8e299dd1641a5100eec4d28c8bff857ceaee27bd15a7d9cc79184861e7ef5473254ce88bc8c971eb113e08a26f760018d24b23914196cb623db85fd2452e427032a6199f60b1ae31a2c0ade755a07e58e403cfd9af79d2e59651e2ab53eab6aa905eb0308e83c74ca1d83560033df90b83aacb35f8b431fc004c04e4d64719e06d250fd42099d1562ce89a7744335e1b410c66bfc547de277ff1cf77dab233ab0819d55ab83ea7b68f821cf664beb9d74f76e939bffdbceb5169347027a4eff38905f03293829ad96be303d78c5183ef62bed2269a4227dead10fa488211bcadef93285f692d3644ba119cc433e33043c6f006b01d38ff522a83d8e95911447c13c5fb42bb9b83c433b2a495a0732ec85176f28336a8c5b88393320e0d827cf460c7b49e9ffba8009e69af06d401fb2dd30114b9fee9cee2650f6d09e7835540ec9a89f773609cc8cd55158354d5c11ada386c4e2aff206c8d5dd4d4f932c7cda9a4cfbebd2646d0c427deed9810b32265cc0a8a40c1b007d53cf07a62208d8ed057a6a4e97f3973287a95c7efbed60b35ad41f8aa765ba9e5ed6547ad9fd88e5d8f12a49ea0f56ddcd7123d75fc9fd9bba7b01c48afaf1805f8087360dd28c641bb1b775574d41fee64fa1bedce8ee6694a1b905b4a91c7da29471112b6e1f1710ce0a76736871350669e1fed6601e84378b112dbab21f0816a735906bb06b4d753659af0353550376ba294bd1b7a2ce09f5c3f7a792b254ee1665106364372ce02ee01d13634c2f396fb4aa1a3c05b1af80accf6dc44ff71bb4f2b98a906f5b68ea333ab03d94e1f27e3bcc09d5163202b44b235dbf5140af94645a865b68e209b30863c09b4ec04561db0fb467df580c736c44c23fc5aa5d8f7f7327fff951f26ad25b78c220fb3f9dad2e846cc4c7734c95635334ea5035ece2e08a62bb9fab5102039dffec3551e76d01a601b1e8db9ccbbf42cdeebd4519cb6c203fa267e87496a3d1b0d6a03d038258059c4ae7746030075371fe76cd001af0eb296a9aa00097f65771542bc74208e00ead838c59d02907365bd7fedcefcab3108f0138abf78402b8021339731c9fb99494e812bd3d605b262a1e12911206fd04b15ff359ea33a97958409f100a0550a28f3029104403a90c4dc3d5a585259df54d7021f24fada83715132dfcf198e657d341d0bc345298b0cf904e3c97805258c1a49dca51f03dbf24deeb1405afcc6af18489ddeeea5a14540eb80a7b9cfe5d8c6f4202a6b724f686a364a19d706702fcf4b3a29b5ddc68090cabab900f2e2160c39cfe4c16ea1f92000a2ffcf66705d75b90cdd44f0553bf72c2f472fd75aa3ce58382a5c6a930fadad23ee95bdc70d5bce262728ade2ffa93853139eebffa0d68b3dc55e416acb6acf4decaabdd5870438e771107c15a5adc520ec10a34f46928f5bc0eaffe568b06224bfa8a9314c6ac250a0fb6e7615e1f38725313e724a7ce415fb81eeaefaced8e33ccc2076faf6b0a69028d9fe48cbdc25461f33030105858cf7b86c9612f9355f1218f14d0b09f65e2b44e920310ce20ccf1595bc761a8dbbeb411d653dd44fae3f9a7f3c0a25afcd940e9514763f471039a269b99a111754c400fb3ebace5c6a9baa8d4d755c6b391b437cd64cae6ab52f3166ee3acd57874343a1babc893bbcd2209088e12db40d28ce34189d6d6f75f3a44bb1c2ef13451a1688f2d4d074c7a28932455fc52036637adbf4ea48f4db7b60404ee3b4b15cc5c7da731162f0c05b28c0e7160e511075e194ea18aece9b1ca11e95fec9a09be3e8d8daa273f60f22dd69f5f1cbabe41a7ac198a79b14598a85f438d472ad6dd715c357e62c0900f103256cc0b0ce380810a0c10144f7f1483bf56c652c05d3f3f82116e8866bcc2c5772697a1bba09c5812d0ef3658365dff82bf6e01214d141f7a4f58790edc68fe90a8fce579ad59fc71c807db06b7a0bc4ae1f3511302c743b9a6e083360109641c46839400fda377b91c7b0d617fb80471ae6db697304aaa29419d5a3f94a9ffccddf702847c17f05e3bb67c35b237ad8cc994202c3f354c1d059dc65d5729f1a0a49181e2f5108a3824b004fa67a0b8d1681e727cf88a939328f747175c78a1687ba8bc4a5806a06c9379b3568be8958bef70adef59fa5820ab8a4ed0c56732677a60e77cb376c0112590eca9ff595e1f6c3e2c9252a9ab7f2f0d2b28ca56db1aea4f831d41a1f1329fab7f539f141d3adde745d4414ecd3472bf447cdfa488335a639b0f2aefdd0b3e54af7ed0b75d671fcfeac18ac0e8feb541cb92d3bfcfa1321caa82c91b7ac453243106877403801bf8f451d777a2499a36a400773128d0ae881acf1e457965232d80c9190eb19b20a43eeec5834b2e808e3bbedb56861fb851c06e3b0c3b013654a5619ff53a062880be558c3da9c2f50b9ed405a1b981f55c920e8b0223fd5e381c4760496181a6b03fcadfc66ed0d033b1fcf26f973e780c91c5813001ac4b7c147a91bb4cb8cc045a2f4736a08154a92c75fab83c65f4711b7ad2205a67190d760e75f86f61a33919ef7080de7a83df1f8d5f365f93f6e99a675ea00d73d4132232be730b4facf203672f1c5cb9fd3dd28987a9748eac6fe9878b9d03773086d72f74efd6e375413a2d06030dc9a0e8c2a7752ff99442393a264ee859cc2b5398e51512df2ea64382bc80b127e09f62cba4fa61e54f31e20ce967761ad257daf91489a0ad2440f8760e869e3e2fdad9839e53a35456daa008213d8406b4b78d82f060b695c06caacefb4c15eec33e30447aa054e970d839596b3ce599c264f79d6b5babb7d9cffed501e26441bd46e6403f1825a5fba4a8828e19247400311ed65bd3d9b89be0288ed8ce51d65098f1852fd837df324054ead6cd77e1c5b66cdf59c958ec7a798004d060e67b99350da508e85b83370f38809b73bb4acb08e7f837c5f4b51ac35b2bb53eb62df1b02aee48e7bdf3612873744afbe56d00beb553812b4378e200c03896bcc1d09688d7d0b96534f47bba6181507d0c38e441189e8aaffecb958d0475feca8ab7e62598e7ba09d42a9eef807dd9817b5f2140154e21f6248593cc7d927d18e67a4bd990689bd67e463cddfe6f1b8b8601f5f69b20ba9d066535d6f69a6993a6ca6a5c93c4fd5b6edb7c00a3175781be47138bab78e082db6cfb7a1e93f4555622b834a35cfd0456a32b08e22ac7c0cc10405445a0e4b4917adae27606bc43083e7956829bc41a4f00355bab73f63da79c1820ed98b3cd6bfc59c46b2b9c81fb55d39ada09aa681286c46af4133b1990cd8dff04ad8873f63be7b665dc4b05c3269ad67e3578ce6dc17886125d30fd687a9c7f0ec0fd0130229cbeedc52f7f6ea370a136cd0acb953a08571ffffbfd7d9ae17228a87361a59366087eecafe73e55525ab850ae0ea1ad4529f8ee6cdab0e69e4cfadba44c0a5cc84fd04590266a47500e5ffbf25ff526d1cb391a253eebce1e5fc7393462f549627881dccea9d20cba0485fefe1cd63d310ad86495fabdb8127cfa16948903d3481cdf3d64efd98634ee1d47afe6e95b5869e4fe212499f0da2447b978714b3fbf1ee613a816bc28961d3d5e295689f0f27726b875c39a192c52448872092a0b2691fc68c90aed83115403a18005c11465ef35691a7e32d9d1eb44529bc4bd3ac82ac10e71c6bc24a5118b248584a267f818bd4c3c70c65ac632607d59d4de672ef59cdded8bafb6a5591b1ef640d2f11d49262a46f13628058d0cdf099b39f50821ad786ad750b348e3b55f4fb253a446e40e8c49076634b225e09bf7e24c2364294162f273765783bf6e9bbb27fcc0b6f015345d0644d8226b69d939d3bea4418c0945be5febdd1a3814719c60b7b3b77e2cfcc2dd060ccfb259b889ab32e2c4835df1f394bd7ec90340c0e462a22292b5cb46b8bbd5ee76bc0ca0e4ab027bbe45ee8ed04ee242697c1fa150ed820381fe17096d407fde9b94f59d9b67a75d529592047a4210b56afe78221cecae803877094eb062678aad1edbde6c45e74ddf6b783cd2e0fdef3280725e6a97c5a72265ecb9fa8783073c3ee546c134788348ea0b124f6daed864befb4f908304466d0a674fa063bf4e9cd8b0aabf6cc85ac67dcefd204cc623189befcb19aca26a6cb751f76a24146b56f7f14e5d95563dfeca391628d6af817782b84b9ec0e0f248bdf1d21620c16cb03d05c3a0d5c50e8411aea08e1a261645cec03112a49d82d7c03a550bc6df5008be98bd68cf7b46693d2e416240154cb1567913346a0e028c50ed1a77d32731a840bf63c29a52eccc89ab09c03484d664b1adf5f766575454d52773a3b76cb46fa39db683a7d73747e489d217062e4c3dc703c5c76c9e9c72bb5190b57facfdddfeba51cd5c2801ddb62ae09042c3bd04c6e890e695c4755f96474c9b2a491fb00419d5e0f9bfe278c35f6e4be4527aaf189d76bdceaf3820b485c30269af6fd22fd840a3d7f9ff1b25a2a217523f30914c7db95787b96f15731677b091569859022827a4202418964344e50cf0536f92a0b034de556c656c2c3bd1278f45a0bd504f610897a1130c49ce3c295181766f15eda7915688a066e82cf054fe61173ae67dc788cc535ab9d52ce299cf70eac1b8d70c69814df293f562880cab74098400f0a73f3496e0d225522fd58252b2725a2a59eadefe3d1d572f213f4afde81b188e50e64bbf1b4179cd85ad3ba403196242ee440f2c3da1bc3abf8a8e0f04de8913af0abfcb5fa91486404d6979ad60289680f3756995f973dac5b2e0c05078b0ea41c4e5265e804ede81a517bd6b7863eac687ddb1f1dc208b6a57921983d01dccbbdd1843c8b3dcb2c37c35e6547ec37e1d6492e90fe1cceebfb1690e08fc204607edc918ec09308a39a3f3878181e4427daca3d093afe64da569a975d0540d5e69bc4f46b75b59bdad1e5b438f117d6412f9281882ba2463bf6dcc23ce387e6aba1aeb8c2b5384c95e858f8751dd90bb0c1ddff167f525f25f1bcc52b885a5e1647ec67e7ee0dbcca0b0375a0d40c9b98826607053206d2102511ed766c21c0263316a3d576bf312fc5039f8f28c426de4f1b3c05a5932b326dd1343b64d13a49857b8c600d7f89c667c54f4be19c26ba06a2704f37d5ab25b8c07fa274ccc855b87d052f600e20491910832861e0b71c9349ca6355ba23b292fdda7b40a12ffd5369cede61987deeb6272b2ee4073740ba86f69afac9e88543014b424b8a85fba240a93d8c95b26d79a46143ffab5a83c13eaf0d6acc4259a9ceed4c2d463b8dd0ec4ea47cc794679d8fd0e3e5a746316c2ec97d06a03a22bfff46407a9d854618b6a4415cfbc7186e5a5d667fd3ce7bd6d2a16cca51374665e370f55a56da7ad6f3b5ccc20957dbf5a21667eca3cc6e63cf7426b62aa9334eb69871996a11a1bf21340887d808767f17c6a523ace2deb91074f53e2eaed821ec54a21b8bdabb5a1d00e53aa8f95db9d5296fd302a833d9981f8e1c5580b6aee79a7e95e9fc3c0bcc6dc9143699a974ceff47dbe1c79febb58167fa124d2cf12e4b15c1e745b0e5f814455f142d1cc558f0c91dfb56445756fd09c0b9e5508f787129c9f48188f1991c10efebafe62abf530d1f46b45ab4f774e951bc5289bdba8b5e24d75238ab02f412e35e4b89e8b2c27ac4de3fbd85470a32c5d0e19e8a79fd6dfeee567aab1a7028677eee7f0b9a40bb4b2a05c9b3d75d3a667b8c68163254dba4ed69c74412701b3464b159443bb18e236e27d8d5c896a80577f0dac78df5c00d84a3784fbae7004ba194da5e9e9ea8b0305a8ed515da4b1f83214a65bf6f0da2d2cb0f8af6382470812e2f7242824c6035c5c3dd800d0c561f909f67d0af8338012cbd73e4ca404891bb6eb14d8c3cd2bd8a47f81f6a1d142c2dc5e2354df2114eb9a90de0372f02a4d6d90f2ab6786d2ba83027ad657fb7471300b290e4cfcddd60d182b789938a17eed2e3bb674605054388560d8f5e0549ea848e4c7ba69cf4e034ed88520b69f010767208453ed2f0966fa09e409f95d385f37919d367bd4ebe8a6674cb7331583e0a26e7020854cbcff46cb2a45c368ee8662582c67fb2fbacb09a95016be9b2730a24cb026812846976f1084fcd77458d8ee6e0f93877578ecfebaf0c20f4e12b2d4ee6dd57d3380c493d162ae4cd2a6a5816fb2f45bca2bf68455ee3a1a961fc3354bb36e619078164d06cc30eac909f40545f93001a30f2f32bdc7d356783529a86b83553e50843ecc9681e9f3d4138064dfe3ca902a22c6bc03b2a67125c7b5d5c55db2ea3a4e9766a617c91061821822fa90034b75f4c4d9081c58fd4d577fdf1a07542cd6867edbffff7065f2dbbb94ec853c58f292f93db8556cea965c794e80eeeda4d53b3d0ed9132e817c551d0f205d5eba15d5ac9b169bcc2d1e4037eb411d46266af6c652d25abbea5b390c320472bacfeb28c6048db8cea15f9d1cfd3ae6951a3b4e451065eb62b2732d36abce8318c70275cf22cc04faae3c4921b593ed9ab124a3db1daae29d419e30b4d8042eedecb02b991ed57d90f8e5554d65e082fad69b77940a63ed92a76ae0bca82ba6617ccdcc5ab90041852bc509373ff58c680a90b4b216f068f84182cbfd3aa5021ab9d6292b333d535ed3feebe31ffa2ac5c344c8327c5c40cf9e0f5c2269bc88d74b36e47d33639d0374a363a6dda781291f7ac780666043aae0e9102faa930deaf7afc2ff98fa035cc08d94da500c82c66bf59e2c3928661d346efc67abbd85b7b3f3239143b17c6b65f320f71423bd130642997958ca5558a984cc66d4a8688ab8493dd31aef5531d376cd30182250adcb5a73d70fdd7e5d87cbc111b300a4fc92e0dd0b7be23594b40f99d6f48c5c5bb63b55cb086160e5b26c04f71e73b1b9480e0f757f1a21dfe8c2d8426232d1fdea8eb6f700a3326c5288ab80f60af080c60ba3878892d8b122046b5740fc10801d255481b461b92e2427179a54266906c6e5dd64d9d65eed0059723aeaf370807330f62c640d18767cc46fac76035c6d7fa622b591071b2c3c720911b064951f507b4b74b1b070dbe6e54cbbf73778e72c3687b84ba17c37967043d8e4fc722aacbff20dc0cda7b58932a57fe8ea095e210f5072fc6ca91840de6a2d033230f16f4867d346e3a4c1e4016473ef8fd07a32792d18bade9f8eb2983790a35a270cf1117b9c603ff6b02db78955a4872ff9edd4f0017ee633c758f1cc5c476ea0df5f3d9c94aa19f180199a1c78cf9c06d50f76fd1060841d4ca8572caf21bd8425fd7a4e02fba7fe2577d7e9b96cf6de7c3d4e3991e092393066cbc7ba1c220042ccc535a65ed42b116383359d610f9c230a28f155b083017682b7afc9730da887e2231f1790e9d3525785989613423da6baee916045562d56d11eaed9deec96bcc2aae33aeb1bf67c6b786cf2e13bd1a8fef73d5f27a67bf404259b805d31ab1290ba7c8edef7f6b4bc26515d38205d918a24816a70db1192ed0bc94972dba97b222c5cf863ff25d4018dbd79a3797c6f6790b6fca9b09577aff3674e94fa9361f93886ba0e24d7eb6e6155c0a97f95fbefba08efbc83e7e72edf7fb28fe7472fb0d6021ca92560ce7e7b7f764fb6f982e17a383f99c7e4b86dcb939636aa62c060c45db037a045f517286b5b91a080f587ceb7571924fa6109f3eca5bcbef14427884e05c33e521e138e92089883382f6a32516e5592792744f75de7ecdce48cc7e57aa930a28b7a1051ff2f869a634e39c93f1d9e08c8536ca97b4abf06b02d4cb66476d6ec87cc3f15a141c6c4ab3c60080777f9065dd1c07eec6d9c3fd61b406299acf80087451ecc6ffe4b31a923ffd31985c44649394ac609c2f6a7d1b664220c95ca83d00e0eba71de90a5456600fd90166dd7f8a2255661843bea580f351724b7a6458d9a2a2deba9797f2de4e36938f2f78193808a8bed3b833126b1c10048a62eb6940a38b519e8b04f9c8a4135bd0d5952eb0d3f19c2f9117f2335d872adebf6f8173aa1001878f0414b4b9008879823f924aa6eb98aca084d6647c25b70bc9db6f3f6302bf92f62dcc7be0ef36ec756d50b8e9abe268920807d8146688a32ec23f6e551f88d69aa160b93f9817f4c9800659bbbc4d768db321f16833c403be5bb370407283afc554b0ca4dfa4992b19b7e314c05c63b19086219711a1811c4644f9453ba1baaac2ebab4b8be356dbc6bb033c6d10fa04c498895043aaaedf90d80a2f978694e75ba2776c6ec3509fab5c704e50ae1c4ba69da5d3bf9c563bd123ced8fe368c91da5cd891ec55d21728a6094fc81e6d00edb153f6fa51a5e344ebc239e0de359cdbfb2f79f2339956364940e7b88dc530709c7f465bc09d97fb418d872757df5030a335423a80026fdeb54af082b6f72f497408797e409f02570d381a044fc87b450cb65c1176fa95ca7c34b0d2b67ce8ad6dab5a16f3acf7fb11893d3c4b7587a18c1d26df1ef371923203e2e7d395d4c7468d7a78e119f24662828cd7608ff25e7fee5ff548ae59335c2ce2ca95e3d883d586d65a7f0544d7323ed758a45ec0ff27bf74d9cde97b4e460172c9a291fc831ede012ddbd8dde717506cbca23abd884986d968d48447d9a1c4814e3f803d3bddc31735b4cd464e64ee0c6f9684208447e858c2e87bccd912c9f5b9eb2d3bc2043b39c32338b428c070b9f6540b02524366b68422486d2ce04d75f2d58037e04db159c38f59446809d5be7bc7ac8a901522b3bbca5a237fbfaa90826b4a5c150f0f2c9833ca81f49fe36383b1e9fda3a4b33e692479210a504f1b8fcdda12deccd473f99669b0c71aab9083e2aceafe400e9a5a648e78a70b777879617aa4bdffefd10742cbfb62aadde4712f90a54edf69700ae5d2c29a8044407783771a0800422ba5f94adf688c9e7d87311e93f16284eb560bb6192243ba2447155f39aebaa3c38ec3f28b12ada427b8eeab7c28ab5bfa7e0c239cd27d0a05ed8d961c83b8f98e9f2771d6a7a888bbdc5ea12a888f1f2268f36210ab5412717cf383c454c2b83bb46b3c0cdf299d3c591e5eee10612047da485ca558b8076b4811ceca2b962237ba756b7715ebcfc5e2f765a043abe11b4fa6fb1ef11a1ea879079fecd92368d3b5bd120761d9f61c5fbfc4528f41fab21789a7fad607dc2b107f10d54cc05b2f46be7400214e444496c7876913ce10ccf6debda46a3e02ffd7d73fc7a03278b96c100bef3c794c8c9438f5319ce615d287398b9b6ffa6322d3425b3291bfa5334168f8559c275ee61fe5947ba20027edb9195cfeb5524ff830b5e8bcf7233bf603d7fa946833a57bd9069ee407d9a109cd6673c39ab8e1ec33d37e48cc1d8d2f5b7126b54f1c30609af4e00645b763ecf063b28a8e4de7d551b259b46ebbf5dabd9d4728be747a5cb82a7df558ff588a74f46091521879228a87d72466c6b21d00d5463767e7ca9a5f0919cddd5af6bf47628b5311ec332ae52dff62a06d585ba151cd74dfd7a6e8a63fc4b4886b0e8fba22a2513a6494a2741439a2f3f83bab933a97dbb00cf9f3fa2ab860894862691f2fa6f04e9fb342e3f7846ef523d727b85c056c9d79805923bb04f21d07b5927163f7d43c1f363c149a5ba9ee0c467d4559d76e67459c5671ca30d35b3f7752a58af9b468f80f6f64dcfc43ddce5d0489461f909357a43dd6525101aceab57522ad8ab908d5914d9087d96d4da55b53fe1144b047cec243dff2922bf41e12be16d42bd91aab7bfbd57e746a89797db5abd4e4a6d911007dd096893714ea52b61878e6620ece37fbcb33e4c80e4cceb760dbc4ddc560f60df2ce34efe1ff92fb272c58446c56a2dbc257100d24964ade5283262fc5823524944f9e801ee694ed62d5c071e097b95a7403c6614879cb284eb2ad68933062bf12415ea7191d77dfd02fc6b45fb7b4be7714b05c1c2161520c0e1c205d7f3b62b846c15c1be8f9173c716dbbb4b6d2f55b7b489569cee338a809ac48dc0f54fcd1ecd73a06ec41b0b637b5dcea1f18b5b1d02a083a8057f282e93be73677749cf2dc68cb9ec31830c7373dfa10d3350640b1520e6b053045eb08fd2710871ccf243ca586b21a784fcdb87ed8e8e7caf4680b345c9745a69b3a46523b68f2cc4b9e13c35a7bdf5f89132f24e4eb23bb951f33529534dbb9e7a1a0940dc806ef82b2d5a382cb3cb791c4528bef2e531d1bc411290df9960eef08d00cb51be1ad953ce2c08c47801b26dcf0ab9ec77b5c2078cbe0aa000bdeefff92e12b25e040642a6a7861cbb278b1c05c6e32a7e53e0b34a03f44dd19377b4e9ac479586284bb533d2e35c6eec747c904c44b7f0ee69affb8b90f15f4d83db4d77aedc7b3f49715953ed790501b588a2286a2dc24417f160196a1c668631859b51f7cfc0d37764bab693c86d02fe52c79d8a7686f19a98dcaed4f0c5b49df5075c4b2ce791792997841ffe25eb421b071827a22fd3d7aa5bf125b71993fbfff218a6f1f011b1abeb5505757604c29966c6969240526703d61cf932cbf6859c2553009c5e7cc84ed371a218567063b5b43b62fbf331ea6b4cd68bdb1e488c785fefb9fb21387117f7ba3cab3f9908d602c3c9d1e65167387f455b3d6c7534f0d5ce8ca687d9c76ee42f5ac200e4b79cc31a4072600f366a0d8cd909674d6ce072330ae7649a2130b73d8e814131999227df206b8d5d0ccc5a8583a8bb8393303ce90113322206b1b5792d07ad53009feb610f097a9a51d9350131cb6aa21a01aeac88b56a6bff4434deffd922df86d786c4f267faa60cdd2c4be2d7cef2a1f17099f563a44804052cebd7a68ea9982d51cb91da55de14365f0dd2d65e9c747d3cd4f014c033ec313bf9ffa35476a8cf18a4f5ecab788d005311b3e0a414abb3bcd4bec7c30f91d0c7016560d9dda200a433c57124b8fc19c14b8eea936acc46d957a1ec819075d5c1958940988f65b2259f9b3eef1480338dec04e874287513532521de3aaaeb764da8e228abba6993f2c697ca864f254c5d20f355b749c81d840340b10a9e687ad569876ed520f1ac997db568bebb77edacc7418972b942df8d7e76adde73b907fd23e735aa77f9d652fd6ba69133b07b398525c5afacedda8dcbe14191bda7a37f1fecf075ba96c2b29b56cf48244241fb2734bff5adb221365666fe5c6ddee7052fafc7f2eadf5f1b833001f38aadc2a9822b0a4319be72114d4f1928499e4f5edac5f848fb85694ba13930e32d2bc4e0679c8b4861036c8c427b6b101462af0e45a104623b09280f8bf8e431f22bf4e35207ba103069218e638a99195b546e398adfc11507ae58071a67e8c85da4217579a46a8d89998f1d57a62e2bf7af2fc6f4849058abb7ef5664016a9d514e1c3e656af66b29f0be3acf83a3d72cfcff8bb74c7b61a5594b415f4f31bf3b602a8bf0e1d88a3b9e694e0787259b60cb17cca0ab0410e1da3b4a545dd11f90d22ebc80e2d8e8043d1738373f826cdd86c167cac9d33946efaca9f415fc6b57fe2bff88270a75fd63de1c7ac369f77b08f94343d99514c8949ae6c9e38bd53222ae462727552ba3945e10d08475438afd88eb17a6f60014468be1b1b1c682fb1f034ddd1952cdba93092ce13a30862fab1ca047141019d3a054c22e316f934a7e45eb63ea62c8b138c5c5cdb46883f269a183ad18706d1d456eb5093706093e3f59cb5eaf17fbcb80b8b9262cbc71f8fba9a0dc273639c7cfc320bf58321012f985604d08f1a559defd0e9941152678005cd61f5f6a23a9864ef2156dd0c936b4ba122f8c45b92134ea0bc0d2c7ca139d0291f225c3c01fee291d123890fc05bc9c3564a07f3281ec9e6cc3e7b26839bb59feda5d88e99cfc966884667b33a32fff24f5b56a2ec7d5075796624a6c633f20c9c1ad303f9a12ba1a99b76992757724511915e7a1108ec35c0448bca21eae1386a09a48372bea2f52bc1b24dc967e3b678e57083fc3146c9e287c405dda72969d444d403149cb566a69d296f9be2e19c6fce28fba00fe3f8270a941596b54f569cecc3bc6bc1c621964fc213d978977f4342e7c1d2b85e7a5e901a6aa94bf18b4ea2727a5cb35f24c440f456fd16ff34918b562553f1e7915184bafc8ff336d717d6b18b8cbccadbb330e81395c11655ec71095b90b0b88f5c670600603e431102d1da805482a0679580acef65f5288a4afdbbc92efa9e4b356bd26da54e9114aa59f7deede46d3d346146096e2acdad442bc853c0ef54ee973130f662b6452331c0a52624990f2278b2e50bcd53c8d319d5bcf9d60bffd5120925fc28d325eff5f1925df25787f4bc3411caf8ea90fad525aa9b93ecf1057132aa4586ea5082cdc252d2ce1365bbb4e174e221601f8d695fd7201fb2c093e429f4c4d7aee8b632ae8fb0abf8f5480360d24ab7a9969fef3b1089334c73574815966a3350777fab8d445d2b1a65317043735dcc9b507f2ca991daaeeff90036e42be877924a13f748356c6e91904059269467366bdfc3c50699e7282558b80c827bb18fb33183fdb981010aabfec784483f17980191be2c53ecb44740d7397f996752f0501e9e742f4b08eed3e485cb74d89270ea81b0bac60640a10818f244d958512355c4f6e0c17460158dc0630ab6e9fe297994ba74c1197f35f25ca88f0042ce7bed3b5425b0c86e5d5afa06e59b5e1c06af549402f222c8345de2087b01b4d94b006db5fe067c639c0aa21d9cddf39ee0b74fe65a7e8ccbc70a66378b734d179390b8dd7fc45d49df6c4b3ef51068266af691cebd363d0c1f2353c48aafa48052ba4e79f71bb6ba7cd4c3e4692de696c43c88949504a5062110757fd399aa05fe9b5e76d418f531d8dbc844b64ae081637c90bfc0aec1aacdc1a8326e0ef260e997b83c4ba147117b0ca5fbf5bdcdc015c972e451b4f4ec211f1bbb8e2f41aff23dfb535608a22bf97dea2970b8835c3ac8dff7aecad63e0be9dbbeae1d36c8e4d0f0de74072bd5606fbdd00527457876b2202b45d6c779a9ccccc10c12a218dced6d85923d1aa66b259738923a04b22dd1eaf794cdca64674d5075ea6bdde5c70b1ce30573ed0542780c00cb50fc6c590863c519741e4b2e61109def077639248379c02bbc5f2407eccac1d185a9832f1e850884a19fad612e7e546ca310b02c3efd2b82a869f4f8b091b6b86443db57b227387da135527013c4feece192922d7e4e80b1cf2abba7b984500282c276d9a405ecdbe37e680ebd779095aecfde4f031c8383354d99bbbc21342660ebc06cf3e6f95903306d4825fba46326ac0d673d25d14b0d3802e1e12a8519d68e5c9685143badb5064721c8125a6d8dbdffb5250029fecb7fa3edc15efa4347062c5bf695488f206207b3a16f7b3c444d73de35113f4c7edf939b8b069a9ece328ee99eab937443abb9432f34e4450c6e94a12faef73f4167ba1e9083cdbfd3e89f8aa5de76262f6787df9fcecf23115f621ee13b85003c71d90093ae231ab30bafe72fb614262d7b6fcc2a4397dff2769c0d08638f79ee4f30c0dd163fa7ac33bc1d9cc85660cb56e3ac01046b2bf4a534a3a576628a17e033e601f890e4ca8636bd62b01c8d88985580a923be460b5a9986e4f32ca7ff5ff020dcc7f021cb6c748a3617ddfbf7a4cdfe06d0d8b6832a356194ad32a9d2d0fcc075fdcc6a95cb140b578bd1eedcd794be83940b0f9a0906a481ae53e61d68ed201acdcc3effd3f46d637ffd815ae105a8c8f88735d0ade3dc2a50b1221e98f1eaea6d30e8b4c9423754563b6debc7a93b0dc9a70bd532013b60d4a27a1fa8b46c417b5a7902ddf1f454b79c8164a437035d54f528065959f7cce44dc0461d4577559c2d731cd56459db662b1d26be4b4643fed02acaa3aa593b5523c124c74854759c0c2afeaafea83611b9e0fb77780411d17f5359ce48b447a8f9d4e2e2036560f627ae573ecb134e07cd155dbe02081e1be16f836c28c884b74053f310ba9d50eda6ab0ba464c5c7664805bdf829e694b91c774553ee52f0b0fe858873f538b2af06af00eabd2fbee46498f758e0cf0d396d9410a150a399fe3b01cf656c81d12110c7ce2b9592e72445a6b9ba543c5b37ec684bdfc9916f14538ea27e6924142c395b8a3531fd0881107a2a1907408e2e7b7d5278e50b8879e0f2b79f2f22f870c6d4eb4d06a52529eac904fd6f6f4e257d1ef6c5bfe1ec6b36d6c20797d70fc2082bdd7d4cd21bcd36704b3ec483e3d074a47eb8e10e2c2435272c61c13e417e12e460a3ee0307fedb67afb46284fce12a332be5c68f6f7e6488ba0c9dcd14e25ceaf76e4c8bc26b2b65390b90602c804d028a0e39e1e063fdfb6da81c8b3730226226bce2a544c2909ee1f2f6cf1b37e7f8ac3770af6b2c7564dbf4d38a030dd5a4cf80ee7bc3aa5270a13d38d4c6193b570aa733a1abf0a228a56c008412097ff3d41d7cdc214e6783ef3a77c3e7e7de5d15ce104a03fbd88cbe1b26dd1823e755c3d28bb9382f18869084b5595f76d1049457913794f43d6554f57108ec5193cddaf8cc74322f7662f588c33f985b546d8a9161cac0b635f36927b0a6e51e6b0b122be772c3251a1b0b2c4f69c4e810de7c1fc3d4ce1a06a31e47520e6748e121cffda56d7db281a4b77b8ee8ca4755f6ed16c29ec3101a70240648ed00a59f28f94b2046639d58c6c15139df67819082a3cbc6b26a95a9f6af1039679023969f3f3a028a637f8fa549febe433e4929d7650fe4844a5d784b08d0d8efa70b64b84f2050c404486558bb7c64d2b4db8f96406f6643003bf63bbc622d1cb41643408d918a9f6831ee521e0b9d2c44db3706e68ca0ca93534a69e193f5e36ba0362d142d124389aa0ae6d24bbe69d84196fbc7e63a7fcdf4d6162aaad57c10f3b969d3757c88d98a24cf37ff5e5bbbcaced2c57a3a64c55b7147d450b3b53ef9f111e5377970bb0fedd883e497e6cb993bf5fef8b89eb0f4b0e95bffd144b7ba3ce374c61240b65fe5e1579b02840259054aeb7aae94d3eac622cf00b7616d3f0c9aaf0f1778397e0ef47d920fdc49cd472b23b75cf95f26fbbcaaebccbe2a80bef2e9ea704ef3e40828e9ead992dcc8a1ba98dab9a7d3ef3b260153e129a329f63207feaae6b16078c7bc1755b57ee63cf81c3dc2770e0dc6b72d20bc78bb6b833d093f6e5f1e3745d80572d1aa590f506d28b06bee16ca2d60ade3e25f76bb35989828060177a6af094b592d2b34f49398b316a2b8f7388fe742f5b481bb29d5f85ec4c28ce3c75cb82a21a449499403a3cd6dc6fbf37e502e6640e16745ae01fa55b3d49b0d4db8e95bf698c840604ddb6846da639f8a516a7120df59c187e25f8f022385750f2ff7887596045b98627bf5831cfceedbd38865e57081c3acf6b3de9aedac34afd9ad7450363e91b24162ab8a9502917744f7359228a2a2a8edfadd48551c297ec55833a32e68bbce2e42cef941b50b0db96bf7c4bf66bcd64e42041813ce0958075bb4773763e546dd4d0d5e2b253190ca3f4862ecb5a74bfbf4e5734d999dbb386dbc3631c405d43e89cfe33ca7f7dc880501788d795b941fbe266bdd20ddce1e5471948cc8a3d3a144e3495e6c9ce67e2b8d68607c20a41aa231d3867885295fe32645b9c73fc963fba5a8b1a6ac5be5d5efc3d1928f5e1ff83341b814b336abcf0567ee16c32b2c7c23255d790ebaed0f631860dc51ec116683c9e7c02a1c468b10af1e742fd92e28afb6cc440960114a769dcf16bca418dfff0a9fda2cada50eb420de51a1477dfc76083118b0394e8090a7ba28163856b743feb56ac588f9b04283b5bd0cdea36788830ab7a5604d7241b0813de8f23f0269dca8e6eaae24c485bb6918ba07d97511a6227e435ed5ee59ba7e0741fc8d3bbd5a2996b0eb773d0f26522bea1d49839d94b87231b060f6ffd5f7c63579fac42c492cd95d5f35e16d7c7adfdedbeb48253ab04cdb623518af22911b78d3abbc78aa2953e4ccaabcb5b847cb4dba553af0eb6526dff1fe14c356d453a4e6e01cebd14ce0420929fb9c46f8981c547a6fa49cfd8b35b9a3a29a4144c41fc012a753ce818d5debe9af5201f0b44f07f14570af020cdd828a9c62809356545b52c5cf9afb9a2e2ab78fb18e96020d06ce99fec7f98e6376ca261093aa7b3c3d316db02e12fc4f9962177e9cf3ac3245b8700fd8564381de4a61ca7e21641a92e05bd8b0291ce1a8669d444807da22d5f1567fa52e7d75df44677b05ddfe16f13747c5158b61764309cfdbd4d5e946aee1746f8166cd2b88d52f0da945db8748eeecd9efc843803b64efd8c09499fcab4ef32b2599b1d929afad6ceb6d4e728095ca42616c370d06e1cd7a809d6920d86ab6f748061c3c142e1b850629c59a7644d642c6d5cedd10a2466fff793ce945e4d4581304c36303b1f53877be90477435112c547551e7e98edc14cbee52a63e6ec657c1197a3b28b263df6dd9620cca82f8c00d71ff3ad348ff1c7f248b1eb5e4890cdfe69e26f5b3e1039be400beb6fb1ab88b4ec5ac07d40d0771de6de787f78a0a98e8f4d162192e5524162649fe4475cddf702a9cebc5036b40f1c1686f4ce7999a082fc42a7901bf9eeddccbc08b3354a69a49978224cde599352c328d6bb4f8040a152499b8baf7119f376fe29b04a8994ecce4910a2c2f98dd82897fc7f2911cdeb34165b79486714d2d512b1d98da0ba803f8d541ee1e757f40f2a0002037e0b35bc291e2b9da100903f1518596ee8e895d1948e89f4a40bfe546a36f6f2aa1da2e8d9d0d6400c0699c38a4693c53906faa608998035109fe1bdc218ad9b944323c5711ba4b1b88096545d7d4d8e29b51cafe82c65a4e0a929cb0c6ef58266934964b702f549aa29f6f380629ee2185cd10cad261f90bf4296dedf28c1410e303f5b697f5934ad308ba9dec2d776a44015c945bf57e2a3199a3c97c5381487a89cffb377dddfd9d1114924ae46685fe6e2f6a35d28e1fe58baf680cd816dcbab4229c4819077bfb06944a74de3646cbc1d81d37237868ede790c2006d7d7696e6f2cfd3d979724d3af7d2c9c04bed35b1fa7a716846eb7ce37a7daba2dd67c1280f6b9100804c2e1c2a90b809657333eaad9d1aa8163f07ef26f768f938b4b742f0f5c12a6db602729035a0f0b84e012bc86c0b5b5cacf1175fff6ffcf285c6238c56c728686edd9afe30bfc409b18a5c6e5a279eb8bf2d7a5e172bbbf9bac7b2be31386cb1310f2045d5bce82e7dee6140e63fdce5190c9c65dc6f8a6bb2a5eca63d0b3cf0684e98468c1529f1c6a4bf031be9b22dc7cc14a483e447cdcd0ab9cecf0070ba117533a1aefea7ebd2c58a2c2fc5882b78bdfdbb3520f44ad69e7483f4316a86f12c7bd10d2b46e56ef4d7dbb78a5be0c7cdf1c590d3ab729354f448068231654a034772ca368d437d93cad2136506b841f0d758bb5d33bf65bd11c4cb209b40692147d2977b1dda40d4bcb8efa162fa16984b33a55f0f03da3476a44de5680ff8a6e89ad283ada18976b15c4b3c0165671c701b9859cdf4092bd40adadc216ae41df82f912e64e9ad9022a8cb5a29ea2b7ac79dbc93661228a28d8e167c9a8cb934ca66d80353b38e687bb63a1f6174f4c77af2ba0e7afc63891e591799fb17f3f5fa73ba79ae8cd954362d65f9405c1c413d910f82e37a5c78cbaae8bcc8562d082231f4a8545c196bdbc3d9d01ce8ddaa354a78e6bd497ef9a00503f1269040946dbdc7b4d57bc341c5a7af380feafca611bddd815d92602607d8d693e53743c5f42e5ab219ec57fb59949c54faf2ae8577ea6332a46434ff67f125cc87b1283b6c40936537320ff8a9ec9c0aeeb456499e70c46759d5bc0579c977cd416eb924c6c427e0c93c0de270f425e814d6cd39e4457aeffb123a70c58bed78b8e68a62af51e33f7b626302e8bd34011636ef145e9a499d8e17c4d9ba130ed3a46ae5f2fc4813296fd60ee0ad71e9b184bf85391ebf3a8de6aa8ded19b8b966bd707be73c61db3dc72aa2d7c8b145556c6d47630f20ffd74a07e1300b122e90f410640206689169b0464246ce9a045786d644e2e888c70a0202593c52db33d525ec8e47bbb749ae5900922df6b9365592e5dd3c7fe45ddc5818759e0c8706aeeff34100494201820c8797db068127423eb5bb61a731071033629e0a333f87a46b400bf5310261a09b92d7d01bb8b9cf6fa6981f4ee08fb6a5afa7143c58750e0741397e3b320ff495a0392a8f7b4e2ffb05947858756e7cc775fdedb3f5cf55fc0f2dc1552ca02f919d5c7a96100db0fd0976d4815ec24b87c346fae422b8419710010267d82a584be94642c6eeb915bdef25377ad81f09fa7ce30fb617dc127a30f2e0fbb174a39d1aec77fc8b840def243b637fb8432371708a3ad39769a3f89e9f30e7327c84a16b2ac838a6ef8f782c7768055281793ba0ad5708030d21f6a1622927397ef81e6b6a2fcd4693db73bd85bc2699a1be42b22f803dfb18c87a2b8c735d5fdfe6b00c4e8f62456456a33bc9bdeabf4ced2adeed5617596d22b1b3170e932e8b2f029432fc5b722139c017816100b277d61a702f1f1fe8220e011dda7a1afb18fc4af05b2c56fa6ece7c95b8f3532ba304f41f83d686be4177f14faada58def3d1949414c878e37cddbd359be129a9b143bfbfed7c5a76c62e4adcc869d3384d8f71a3054cd8624507ac908c7d96a1a9b21a6294b89a4533e9c3853671b9e666fea05057e7cb130417692c20a3a335d727c2f2315fb90c966f38cd5db31ac6c2f945010e8baebc1046ffb970285bad92043d1c65fcb06dd2bdc07b5e3cc37446752fd1ae9da42826ac63244679f7e9bd2fc8abde55f2d4a238b6b1d2caf8a44cc76b8d3178955876b8139770b07c3fdcb629838075baab981f9565785081503a0a40bbb8513edf57e66133f5437ba9004a1cb77776d32b0cf37581dc994d1aabce9fe791691e4b0ea63db387a7236cf28229c00808986faab521f8222724fc28fd3fb2f163092d30fb1f67dc87127ef6fc0eb138637d1c1b01946a37b5dbd6fb1c4e32511c71bc6a545634bf11bdbc7e9db6a2f9231f46140c395f4390c3efce210f6686eae058eef6223299112d666a2d79bb8610a5f304b9dd01d122e91881863831a6de0c159029c45e35db5e74fae93aaf7581614b93409ea04bd4176cd025cc275bcb55b41ab512c44fdf2eef0c6d6db5f461bac47b69c270088c1f4dbd01e813bc001a34625e54104444c327783f4c994f8f83011e32d9c6108fc87590095843af586021e6f6ae86750a7ac1ffcd7381b2fb22ddd9cfa8f0e73ba6ce8559e1ad0149a375cf30b7abffaac39320ae667b2b36b6719c7eeaf51810151ccd85e8362d94bc461ff98390fbaec6b25fdf9c44084128cd6fae1a78388b645b99c9a384d1160f7c099c825d06cb9aed9dcb639bd38972532ba707bbb38244d3402b4de17ca8c57008e92f2e51e66c0c95e5dc70cb8bf45b2cf3024d4ba07612da516a46ba76257f3b63b19d6bd4e4bce7a13444d1739cc2bff4bfd5a13218a93f95bbdc67965d36cd0c72523eeda154876319ab6d592b95987af80e96f4e9374894a84c393c7809ed8bebe3bd43613170e901ce03d2f1529bfdcc6f4ca54906e8ba995d3b3d3c5e96b157807dc8a7313e4f2223c0869f055ca3a550b8e8ce41496619144e081a5b70f75bf0cdb2f5efb8f86dd084f7cca35f059b93c17ac58f0808e90f4460cca42c2bd3778bbd38a1c155cf594ec95a9f8640009d8040791b76d85d42d9567d4d2f0f0d4306bd9b5074f8eb6ab91402fb73419527be7783c908ce5dc31fdeb08901ccb238d3bd684732d1a051d5b5c5d73b369fa3e37058136e3cf252ac7d457447149686051aec0caf2273e4fb17d2acc72b2a5572a7629935ab0a90b05f0803ee6cd15c18692a846d498862b37f713a7c754b55c8edcf143b93878dabe06474defc1a877268d1ff56be75e7990f4bbb347a4f239d0a8be2fa1a953cff525df45dbb104015e2752f349990b608461d3b4ecdd6686908bc0468c685a0a0b79a9f56cb3e3a8ef6463bae7476c4e9f88112640f52a951af215aa4a8c9b8750fcd6d4cc42ed5b7f69e288b7d4dd25b7e9e9bd270a1e46a71056f5896cc9840fc310e76d02ae3dcb668bb8cdaeb3ed61396bb6b4727bc7775feb687569ad2bee65eea4f42f49c3b713f880d5e0c29740599d1937c19f164faf286faceb48ca55b8b217507c23d444517d88e14b146e14229839cc691db9b057d37a679716bc6ad836c1c791bd2471715a89ae06065804345bba8e50415a652630b9b5179c094dc12baee0d7b0a800db9478ffcb15da9e333030c9988ac46c2e3f05e66e8619933ac966389e5fba7a31c76edd3f6607c56564888c5432ff0dc7843fb75fe3d90a7a2961a148917c01842095781a7cfa99938753931651df928354ff7b0548dc129f7fc0f9bb4f2840d0593a6010ecab4cfc5c38ff213b46f08acdf7387b68094f3787225ccfa0f8b7d2677a366e7b1f3e9c772f2891f78e194d3a5713ce8d4320d960f36e485b14486a1c2ea4d6743d6928a172bfec6a44c0783987cbc037027bd2cd3a3252d6ca99a3048190ca32772bae3292f03264e12302559ab3fb720e64eb9457a55cf50f0432e40cbbc25949f489a17beec01bb4347d052609ca5d337626ed53eeb960c15648f823f6d672b9ede953f6c9d31d2b531eed78843b346acb113c0577dcd21a09543b47e61024761e51f4fc4a81b50db34f82d928f30764dc990c567b79ad215b4223b29e079b08bfe528c096b4343c24b67f0cdc6dd7526ded2a9567f4d877f87b9aba6aee872001cfc9922a59c835b3be58b380b4f1d4b13db7e2d6848233d39917ff46592b82a031594f1d739ff1eb8de7e86d9721194111aee0c65dce1b0f179ef354cd778408fb240ee49611cfe44a6e6c9f5a697be3a990241edf92cb54d19bd38def70dc9d1dbc7a2331227366725d8322773d2f496b7602024ce06f5f84daacfca75c21cdcd8bf2010605f41d9c4279eb4ba88c803e0db78288b1aa490a807342a8400ab5de4444534126b6b93b7</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="准备工作" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"/>
    
    
    <category term="Jenkins" scheme="https://kiml.github.io/tags/Jenkins/"/>
    
    <category term="Kubernetes" scheme="https://kiml.github.io/tags/Kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>面试 MQ</title>
    <link href="https://kiml.github.io/posts/a872196e/"/>
    <id>https://kiml.github.io/posts/a872196e/</id>
    <published>2024-08-22T03:39:33.000Z</published>
    <updated>2024-08-24T15:03:10.049Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>❗表示必掌握，❔表示基本不会问</p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24-08-22 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="你知道目前市面上使用的-MQ-有哪些吗？">你知道目前市面上使用的 MQ 有哪些吗？</h2><p>RabbitMQ、RocketMQ、Kafka。</p><h3 id="你使用的是哪种-MQ？为什么选择这类-MQ-qps-？">你使用的是哪种 MQ？为什么选择这类 MQ(qps)？</h3><p>我们选用的是 RabbitMQ，它并发能力强，性能好，延时低，管理界面也很丰富，只是吞吐量较低，但对于不是特别依赖大数据的项目来说，选用 RabbitMQ 已经足够用了。</p><p>RocketMQ 是阿里开源项目，吞吐量是最高的（10 万次级），但免费版的 MQ 是阉割版的，容易出问题。</p><p>Kafka 吞吐量很大（10 万次级），但它不是真正的 MQ，只是类似 MQ 的产品，它只支持主要 MQ 功能，比如它不具有消息确认机制。</p><h3 id="什么是-RabbitMQ？">什么是 RabbitMQ？</h3><p>RabbitMQ 是一款开源的，Erlang 编写的，基于 AMQP 协议的消息中间件。</p><h4 id="什么是-AMQP-协议？">什么是 AMQP 协议？</h4><p>AMQP 一个提供统一消息服务的应用层标准高级消息队列的链接协议，RabbitMQ 是主要根据 AMQP 协议进行数据通信和传输的。有点类似于 HTTP 协议。</p><h4 id="AMPQ-与-JMS-有什么区别知道吗？">AMPQ 与 JMS 有什么区别知道吗？</h4><p>JMS 是定义了统一的接口（API），来对消息操作进行统一；AMQP 是通过规定协议来统一数据交互的格式。</p><p>JMS 限定了必须使用 Java 语言；AMQP 只是协议，不规定实现方式，因此是跨语言的。</p><p>JMS 规定了两种消息模式；而 AMQP 的消息模式更加丰富。</p><h2 id="你使用的是-SpringCloud，Feign-可以进行远程调用，为什么还要中间加一个-MQ-呢？">你使用的是 SpringCloud，Feign 可以进行远程调用，为什么还要中间加一个 MQ 呢？</h2><p>为了解耦，如果没有中间件进行处理，那两个系统之间的关系过于紧密，一方改动，另一方也必须改动。</p><h3 id="MQ-有哪些优势？">MQ 有哪些优势？</h3><ol><li class="lvl-3"><p><strong>应用解耦（核心）：降低系统的耦合性，提升可维护性。</strong><br>场景：服务调用之间都可以考虑 MQ。</p></li><li class="lvl-3"><p><strong>异步提速：提升用户体验和系统吞吐量。</strong><br>场景：发送订单消息、发送短信消息等。</p></li><li class="lvl-3"><p><strong>削峰填谷：减少高峰时期对服务器的压力。</strong><br>场景：秒杀活动、限时定购等。</p></li></ol><h2 id="RabbitMQ-有什么缺点？">RabbitMQ 有什么缺点？</h2><ol><li class="lvl-3"><p><strong>系统可用性降低</strong><br>本来系统运行好好的，现在你非要加入个消息队列进去，那消息队列挂了，你的系统不是呵呵了。因此，系统可用性会降低。</p></li><li class="lvl-3"><p><strong>系统复杂度提高</strong><br>加入了消息队列，要多考虑很多方面的问题，比如：一致性问题、如何保证消息不被重复消费、如何保证消息可靠性传输等。因此，需要考虑的东西更多，复杂性增大。</p></li><li class="lvl-3"><p><strong>一致性问题</strong><br>A 系统处理完了直接返回成功了，人都以为你这个请求就成功了；但是问题是，要是 BCD 三个系统那里，BD 两个系统写库成功了，结果 C 系统写库失败了，咋整？你这数据就不一致了。</p></li><li class="lvl-3"><p><strong>消息顺序问题</strong><br>如果有 A、B 两个消息，B 消息被消费者消费的前提是 A 消息已被执行，这时候就不能先执行 B，得先执行 A 才行。</p></li></ol><h3 id="那怎么解决以上缺点呢？">那怎么解决以上缺点呢？</h3><ol><li class="lvl-3"><p><strong>系统可用性降低：集群模式保证高可用。</strong><br>镜像集群模式：这种模式，才是所谓的 RabbitMQ 的高可用模式。跟普通集群模式不一样的是，在镜像集群模式下，你创建的 queue，无论元数据还是 queue 里的消息都会存在于多个实例上，就是说，每个 RabbitMQ 节点都有这个 queue 的一个完整镜像，包含 queue 的全部数据的意思。然后每次你写消息到 queue 的时候，都会自动把消息同步到多个实例的 queue 上。RabbitMQ 有很好的管理控制台，就是在后台新增一个策略，这个策略是镜像集群模式的策略，指定的时候是可以要求数据同步到所有节点的，也可以要求同步到指定数量的节点，再次创建 queue 的时候，应用这个策略，就会自动将数据同步到其他的节点上去了。这样的话，好处在于，你任何一个机器宕机了，没事儿，其它机器（节点）还包含了这个 queue 的完整数据，别的 consumer 都可以到其它节点上去消费数据。坏处在于，第一，这个性能开销也太大了吧，消息需要同步到所有机器上，导致网络带宽压力和消耗很重！RabbitMQ 一个 queue 的数据都是放在一个节点里的，镜像集群下，也是每个节点都放这个 queue 的完整数据。</p></li><li class="lvl-3"><p><strong>系统复杂度提高</strong><br>加入 Rabbit 确实会增加系统复杂度，但 MQ 的解耦、提速、削峰这些方面的收益超过管理 MQ 的成本，所以该用还得用。</p></li><li class="lvl-3"><p><strong>一致性问题</strong><br>RabbitMQ 分布式消息是最终一致性的，即使可能因为消息失败而导致前后消息不一致，但分布式系统是在不同服务器上的，不能像简单的本地回滚一样，所以它通过发送延迟消息和定时消息来进行消息补偿，保证最终消息是一致性的，即是一个完整的事务。<br>RabbitMQ 本身是有事务的功能的，但是分布式的事务处理效率太低，且发生问题的可能性不高，所以多是选择放弃强一致性，而采用最终一致性。</p></li><li class="lvl-3"><p><strong>消息顺序问题</strong><br>在 MQ 中将有顺序要求的 AB 两个消息分别用两个队列与两个消费端手工 ack 接收，并且在消息上需要有对应的同组编号信息，以及发送次数，如果 B 执行的前提是已经消费了 A，那需要在消费端判断 A 消息是否已经正确接收（也就是查询成功的消息库）。如果 A 已经消费成功，则消费 B，如果 A 消费失败，或者 A 还没有消费，则 B 消息也直接返回为消息失败，并且不重回队列。并且让消息提供方重新发送 AB 消息，如果连续三次发送消息仍然消费失败，则 AB 两个消息第四次处理时就扔入死信队列中，等待人工处理。</p></li></ol><h3 id="RabbitMQ-事务是怎么实现的？">RabbitMQ 事务是怎么实现的？</h3><p>事务的实现主要是对信道（Channel）的设置，主要的方法有三个：</p><ol><li class="lvl-3"><p>channel.txSelect() 声明启动事务模式；</p></li><li class="lvl-3"><p>channel.txComment() 提交事务；</p></li><li class="lvl-3"><p>channel.txRollback() 回滚事务；</p></li></ol><h2 id="RabbitMQ-的实现原理是怎么样子的？">RabbitMQ 的实现原理是怎么样子的？</h2><p>首先，消息提供方会和 RabbitMQ 之间建立起 TCP 连接（Connection），每个连接中会有多个通信的信道（channel）来提连通信效率，不同的信道之间通过信道 id 来实现信息隔离。</p><p>而在 RabbitMQ 中，消息提供者发出的消息会先到 RabbitMQ 中的交换机中，由交换机根据分发规则，通过队列的形式分发消息。</p><p>消息接收方与 RabbitMQ 之间也一样是通过 TCP 连接和信道建立连接和通信。</p><p>此外，在 RabbitMQ 中，交换机与队列之间不同的边接方式，也产生了不同的工作模式。</p><h3 id="RabbitMQ-有哪些工作模式？">RabbitMQ 有哪些工作模式？</h3><ol><li class="lvl-3"><p>简单模式：就是不通过交换机，消息直接通过队列，一对一收发。</p></li><li class="lvl-3"><p>工作队列模式：也是不通过交换机，消息直接通过队列，只是一个发送方可以有多个接收端。</p></li><li class="lvl-3"><p>发布订阅模式：由交换机分发消息到不同队列，每个消费者只监听自己的队列。</p></li><li class="lvl-3"><p>路由模式：由交换机分发消息，但是发送方需要指定路由 key，交换机会根据不同的 routing key 分发给不同的队列，消费方对应自己需要的队列。</p></li><li class="lvl-3"><p>通配符模式：和路由模式有些相近，只是通配符模式可以在绑定 routing key 时使用通配符。</p></li><li class="lvl-3"><p>RPC 模式：RPC 远程调用模式，严格来说不太算是 MQ。</p></li></ol><h4 id="为什么-RPC-严格来说不能算是-MQ？">为什么 RPC 严格来说不能算是 MQ？</h4><p>RPC，远程过程调用，实际上是一种技术思想，而一种规范或协议，一般来说 RPC 远程调用是同步通信的，且 RPC 模式是没有队列的，多用在立即等待返回处理结果的场景，比如使用基于 RPC 思想的 Dubbo。而 MQ 是用来异步提速的，所以严格来说，RPC 模式不能算是 MQ。</p><h4 id="消息怎么路由？">消息怎么路由？</h4><ul class="lvl-0"><li class="lvl-2"><p>消息提供方 -&gt;路由 -&gt;一至多个队列消息发布到交换器时，消息将拥有一个路由键（routing key），在消息创建时设定。通过队列路由键，可以把队列绑定到交换器上。消息到达交换器后，RabbitMQ 会将消息的路由键与队列的路由键进行匹配（针对不同的交换器有不同的路由规则）；</p></li><li class="lvl-2"><p>常用的交换器主要分为一下三种：</p><ul class="lvl-2"><li class="lvl-6">fanout：如果交换器收到消息，将会广播到所有绑定的队列上。</li><li class="lvl-6">direct：如果路由键完全匹配，消息就被投递到相应的队列。</li><li class="lvl-6">topic：可以使来自不同源头的消息能够到达同一个队列。 使用 topic 交换器时，可以使用通配符。</li></ul></li></ul><h4 id="消息基于什么传输？">消息基于什么传输？</h4><p>由于 TCP 连接的创建和销毁开销较大，且并发数受系统资源限制，会造成性能瓶颈。RabbitMQ 使用信道的方式来传输数据。信道是建立在真实的 TCP 连接内的虚拟连接，且每条 TCP 连接上的信道数量没有限制。</p><h2 id="RabbitMQ-中的交换机可以储存消息吗？">RabbitMQ 中的交换机可以储存消息吗？</h2><p>不可以。交换机只负责转发消息，不具备存储消息的能力。</p><h2 id="如何防止消息丢失呢？">如何防止消息丢失呢？</h2><ol><li class="lvl-3"><p>在生产者丢失——confirm 确认模式</p><ol><li class="lvl-7">使用 RabbitMQ 事务机制，但它是同步的，且很耗性能。</li><li class="lvl-7">开启 confirm 确认模式，确认消息是否从“生产者”发送到“交换机”，成功回传 ack 消息，失败可以重试或抛异常。且 confirm 模式是异步回调接口通知 MQ 是否接收到消息。一般都采用这种方式。</li></ol></li><li class="lvl-3"><p>在 MQ 中丢失——持久化</p><ol><li class="lvl-7">开启 RabbitMQ 持久化，防止 RabbitMQ 自己弄丢数据。除非极小概率还没来得及持久化，MQ 就先挂了，即使这样，也只会丢失极少的数据量。</li><li class="lvl-7">所以，持久化可以跟生产者那边的 confirm 机制配合起来，只有消息被持久化到磁盘之后，才会通知生产者 ack 了，所以哪怕是在持久化到磁盘之前，RabbitMQ 挂了，数据丢了，生产者收不到 ack，你也是可以自己重发的。</li><li class="lvl-7">但持久化的过程也是很耗性能的。</li></ol></li><li class="lvl-3"><p>在消费者丢失——ack 机制</p><ol><li class="lvl-7">用 RabbitMQ 提供的 ack 机制，简单来说，就是你必须关闭 RabbitMQ 的自动 ack，可以通过一个 api 来调用就行，然后每次你自己代码里确保处理完的时候，再在程序里 ack 一把。这样的话，如果你还没处理完，不就没有 ack 了？那 RabbitMQ 就认为你还没处理完，这个时候 RabbitMQ 会把这个消费分配给别的 consumer 去处理，消息是不会丢的。以上三种方式，只是防止丢失，但具体补消息，还需要靠消息的补偿机制（也就是消息的可靠性保证）。</li></ol></li></ol><h2 id="❗RabbitMQ-如何保证消息的可靠性呢？">❗RabbitMQ 如何保证消息的可靠性呢？</h2><p>消息补偿。（延迟消息 + 定时扫描）</p><ul class="lvl-0"><li class="lvl-2"><p>由生产者发送消息给 MQ，MQ 会将消息给到消费者，消息者收到消息后，会返回一个消息确认，这个“消息确认”会被 MQ 放到“回调检查服务”中，“回调检查服务”会将收到的消息给到定时检查的 MDB。</p></li><li class="lvl-2"><p>但在这个过程中，如果出现异常或者网络波动，就会导致消息到不了回调检查服务，所以为了保证能够消息可靠性，会由生产者延迟一段时间后，再发送一个相同的消息给 MQ，这个消息会直接被 MQ 发送到回调检查服务。</p></li><li class="lvl-2"><p>回调检查服务会将延迟发送的消息和 MDB 中的消息对比，如果 MDB 中没有该消息，就会调用生产者，让生产者重新发送消息。</p></li><li class="lvl-2"><p>但在以上过程，还可能出现“延迟发送消息”也出问题，为了更深层保证消息的可靠性，还需要一个定时检查服务，每隔一段固定时间，定时检查服务会将 MDB 里的消息和 DB 中的消息进行匹配（检查某个时间段的表，而不是全表扫描），如果有 MDB 缺失的消息，就会调用生产者重新发送消息。</p></li></ul><h2 id="什么是-TTL？什么是死信队列，消息成为死信有哪几种情况？什么是延迟队列？">什么是 TTL？什么是死信队列，消息成为死信有哪几种情况？什么是延迟队列？</h2><ul class="lvl-0"><li class="lvl-2"><p>TTL：全称 Time To Live（存活时间/过期时间）</p><ol><li class="lvl-7">如果给消息设置过期时间，即使到了过期时间，消息也不会立马被清除，只有等消息到了队列的头上，才会被判断是否过期清除。</li><li class="lvl-7">如果给整个队列设置过期时间，即每一个进入队列的消息，都会各自被设置为了相同的过期时间。而非整个队列定时隔一段时间清除。</li><li class="lvl-7">如果单独消息和整个队列两则都设置了过期时间，以时间短的为准。</li></ol></li><li class="lvl-2"><p>死信队列：英文缩写：DLX  。Dead Letter Exchange（死信交换机）</p><ul class="lvl-2"><li class="lvl-6">消息成为死信的三种情况：<ol><li class="lvl-11">队列消息长度到达限制；</li><li class="lvl-11">消费者拒接消费消息，basicNack/basicReject,并且不把消息重新放入原目标队列，requeue=false；</li><li class="lvl-11">原队列存在消息过期设置，消息到达超时时间未被消费；</li></ol></li></ul></li><li class="lvl-2"><p>延迟队列：即消息进入队列后不会立即被消费，只有到到达指定时间后，才会被消费。</p><ul class="lvl-2"><li class="lvl-6">RabbitMQ 中并未提供延迟队列功能，采用【TTL】+【死信队列】 组合实现延迟队列的效果。</li></ul></li></ul><h2 id="有几百万消息持续积压几小时，说说怎么解决？">有几百万消息持续积压几小时，说说怎么解决？</h2><p>消息积压处理办法：临时紧急扩容：</p><p>先修复 consumer 的问题，确保其恢复消费速度，然后将现有 consumer 都停掉。</p><p>临时建立好原先 10 倍的 queue 数量。</p><p>然后写一个临时的分发数据的 consumer 程序，这个程序部署上去消费积压的数据，消费之后不做耗时的处理，直接均匀轮询写入临时建立好的 10 倍数量的 queue。</p><p>接着临时征用 10 倍的机器来部署 consumer，每一批 consumer 消费一个临时 queue 的数据。这种做法相当于是临时将 queue 资源和 consumer 资源扩大 10 倍，以正常的 10 倍速度来消费数据。</p><p>等快速消费完积压数据之后，得恢复原先部署的架构，重新用原先的 consumer 机器来消费消息。</p><h2 id="消息队列满了以后该怎么处理">消息队列满了以后该怎么处理</h2><p>没办法了，说明紧急扩容也来不及了，只能“丢弃 + 批量重导”了，写程序快速消费，然后重导。</p><h2 id="RabbitMQ-如何保证消息的不重复消费呢？【重要】">RabbitMQ 如何保证消息的不重复消费呢？【重要】</h2><p>一条数据重复出现两次，数据库里就只有一条数据，这就是保证了系统的幂等性。</p><p>保障了消息的幂等性，同一条消息被重复消费也就不影响了，因为不影响最终执行结果。</p><ol><li class="lvl-3"><p>方法一：采用乐观锁机制保证消息幂等性。在数据库中会增加一个版本字段，执行时也会匹配版本，如果版本不一致，SQL 语句的匹配就不成立，就不会执行。</p></li><li class="lvl-3"><p>方法二：你拿到这个消息做数据库的 insert 操作，那就容易了，给这个消息做一个唯一的主键，那么就算出现重复消费的情况，就会导致主键冲突，避免数据库出现脏数据。</p></li><li class="lvl-3"><p>方法三：你拿到这个消息做 redis 的 set 的操作，那就容易了，不用解决，因为你无论 set 几次结果都是一样的，set 操作本来就算幂等操作。</p></li><li class="lvl-3"><p>方法四：如果上面两种情况还不行，上大招。准备一个第三方介质，来做消费记录。以 redis 为例，给消息分配一个全局 id，只要消费过该消息，将 <code>&lt;id,message&gt;</code> 以 K-V 形式写入 redis。那消费者开始消费前，先去 redis 中查询有没有消费记录即可，先根据这个 id 去比如 redis 里查一下，之前消费过吗？如果没有消费过，你就处理，然后这个 id 写 redis。如果消费过了，那你就别处理了，保证别重复处理相同的消息即可。</p></li></ol><h2 id="如何解决消息队列的延时以及过期失效问题？">如何解决消息队列的延时以及过期失效问题？</h2><p>假设你用的是 RabbitMQ，RabbtiMQ 是可以设置过期时间的，也就是 TTL。如果消息在 queue 中积压超过一定的时间就会被 RabbitMQ 给清理掉，这个数据就没了。这就不是说数据会大量积压在 mq 里，而是大量的数据会直接搞丢。</p><p>我们可以采取一个方案，就是批量重导，这个我们之前线上也有类似的场景干过。就是大量积压的时候，我们当时就直接丢弃数据了，然后等过了高峰期以后，比如大家一起喝咖啡熬夜到晚上 12 点以后，用户都睡觉了。这个时候我们就开始写程序，将丢失的那批数据（发送的数据库和确认接收的数据库匹配），写个临时程序，一点一点的查出来，然后重新灌入 mq 里面去，把白天丢的数据给他补回来。也只能是这样了。</p><p>假设 1 万个订单积压在 mq 里面，没有处理，其中 1000 个订单都丢了，你只能手动写程序把那 1000 个订单给查出来，手动发到 mq 里去再补一次。</p><h2 id="如果要你自己设计一个-MQ，你会怎么设计？">如果要你自己设计一个 MQ，你会怎么设计？</h2><ol><li class="lvl-3"><p>重启起一个服务器来（使用 Redis）充当 RabbitMQ，实现 MQ 的解耦功能。</p></li><li class="lvl-3"><p>这个服务器需要可以存储和转发消息，存储是为了实现永久化，防止服务器出问题，消息丢失；转发消息则是可以通过不同队列来实现指定消费端，实现异步提速功能和削峰填谷的功能。</p></li><li class="lvl-3"><p>建立消息补尝机制，防止消息丢失。</p></li></ol><h3 id="怎么使用-Redis-实现-MQ-功能呢？">怎么使用 Redis 实现 MQ 功能呢？</h3><ol><li class="lvl-3"><p>使用 list 类型保存数据信息，rpush 生产消息，lpop 消费消息，当 lpop 没有消息时，可以 sleep 一段时间，然后再检查有没有信息，如果不想 sleep 的话，可以使用 blpop, 在没有信息的时候，会一直阻塞，直到信息的到来。redis 可以通过 pub/sub 主题订阅模式实现一个生产者，多个消费者，当然也存在一定的缺点，当消费者下线时，生产的消息会丢失。</p></li><li class="lvl-3"><p>使用 sortedset，使用时间戳做 score, 消息内容作为 key，调用 zadd 来生产消息，消费者使用 zrangbyscore 获取 n 秒之前的数据做轮询处理。</p></li></ol>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;
❗表示必掌握，❔表示基本不会问&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-08-22 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="面试" scheme="https://kiml.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="八股文" scheme="https://kiml.github.io/categories/%E9%9D%A2%E8%AF%95/%E5%85%AB%E8%82%A1%E6%96%87/"/>
    
    
    <category term="面试" scheme="https://kiml.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="八股文" scheme="https://kiml.github.io/tags/%E5%85%AB%E8%82%A1%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>跨域产生的原因及解决方案</title>
    <link href="https://kiml.github.io/posts/f5b0876a/"/>
    <id>https://kiml.github.io/posts/f5b0876a/</id>
    <published>2024-08-22T01:19:30.000Z</published>
    <updated>2024-08-22T15:51:14.653Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>面试必会，总结一下</p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24-08-22 初始记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="跨域的原因">跨域的原因</h2><p>跨域是是因为浏览器的同源策略限制，是浏览器的一种安全机制，服务端之间是不存在跨域的。</p><p>所谓同源指的是两个页面具有相同的协议、主机和端口，三者有任一不相同即会产生跨域。</p><h2 id="跨域举例">跨域举例</h2><table><thead><tr><th>当前页面 url</th><th>被请求页面 url</th><th>是否跨域</th><th>原因</th></tr></thead><tbody><tr><td><a class="link"   href="http://www.test.com/" >http://www.test.com/<i class="fas fa-external-link-alt"></i></a></td><td><a class="link"   href="http://www.test.com/index.html" >http://www.test.com/index.html<i class="fas fa-external-link-alt"></i></a></td><td>否</td><td>同源（协议、域名、端口号相同）</td></tr><tr><td><a class="link"   href="http://www.test.com/" >http://www.test.com/<i class="fas fa-external-link-alt"></i></a><br></td><td><a class="link"   href="https://www.test.com/index.html" >https://www.test.com/index.html<i class="fas fa-external-link-alt"></i></a></td><td>跨域</td><td>协议不同</td></tr><tr><td><a class="link"   href="http://www.test.com/" >http://www.test.com/<i class="fas fa-external-link-alt"></i></a></td><td><a class="link"   href="http://www.baidu.com/" >http://www.baidu.com/<i class="fas fa-external-link-alt"></i></a></td><td>跨域</td><td>主域名不同</td></tr><tr><td><a class="link"   href="http://www.test.com/" >http://www.test.com/<i class="fas fa-external-link-alt"></i></a><br></td><td><a class="link"   href="http://blog.test.com/" >http://blog.test.com/<i class="fas fa-external-link-alt"></i></a></td><td>跨域</td><td>子域名不同</td></tr><tr><td><a class="link"   href="http://www.test.com:8080/" >http://www.test.com:8080/<i class="fas fa-external-link-alt"></i></a><br></td><td><a class="link"   href="http://www.test.com:7071/" >http://www.test.com:7071/<i class="fas fa-external-link-alt"></i></a></td><td>跨域</td><td>端口号不同</td></tr></tbody></table><h2 id="跨域的解决办法">跨域的解决办法</h2><p>以下跨域解决方式选择一种，重复配置不会生效。</p><h3 id="Java-配置">Java 配置</h3><blockquote><ol><li class="lvl-3"><p>使用 @CrossOrigin 注解实现跨域【局域类跨域】（一般不用，没有记录）</p></li><li class="lvl-3"><p>通过配置文件实现跨域【全局跨域】</p></li><li class="lvl-3"><p>通过 CorsFilter 对象实现跨域【全局跨域】</p></li><li class="lvl-3"><p>通过 Response 对象实现跨域【局域方法跨域】（一般不用，没有记录）</p></li><li class="lvl-3"><p>通过实现 ResponseBodyAdvice 实现跨域【全局跨域】（一般不用，没有记录）</p></li></ol></blockquote><ol><li class="lvl-3"><p>通过配置文件实现跨域（重写 WebMvcConfigurer）</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;PATCH&quot;</span>)</span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>返回新的 CorsFilter（跨域配置）</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalCorsConfig</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsFilter <span class="title function_">corsFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 添加 CORS配置信息</span></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        <span class="comment">// 放行哪些原始域</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 是否发送 Cookie</span></span><br><span class="line">        config.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 放行哪些请求方式</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 放行哪些原始请求头部信息</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 暴露哪些头部信息</span></span><br><span class="line">        config.addExposedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 添加映射路径</span></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">corsConfigurationSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        corsConfigurationSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,config);</span><br><span class="line">        <span class="comment">//3. 返回新的CorsFilter</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsFilter</span>(corsConfigurationSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Nginx-配置">Nginx 配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  your_domain.com;</span><br><span class="line">    location /api &#123;</span><br><span class="line">        # 允许跨域请求的域名，* 表示允许所有域名访问</span><br><span class="line">        add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line"></span><br><span class="line">        # 允许跨域请求的方法</span><br><span class="line">        add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line"></span><br><span class="line">        # 允许跨域请求的自定义 Header</span><br><span class="line">        add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;Origin, X-Requested-With, Content-Type, Accept&#x27;;</span><br><span class="line"></span><br><span class="line">        # 允许跨域请求的 Credential</span><br><span class="line">        add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line"></span><br><span class="line">        # 预检请求的存活时间，即 Options 请求的响应缓存时间</span><br><span class="line">        add_header &#x27;Access-Control-Max-Age&#x27; 3600;</span><br><span class="line"></span><br><span class="line">        # 处理预检请求</span><br><span class="line">        if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">            return 204;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    # 其他配置...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Gateway-网关配置">Gateway 网关配置</h3><blockquote><ol><li class="lvl-3"><p>通过在配置文件中配置跨域实现。</p></li><li class="lvl-3"><p>通过在框架中添加 CorsWebFilter 来解决跨域问题。</p></li></ol></blockquote><ol><li class="lvl-3"><p>通过在配置文件中配置跨域实现。</p></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line"><span class="attr">gateway:</span>  </span><br><span class="line">  <span class="attr">globalcors:</span>  </span><br><span class="line">    <span class="attr">cors-configurations:</span>  </span><br><span class="line">      <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span> <span class="comment"># 匹配所有请求  </span></span><br><span class="line">        <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span>  </span><br><span class="line">        <span class="attr">allowedOrigins:</span> <span class="string">&quot;*&quot;</span> <span class="comment">#跨域处理 允许所有的域  </span></span><br><span class="line">        <span class="attr">allowedMethods:</span> <span class="comment"># 支持的方法  </span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">GET</span>  </span><br><span class="line">          <span class="bullet">-</span> <span class="string">POST</span>  </span><br><span class="line">          <span class="bullet">-</span> <span class="string">PUT</span>  </span><br><span class="line">          <span class="bullet">-</span> <span class="string">DELETE</span>  </span><br><span class="line">          <span class="bullet">-</span> <span class="string">OPTIONS</span></span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>通过在框架中添加 CorsWebFilter 来解决跨域问题。</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 Spring-Framework 从 5.3 版本之前，使用以下代码可以让 Spring Cloud Gateway 网关允许跨域：</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalCorsConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsWebFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        <span class="comment">// 这里仅为了说明问题，配置为放行所有域名，生产环境请对此进行修改</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 放行的请求头</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 放行的请求类型，有 GET, POST, PUT, DELETE, OPTIONS</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>); </span><br><span class="line">        <span class="comment">// 暴露头部信息</span></span><br><span class="line">        config.addExposedHeader(<span class="string">&quot;*&quot;</span>); </span><br><span class="line">        <span class="comment">// 是否允许发送 Cookie</span></span><br><span class="line">        config.setAllowCredentials(<span class="literal">true</span>); </span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 而 Spring-Framework 5.3 版本之后，关于 CORS 跨域配置类 CorsConfiguration 中将 addAllowedOrigin 方法名修改为 addAllowedOriginPattern，因此配置了变成了以下这样：</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalCorsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsWebFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        <span class="comment">// 这里仅为了说明问题，配置为放行所有域名，生产环境请对此进行修改</span></span><br><span class="line">        config.addAllowedOriginPattern(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 放行的请求头</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 放行的请求类型，有 GET, POST, PUT, DELETE, OPTIONS</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>); </span><br><span class="line">        <span class="comment">// 暴露头部信息</span></span><br><span class="line">        config.addExposedHeader(<span class="string">&quot;*&quot;</span>); </span><br><span class="line">        <span class="comment">// 是否允许发送 Cookie</span></span><br><span class="line">        config.setAllowCredentials(<span class="literal">true</span>); </span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;
面试必会，总结一下&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-08-22 初始记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="bug记录" scheme="https://kiml.github.io/categories/bug%E8%AE%B0%E5%BD%95/"/>
    
    <category term="2024" scheme="https://kiml.github.io/categories/bug%E8%AE%B0%E5%BD%95/2024/"/>
    
    
  </entry>
  
  <entry>
    <title>【代码模板】延时任务</title>
    <link href="https://kiml.github.io/posts/f6ca592/"/>
    <id>https://kiml.github.io/posts/f6ca592/</id>
    <published>2024-08-18T13:40:41.000Z</published>
    <updated>2024-08-19T00:28:47.072Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言</p></li></ul><blockquote><p>业务场景：<br>1、生成订单 30 分钟未支付，则自动取消（延时任务）<br>2、生成订单 60 秒后，给用户发短信（延时任务）<br>…</p></blockquote><ul class="lvl-0"><li class="lvl-2">更新</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24-08-18 初始记录（从原先的笔记进行搬运）</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="定时任务与延时任务的区别">定时任务与延时任务的区别</h2><ul class="lvl-0"><li class="lvl-2"><p>定时任务有明确的触发时间，延时任务没有</p></li><li class="lvl-2"><p>定时任务有执行周期，而延时任务在某事件触发后一段时间内执行，没有执行周期</p></li><li class="lvl-2"><p>定时任务一般执行的是批处理操作是多个任务，而延时任务一般是单个任务</p></li></ul><h2 id="解决思路">解决思路</h2><h3 id="数据库定时轮询（定时任务）">数据库定时轮询（定时任务）</h3><blockquote><p>通常在小型项目中使用，即通过一个线程定时的去扫描数据库，通过订单时间来判断是否有超时的订单，然后进行 update 或 delete 等操作。</p></blockquote><h4 id="实现">实现</h4><p>通过 springBoot 中的@Schedule 进行实现</p><h4 id="步骤">步骤</h4><ol><li class="lvl-3"><p>在启动类上添加注解@EnableScheduling</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span>  </span><br><span class="line"><span class="meta">@EnableScheduling</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduleAppcation</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        SpringApplication.run(ScheduleAppcation.class, args);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>在目标类上添加注解</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标任务执行完后，延迟10s执行。</span></span><br><span class="line"><span class="meta">@Scheduled(fixedDelay = 10 * 1000)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJob01</span><span class="params">()</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cron表达式</span></span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0 0 6 * * ?&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJob01</span><span class="params">()</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="优缺点">优缺点</h4><ul class="lvl-0"><li class="lvl-2"><p>存在延时，定时任务默认是单线程执行，前一个任务阻塞会影响后一个任务的执行</p></li><li class="lvl-2"><p>数据库数据量大的情况下，扫描损耗巨大</p></li></ul><h3 id="JDK-的延迟队列">JDK 的延迟队列</h3><blockquote><p>该方案是利用 JDK 自带的 DelayQueue 来实现，这是一个无界阻塞队列，该队列只有在延迟期满的时候才能从中获取元素，放入 DelayQueue 中的对象，是必须实现 Delayed 接口的。</p></blockquote><p>DelayQueue 属于排序队列，它的特殊之处在于队列的元素必须实现 Delayed 接口，该接口需要实现 compareTo 和 getDelay 方法</p><p><strong>getDelay 方法</strong>：获取元素在队列中的剩余时间，只有当剩余时间为 0 时元素才可以出队列。</p><p><strong>compareTo 方法</strong>：用于排序，确定元素出队列的顺序。</p><h4 id="实现-2">实现</h4><p>利用 JDK 自带的 DelayQueue 来实现</p><h4 id="步骤-2">步骤</h4><ol><li class="lvl-3"><p>在测试包 jdk 下创建延迟任务元素对象 DelayedTask，实现 compareTo 和 getDelay 方法</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedTask</span>  <span class="keyword">implements</span> <span class="title class_">Delayed</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 任务的执行时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">executeTime</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DelayedTask</span><span class="params">(<span class="type">int</span> delay)</span>&#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.add(Calendar.SECOND,delay);</span><br><span class="line">        <span class="built_in">this</span>.executeTime = (<span class="type">int</span>)(calendar.getTimeInMillis() /<span class="number">1000</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 元素在队列中的剩余时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getDelay</span><span class="params">(TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        <span class="keyword">return</span> executeTime - (calendar.getTimeInMillis()/<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 元素排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Delayed o)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">val</span> <span class="operator">=</span> <span class="built_in">this</span>.getDelay(TimeUnit.NANOSECONDS) - o.getDelay(TimeUnit.NANOSECONDS);</span><br><span class="line">        <span class="keyword">return</span> val == <span class="number">0</span> ? <span class="number">0</span> : ( val &lt; <span class="number">0</span> ? -<span class="number">1</span>: <span class="number">1</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>在 main 方法中创建 DelayQueue 并向延迟队列中添加三个延迟任务</p></li><li class="lvl-3"><p>循环的从延迟队列中拉取任务</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">DelayQueue&lt;DelayedTask&gt; queue = <span class="keyword">new</span> <span class="title class_">DelayQueue</span>&lt;DelayedTask&gt;();</span><br><span class="line"></span><br><span class="line">queue.add(<span class="keyword">new</span> <span class="title class_">DelayedTask</span>(<span class="number">5</span>));</span><br><span class="line">queue.add(<span class="keyword">new</span> <span class="title class_">DelayedTask</span>(<span class="number">10</span>));</span><br><span class="line">queue.add(<span class="keyword">new</span> <span class="title class_">DelayedTask</span>(<span class="number">15</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(System.currentTimeMillis()/<span class="number">1000</span>+<span class="string">&quot; start consume &quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(queue.size() != <span class="number">0</span>)&#123;</span><br><span class="line"><span class="type">DelayedTask</span> <span class="variable">delayedTask</span> <span class="operator">=</span> queue.poll();</span><br><span class="line"><span class="keyword">if</span>(delayedTask !=<span class="literal">null</span> )&#123;</span><br><span class="line">System.out.println(System.currentTimeMillis()/<span class="number">1000</span>+<span class="string">&quot; cosume task&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//每隔一秒消费一次</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="优缺点-2">优缺点</h4><ul class="lvl-0"><li class="lvl-2"><p>数据存储在内存中，容易出现 OOM（Out Of Memory）异常</p></li><li class="lvl-2"><p>服务器宕机后，内存中的数据容易丢失</p></li></ul><h3 id="Redis-缓存">Redis 缓存</h3><h4 id="实现-3">实现</h4><p>利用 Redis 中 Key 的过期时间</p><h4 id="步骤-3">步骤</h4><ol><li class="lvl-3"><p>给 Redis 中 Key 设置过期时间</p></li><li class="lvl-3"><p>监听 Redis 中 Key 过期事件</p></li><li class="lvl-3"><p>获取过期 Key 对应的值进行消费</p><ul class="lvl-2"><li class="lvl-6">过期 Key 拿不到值<ul class="lvl-4"><li class="lvl-10">可以把信息存储到 Key 上（监听事件可以获取到即将过期的 key，可以将文章 id 存储到 redis 中）</li><li class="lvl-10">存储一份不过期的对应 Key，在 Key 过期时获取这个不过期 Key 取值再删除</li></ul></li></ul></li></ol><h4 id="优缺点-3">优缺点</h4><ul class="lvl-0"><li class="lvl-2"><p>若 Redis 监听过期 Key 的微服务是多个集群时，只能有一个微服务处理，需要引入分布式锁，性能会下降。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.heima.common.redislock;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisLockImpl</span> <span class="keyword">implements</span> <span class="title class_">RedisLock</span> &#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="keyword">private</span> ThreadLocal&lt;String&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;String&gt;();</span><br><span class="line"><span class="keyword">private</span> ThreadLocal&lt;Integer&gt; threadLocalInteger = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key, <span class="type">long</span> timeout, TimeUnit unit)</span> &#123;</span><br><span class="line"><span class="type">Boolean</span> <span class="variable">isLocked</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (threadLocal.get() == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">threadLocal.set(uuid);</span><br><span class="line">isLocked = stringRedisTemplate.opsForValue().setIfAbsent(key, uuid, timeout, unit);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">isLocked = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 重入次数加1</span></span><br><span class="line"><span class="keyword">if</span> (isLocked) &#123;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> threadLocalInteger.get() == <span class="literal">null</span> ? <span class="number">0</span> : threadLocalInteger.get();</span><br><span class="line">threadLocalInteger.set(count++);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> isLocked;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">releaseLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line"><span class="comment">// 判断当前线程所对应的uuid是否与Redis对应的uuid相同，再执行删除锁操作</span></span><br><span class="line"><span class="keyword">if</span> (threadLocal.get().equals(stringRedisTemplate.opsForValue().get(key))) &#123;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> threadLocalInteger.get();</span><br><span class="line"><span class="comment">// 计数器减为0时才能释放锁</span></span><br><span class="line"><span class="keyword">if</span> (count == <span class="literal">null</span> || --count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">stringRedisTemplate.delete(key);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用-MQ-实现延时任务">使用 MQ 实现延时任务</h3><h4 id="实现-4">实现</h4><blockquote><p>内链：[[消息队列的选型与优缺点]]<br>外链：<a class="link"   href="https://kiml.site/posts/359ee88a/" >消息队列的选型与优缺点<i class="fas fa-external-link-alt"></i></a></p></blockquote><h4 id="优缺点-4">优缺点</h4><ul class="lvl-0"><li class="lvl-2"><p>高效，可以利用 MQ 的分布式特性轻易的进行横向扩展，消息支持持久化增加了可靠性。</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;业务场景：&lt;br&gt;
1、生成订单 30 分钟未支付，则自动取消（延时任务）&lt;br&gt;
2、生成订单 60 秒后，给用户发短信（延时任务）&lt;br&gt;
…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;更新&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-08-18 初始记录（从原先的笔记进行搬运）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="准备工作" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"/>
    
    
  </entry>
  
  <entry>
    <title>Freemarker 基础</title>
    <link href="https://kiml.github.io/posts/e9ae925d/"/>
    <id>https://kiml.github.io/posts/e9ae925d/</id>
    <published>2024-07-23T13:26:20.000Z</published>
    <updated>2025-04-07T09:44:34.643Z</updated>
    
    <content type="html"><![CDATA[<ul class="lvl-0"><li class="lvl-2"><p>前言<br>Java 开发的模板引擎。官网模板：<a class="link"   href="https://freemarker.apache.org/docs/dgui_quickstart_basics.html" >Template + data-model = output - Apache FreeMarker Manual<i class="fas fa-external-link-alt"></i></a></p></li><li class="lvl-2"><p>更新</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">24-07-23 初始记录</span><br><span class="line">24-07-26 bug记录</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="快速入门">快速入门</h2><p>freemarker 作为 Spring MVC 一种视图格式，默认情况下 SpringMVC 支持 freemarker 视图格式。</p><h3 id="Maven-依赖">Maven 依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--父工程指定SpringBoot版本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring‐boot‐starter‐parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--freemarker依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring‐boot‐starter‐freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置文件">配置文件</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># freemarker基本配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">freemarker:</span></span><br><span class="line">    <span class="attr">charset:</span> <span class="string">utf-8</span></span><br><span class="line">    <span class="string">request‐context‐attribute:</span> <span class="string">rc</span></span><br><span class="line">    <span class="string">content‐type:</span> <span class="string">text/html</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line">  <span class="string">add‐mappings:</span> <span class="literal">false</span> <span class="comment">#关闭工程中默认的资源处理</span></span><br><span class="line"><span class="attr">mvc:</span></span><br><span class="line">  <span class="string">throw‐exception‐if‐no‐handler‐found:</span> <span class="literal">true</span> <span class="comment">#出现错误时直接抛出异常</span></span><br></pre></td></tr></table></figure><h3 id="代码使用">代码使用</h3><ol><li class="lvl-3"><p>添加 view 映射</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;  </span><br><span class="line">    <span class="comment">// 注意这里不要添加后缀</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/pay-page&quot;</span>).setViewName(<span class="string">&quot;pay&quot;</span>);  </span><br><span class="line">        registry.addViewController(<span class="string">&quot;/pay-error&quot;</span>).setViewName(<span class="string">&quot;pay_error&quot;</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>返回 Controller 注解不要加 <code>@ResponseBody</code> 或 <code>@RestController</code>（<mark>这个注解把返回的信息转成 json 返回，不能实现页面跳转的功能</mark>）</p></li><li class="lvl-3"><p>返回使用 <code>forward:</code></p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;forward:/pay-error&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="基础指令">基础指令</h2><blockquote><p>1、注释，即 <code>&lt;#‐‐和‐‐&gt;</code>，介于其之间的内容会被 freemarker 忽略<br>2、插值（Interpolation）：即 <code>$&#123;..&#125;</code> 部分，freemarker 会用真实的值代替 <code>$&#123;..&#125; </code><br>3、FTL 指令：和 HTML 标记类似，名字前加 <code>#</code> 予以区分，Freemarker 会解析标签中的表达式或逻辑。<br>4、文本，仅文本信息，这些不是 freemarker 的注释、插值、FTL 指令的内容会被 freemarker 忽略解析，直接输出内容。</p></blockquote><h3 id="List-指令">List 指令</h3><blockquote><p>说明： <code>_index</code>：得到循环的下标，使用方法是在 stu 后边加 <code>_index</code>，它的值是从 0 开始</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; stus = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>钱包<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  &lt;#list stus as stu&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu_index + 1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.name&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.age&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.mondy&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  &lt;/#list&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Map-指令">Map 指令</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,Student&gt; stuMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">输出stu1的学生信息：<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">姓名：$&#123;stuMap[&#x27;stu1&#x27;].name&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">年龄：$&#123;stuMap[&#x27;stu1&#x27;].age&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">输出stu1的学生信息：<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">姓名：$&#123;stuMap.stu1.name&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">年龄：$&#123;stuMap.stu1.age&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">遍历输出两个学生信息：<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>钱包<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  &lt;#list stuMap?keys as k&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;k_index + 1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stuMap[k].name&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stuMap[k].age&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stuMap[k].mondy&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  &lt;/#list&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="if-指令">if 指令</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>钱包<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  &lt;#list stus as stu&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> &lt;#<span class="attr">if</span> <span class="attr">stu.name</span> ==<span class="string">&#x27;小明&#x27;</span>&gt;</span>style=&quot;background:red;&quot;&lt;/#if&gt;&gt;$&#123;stu.name&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.age&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.mondy&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  &lt;/#list&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="运算符">运算符</h3><ol><li class="lvl-3"><p>算数运算符 FreeMarker 表达式中完全支持算术运算，FreeMarker 支持的算术运算符包括:<code>+</code>, <code>-</code> , <code>*</code> , <code>/</code> , <code>%</code></p></li><li class="lvl-3"><p>逻辑 运算符 逻辑运算符有如下几个: 逻辑与 <code>&amp;&amp;</code> 逻辑或 <code>||</code> 逻辑非 <code>!</code> 逻辑运算符只能作用于布尔值，否则将产生错误</p></li><li class="lvl-3"><p>比较运算符 表达式中支持的比较运算符有如下几个:</p><ol><li class="lvl-7">= 或者 == 判断两个值是否相等</li><li class="lvl-7"><code>!=</code> 判断两个值是否不等</li><li class="lvl-7"><code>&gt;</code> 或者 <code>gt</code> 判断左边值是否大于右边值</li><li class="lvl-7"><code>&gt;=</code> 或者 <code>gte</code> 判断左边值是否大于等于右边值</li><li class="lvl-7"><code>&lt;</code> 或者 <code>lt</code> 判断左边值是否小于右边值</li><li class="lvl-7"><code>&lt;=</code> 或者 <code>lte</code> 判断左边值是否小于等于右边值</li></ol></li></ol><blockquote><p>注意：= 和 <code>!=</code> 可以用于字符串，数值和日期来比较是否相等，但 = 和 <code>!=</code> 两边必须是相同类型的值，否则会产生错误，而且 FreeMarker 是精确比较，“x”,&quot;x &quot;,“X” 是不等的。其它的运行符可以作用于数字和日期，但不能作用于字符串，大部分的时候,使用 <code>gt</code> 等字母运算符代替 <code>&gt;</code> 会有更好的效果,因为 FreeMarker 会把 <code>&gt;</code> 解释成 FTL 标签的结束字符,当然,也可以使用括号来避免这种情况，如：<code>&lt;#if (x&gt;y)&gt;</code></p></blockquote><h3 id="空值处理">空值处理</h3><ol><li class="lvl-3"><p>判断某变量是否存在使用 <code>??</code> 用法为：<code>variable??</code>，如果该变量存在，返回 true，否则返回 false</p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if stus??&gt;</span><br><span class="line">&lt;#list stus as stu&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>缺失变量默认值使用 <code>!</code> 使用 <code>!</code> 要以指定一个默认值，当变量为空时显示默认值。</p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;#--如果name为空显示空字符串。--&gt;</span><br><span class="line">$&#123;name!&#x27;&#x27;&#125;</span><br><span class="line">&lt;#--如果stu或bestFriend或name为空默认显示空字符串。--&gt;</span><br><span class="line">$&#123;(stu.bestFriend.name)!&#x27;&#x27;&#125;</span><br></pre></td></tr></table></figure><h3 id="内置对象">内置对象</h3><p>在 freemarker 中可以访问 Request、Session 等内置对象。</p><p>Request： 用于获取 Request 对象中的 attribute 对象。</p><p>Session：用于获取 Session 对象中的 attribute 对象。</p><p>RequestParameters：用于获取 Request 对象的 parameter 参数（浏览器端发送的请求数据）</p><ol><li class="lvl-3"><p>配置</p></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">freemarker:</span> </span><br><span class="line">    <span class="string">request‐context‐attribute:</span> <span class="string">rc</span> <span class="comment">#把Spring的RequestContext对象暴露为变量rc </span></span><br><span class="line">    <span class="string">expose‐request‐attributes:</span> <span class="literal">true</span> </span><br><span class="line">    <span class="string">expose‐session‐attributes:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>例子在 Controller 中设置 request、session 的属性值</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试内置对象 </span></span><br><span class="line">request.setAttribute(<span class="string">&quot;attr1&quot;</span>,<span class="string">&quot;test&quot;</span>); </span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession(); </span><br><span class="line">session.setAttribute(<span class="string">&quot;session1&quot;</span>, <span class="string">&quot;user1&quot;</span>);</span><br></pre></td></tr></table></figure><p>页面获取数据</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url请求参数：$&#123;RequestParameters[&#x27;param1&#x27;]!&quot;&quot;&#125; </span><br><span class="line">request Attribute:$&#123;Request[&quot;attr1&quot;]!&quot;&quot;&#125; </span><br><span class="line">session Attribute:$&#123;Session[&quot;session1&quot;]!&quot;&quot;&#125; </span><br><span class="line">工程路径：$&#123;rc.contextPath&#125; </span><br><span class="line">请求地址: $&#123;rc.requestUri&#125;</span><br></pre></td></tr></table></figure><h2 id="BUG">BUG</h2><h3 id="访问报错-404">访问报错 404</h3><ol><li class="lvl-3"><p>检查是否添加了 view 映射，注意不要加后缀。</p></li><li class="lvl-3"><p>检查 Controller 层使用的注解：不要加 <code>@ResponseBody</code> 或 <code>@RestController</code>（<mark>这个注解把返回的信息转成 json 返回，不能实现页面跳转的功能</mark>）</p></li><li class="lvl-3"><p><strong>nacos 配置文件读取失败</strong>（<s>不确定原因</s>重启 nacos 后就好了）：使用 nacos 读取配置文件，出现自动装配时 suffix 没有读取到的情况。（本地配置使用.html 可以读取成功，但是放到 nacos 后，FreeMarkerProperties 中的 suffix 属性始终为默认的 <code>.ftl</code>，并且从<strong>springboot2.0</strong>开始默认的 suffix 为 <code>.ftlh</code>）</p><ul class="lvl-2"><li class="lvl-6">但是这里还是建议使用 <code>.ftl</code>，不然后序接口调用处可能会出 bug</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;前言&lt;br&gt;
Java 开发的模板引擎。官网模板：&lt;a class=&quot;link&quot;   href=&quot;https://freemarker.apache.org/docs/dgui_quickstart_basics.html&quot; &gt;Template + data-model = output - Apache FreeMarker Manual&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;更新&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;24-07-23 初始记录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24-07-26 bug记录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端项目" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="准备工作" scheme="https://kiml.github.io/categories/%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"/>
    
    
    <category term="Java" scheme="https://kiml.github.io/tags/Java/"/>
    
    <category term="Freemarker" scheme="https://kiml.github.io/tags/Freemarker/"/>
    
  </entry>
  
</feed>
